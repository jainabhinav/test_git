package graph

import io.prophecy.libs._
import udfs.PipelineInitCode._
import udfs.UDFs._
import udfs.ColumnFunctions._
import config.Context
import org.apache.spark._
import org.apache.spark.sql._
import org.apache.spark.sql.functions._
import org.apache.spark.sql.types._
import org.apache.spark.sql.expressions._
import java.time._

object Filter_by_Expression_agg_dw_impressionsj0 {

  def apply(
    context: Context,
    in0:     DataFrame,
    in1:     DataFrame,
    in2:     DataFrame,
    in3:     DataFrame
  ): DataFrame =
    in0
      .as("in0")
      .join(
        in1.as("in1"),
        col("in0.publisher_id").cast(IntegerType) === col("in1.publisher_id"),
        "left_outer"
      )
      .join(in2.as("in2"),
            col("in0.campaign_group_id").cast(IntegerType) === col(
              "in2.campaign_group_id"
            ),
            "left_outer"
      )
      .join(
        in3.as("in3"),
        col("in0.advertiser_id").cast(IntegerType) === col("in3.advertiser_id"),
        "left_outer"
      )
      .select(
        when(
          is_not_null(col("in1.publisher_id")),
          struct(
            col("in1.seller_member_id").as("seller_member_id"),
            col("in1.publisher_id").as("publisher_id"),
            col("in1.site_id").as("site_id"),
            col("in1.tag_id").as("tag_id")
          )
        ).as("_member_id_by_publisher_id_LOOKUP"),
        when(
          is_not_null(col("in2.campaign_group_id")),
          struct(
            col("in2.buyer_member_id").as("buyer_member_id"),
            col("in2.advertiser_id").as("advertiser_id"),
            col("in2.campaign_group_id").as("campaign_group_id"),
            col("in2.campaign_id").as("campaign_id")
          )
        ).as("_advertiser_id_by_campaign_group_id_LOOKUP"),
        when(
          is_not_null(col("in3.advertiser_id")),
          struct(
            col("in3.buyer_member_id").as("buyer_member_id"),
            col("in3.advertiser_id").as("advertiser_id"),
            col("in3.campaign_group_id").as("campaign_group_id"),
            col("in3.campaign_id").as("campaign_id")
          )
        ).as("_member_id_by_advertiser_id_LOOKUP"),
        col("in0.date_time").as("date_time"),
        col("in0.auction_id_64").as("auction_id_64"),
        col("in0.user_id_64").as("user_id_64"),
        col("in0.tag_id").as("tag_id"),
        col("in0.venue_id").as("venue_id"),
        col("in0.inventory_source_id").as("inventory_source_id"),
        col("in0.session_frequency").as("session_frequency"),
        col("in0.site_domain").as("site_domain"),
        col("in0.width").as("width"),
        col("in0.height").as("height"),
        col("in0.geo_country").as("geo_country"),
        col("in0.geo_region").as("geo_region"),
        col("in0.gender").as("gender"),
        col("in0.age").as("age"),
        col("in0.seller_member_id").as("seller_member_id"),
        col("in0.buyer_member_id").as("buyer_member_id"),
        col("in0.creative_id").as("creative_id"),
        col("in0.seller_currency").as("seller_currency"),
        col("in0.buyer_currency").as("buyer_currency"),
        col("in0.buyer_bid").as("buyer_bid"),
        col("in0.buyer_spend").as("buyer_spend"),
        col("in0.ecp").as("ecp"),
        col("in0.reserve_price").as("reserve_price"),
        col("in0.advertiser_id").as("advertiser_id"),
        col("in0.campaign_group_id").as("campaign_group_id"),
        col("in0.campaign_id").as("campaign_id"),
        col("in0.creative_freq").as("creative_freq"),
        col("in0.creative_rec").as("creative_rec"),
        col("in0.is_learn").as("is_learn"),
        col("in0.is_remarketing").as("is_remarketing"),
        col("in0.advertiser_frequency").as("advertiser_frequency"),
        col("in0.advertiser_recency").as("advertiser_recency"),
        col("in0.user_group_id").as("user_group_id"),
        col("in0.camp_dp_id").as("camp_dp_id"),
        col("in0.media_buy_id").as("media_buy_id"),
        col("in0.media_buy_cost").as("media_buy_cost"),
        col("in0.brand_id").as("brand_id"),
        col("in0.cleared_direct").as("cleared_direct"),
        col("in0.clear_fees").as("clear_fees"),
        col("in0.media_buy_rev_share_pct").as("media_buy_rev_share_pct"),
        col("in0.revenue_value").as("revenue_value"),
        col("in0.pricing_type").as("pricing_type"),
        col("in0.can_convert").as("can_convert"),
        col("in0.pub_rule_id").as("pub_rule_id"),
        col("in0.is_control").as("is_control"),
        col("in0.control_pct").as("control_pct"),
        col("in0.control_creative_id").as("control_creative_id"),
        col("in0.predicted_cpm").as("predicted_cpm"),
        col("in0.actual_bid").as("actual_bid"),
        col("in0.site_id").as("site_id"),
        col("in0.content_category_id").as("content_category_id"),
        col("in0.auction_service_fees").as("auction_service_fees"),
        col("in0.discrepancy_allowance").as("discrepancy_allowance"),
        col("in0.forex_allowance").as("forex_allowance"),
        col("in0.creative_overage_fees").as("creative_overage_fees"),
        col("in0.fold_position").as("fold_position"),
        col("in0.external_inv_id").as("external_inv_id"),
        col("in0.cadence_modifier").as("cadence_modifier"),
        col("in0.imp_type").as("imp_type"),
        col("in0.advertiser_currency").as("advertiser_currency"),
        col("in0.advertiser_exchange_rate").as("advertiser_exchange_rate"),
        col("in0.ip_address").as("ip_address"),
        col("in0.publisher_id").as("publisher_id"),
        col("in0.auction_service_deduction").as("auction_service_deduction"),
        col("in0.insertion_order_id").as("insertion_order_id"),
        col("in0.predict_type_rev").as("predict_type_rev"),
        col("in0.predict_type_goal").as("predict_type_goal"),
        col("in0.predict_type_cost").as("predict_type_cost"),
        col("in0.booked_revenue_dollars").as("booked_revenue_dollars"),
        col("in0.booked_revenue_adv_curr").as("booked_revenue_adv_curr"),
        col("in0.commission_cpm").as("commission_cpm"),
        col("in0.commission_revshare").as("commission_revshare"),
        col("in0.serving_fees_cpm").as("serving_fees_cpm"),
        col("in0.serving_fees_revshare").as("serving_fees_revshare"),
        col("in0.user_tz_offset").as("user_tz_offset"),
        col("in0.media_type").as("media_type"),
        col("in0.operating_system").as("operating_system"),
        col("in0.browser").as("browser"),
        col("in0.language").as("language"),
        col("in0.publisher_currency").as("publisher_currency"),
        col("in0.publisher_exchange_rate").as("publisher_exchange_rate"),
        col("in0.media_cost_dollars_cpm").as("media_cost_dollars_cpm"),
        col("in0.payment_type").as("payment_type"),
        col("in0.revenue_type").as("revenue_type"),
        col("in0.seller_revenue_cpm").as("seller_revenue_cpm"),
        col("in0.bidder_id").as("bidder_id"),
        col("in0.inv_code").as("inv_code"),
        col("in0.application_id").as("application_id"),
        col("in0.shadow_price").as("shadow_price"),
        col("in0.eap").as("eap"),
        col("in0.datacenter_id").as("datacenter_id"),
        col("in0.imp_blacklist_or_fraud").as("imp_blacklist_or_fraud"),
        col("in0.vp_expose_domains").as("vp_expose_domains"),
        col("in0.vp_expose_categories").as("vp_expose_categories"),
        col("in0.vp_expose_pubs").as("vp_expose_pubs"),
        col("in0.vp_expose_tag").as("vp_expose_tag"),
        col("in0.vp_expose_age").as("vp_expose_age"),
        col("in0.vp_expose_gender").as("vp_expose_gender"),
        col("in0.inventory_url_id").as("inventory_url_id"),
        col("in0.audit_type").as("audit_type"),
        col("in0.is_exclusive").as("is_exclusive"),
        col("in0.truncate_ip").as("truncate_ip"),
        col("in0.device_id").as("device_id"),
        col("in0.carrier_id").as("carrier_id"),
        col("in0.creative_audit_status").as("creative_audit_status"),
        col("in0.is_creative_hosted").as("is_creative_hosted"),
        col("in0.seller_deduction").as("seller_deduction"),
        col("in0.city").as("city"),
        col("in0.latitude").as("latitude"),
        col("in0.longitude").as("longitude"),
        col("in0.device_unique_id").as("device_unique_id"),
        col("in0.package_id").as("package_id"),
        col("in0.targeted_segments").as("targeted_segments"),
        col("in0.supply_type").as("supply_type"),
        col("in0.is_toolbar").as("is_toolbar"),
        col("in0.deal_id").as("deal_id"),
        col("in0.vp_bitmap").as("vp_bitmap"),
        col("in0.view_detection_enabled").as("view_detection_enabled"),
        col("in0.view_result").as("view_result"),
        col("in0.ozone_id").as("ozone_id"),
        col("in0.is_performance").as("is_performance"),
        col("in0.sdk_version").as("sdk_version"),
        col("in0.inventory_session_frequency")
          .as("inventory_session_frequency"),
        col("in0.device_type").as("device_type"),
        col("in0.dma").as("dma"),
        col("in0.postal").as("postal"),
        col("in0.viewdef_definition_id").as("viewdef_definition_id"),
        col("in0.viewdef_viewable").as("viewdef_viewable"),
        col("in0.view_measurable").as("view_measurable"),
        col("in0.viewable").as("viewable"),
        col("in0.is_secure").as("is_secure"),
        col("in0.view_non_measurable_reason").as("view_non_measurable_reason"),
        col("in0.data_costs").as("data_costs"),
        col("in0.bidder_instance_id").as("bidder_instance_id"),
        col("in0.campaign_group_freq").as("campaign_group_freq"),
        col("in0.campaign_group_rec").as("campaign_group_rec"),
        col("in0.insertion_order_freq").as("insertion_order_freq"),
        col("in0.insertion_order_rec").as("insertion_order_rec"),
        col("in0.buyer_gender").as("buyer_gender"),
        col("in0.buyer_age").as("buyer_age"),
        col("in0.targeted_segment_list").as("targeted_segment_list"),
        col("in0.custom_model_id").as("custom_model_id"),
        col("in0.custom_model_last_modified").as("custom_model_last_modified"),
        col("in0.custom_model_output_code").as("custom_model_output_code"),
        col("in0.external_uid").as("external_uid"),
        col("in0.request_uuid").as("request_uuid"),
        col("in0.mobile_app_instance_id").as("mobile_app_instance_id"),
        col("in0.traffic_source_code").as("traffic_source_code"),
        col("in0.external_request_id").as("external_request_id"),
        col("in0.stitch_group_id").as("stitch_group_id"),
        col("in0.deal_type").as("deal_type"),
        col("in0.ym_floor_id").as("ym_floor_id"),
        col("in0.ym_bias_id").as("ym_bias_id"),
        col("in0.bid_priority").as("bid_priority"),
        col("in0.buyer_charges").as("buyer_charges"),
        col("in0.seller_charges").as("seller_charges"),
        col("in0.explore_disposition").as("explore_disposition"),
        col("in0.device_make_id").as("device_make_id"),
        col("in0.operating_system_family_id").as("operating_system_family_id"),
        col("in0.tag_sizes").as("tag_sizes"),
        col("in0.campaign_group_models").as("campaign_group_models"),
        col("in0.pricing_media_type").as("pricing_media_type"),
        col("in0.buyer_trx_event_id").as("buyer_trx_event_id"),
        col("in0.seller_trx_event_id").as("seller_trx_event_id"),
        col("in0.revenue_auction_event_type").as("revenue_auction_event_type"),
        col("in0.is_prebid").as("is_prebid"),
        col("in0.is_unit_of_trx").as("is_unit_of_trx"),
        col("in0.imps_for_budget_caps_pacing")
          .as("imps_for_budget_caps_pacing"),
        col("in0.auction_timestamp").as("auction_timestamp"),
        col("in0.two_phase_reduction_applied")
          .as("two_phase_reduction_applied"),
        col("in0.region_id").as("region_id"),
        col("in0.media_company_id").as("media_company_id"),
        col("in0.trade_agreement_id").as("trade_agreement_id"),
        col("in0.personal_data").as("personal_data"),
        col("in0.anonymized_user_info").as("anonymized_user_info"),
        col("in0.gdpr_consent_cookie").as("gdpr_consent_cookie"),
        col("in0.additional_clearing_events").as("additional_clearing_events"),
        col("in0.fx_rate_snapshot_id").as("fx_rate_snapshot_id"),
        col("in0.crossdevice_group_anon").as("crossdevice_group_anon"),
        col("in0.crossdevice_graph_cost").as("crossdevice_graph_cost"),
        col("in0.revenue_event_type_id").as("revenue_event_type_id"),
        col("in0.buyer_trx_event_type_id").as("buyer_trx_event_type_id"),
        col("in0.seller_trx_event_type_id").as("seller_trx_event_type_id"),
        col("in0.external_creative_id").as("external_creative_id"),
        col("in0.targeted_segment_details").as("targeted_segment_details"),
        col("in0.bidder_seat_id").as("bidder_seat_id"),
        col("in0.is_whiteops_scanned").as("is_whiteops_scanned"),
        col("in0.default_referrer_url").as("default_referrer_url"),
        col("in0.is_curated").as("is_curated"),
        col("in0.curator_member_id").as("curator_member_id"),
        col("in0.total_partner_fees_microcents")
          .as("total_partner_fees_microcents"),
        col("in0.net_buyer_spend").as("net_buyer_spend"),
        col("in0.is_prebid_server").as("is_prebid_server"),
        col("in0.cold_start_price_type").as("cold_start_price_type"),
        col("in0.discovery_state").as("discovery_state"),
        col("in0.billing_period_id").as("billing_period_id"),
        col("in0.flight_id").as("flight_id"),
        col("in0.split_id").as("split_id"),
        col("in0.net_media_cost_dollars_cpm").as("net_media_cost_dollars_cpm"),
        col("in0.total_data_costs_microcents")
          .as("total_data_costs_microcents"),
        col("in0.total_profit_microcents").as("total_profit_microcents"),
        col("in0.targeted_crossdevice_graph_id")
          .as("targeted_crossdevice_graph_id"),
        col("in0.discovery_prediction").as("discovery_prediction"),
        col("in0.campaign_group_type_id").as("campaign_group_type_id"),
        col("in0.hb_source").as("hb_source"),
        col("in0.external_campaign_id").as("external_campaign_id"),
        col("in0.excluded_targeted_segment_details")
          .as("excluded_targeted_segment_details"),
        col("in0.trust_id").as("trust_id"),
        col("in0.predicted_kpi_event_rate").as("predicted_kpi_event_rate"),
        col("in0.has_crossdevice_reach_extension")
          .as("has_crossdevice_reach_extension"),
        col("in0.crossdevice_graph_membership")
          .as("crossdevice_graph_membership"),
        col("in0.total_segment_data_costs_microcents")
          .as("total_segment_data_costs_microcents"),
        col("in0.total_feature_costs_microcents")
          .as("total_feature_costs_microcents"),
        col("in0.counterparty_ruleset_type").as("counterparty_ruleset_type"),
        col("in0.log_product_ads").as("log_product_ads"),
        col("in0.buyer_line_item_currency").as("buyer_line_item_currency"),
        col("in0.deal_line_item_currency").as("deal_line_item_currency"),
        col("in0.measurement_fee_usd").as("measurement_fee_usd"),
        col("in0.measurement_provider_member_id")
          .as("measurement_provider_member_id"),
        col("in0.offline_attribution_provider_member_id")
          .as("offline_attribution_provider_member_id"),
        col("in0.offline_attribution_cost_usd_cpm")
          .as("offline_attribution_cost_usd_cpm"),
        col("in0.pred_info").as("pred_info"),
        col("in0.imp_rejecter_do_auction").as("imp_rejecter_do_auction"),
        col("in0.personal_identifiers").as("personal_identifiers"),
        col("in0.imp_rejecter_applied").as("imp_rejecter_applied"),
        col("in0.ip_derived_latitude").as("ip_derived_latitude"),
        col("in0.ip_derived_longitude").as("ip_derived_longitude"),
        col("in0.personal_identifiers_experimental")
          .as("personal_identifiers_experimental"),
        col("in0.postal_code_ext_id").as("postal_code_ext_id"),
        col("in0.ecpm_conversion_rate").as("ecpm_conversion_rate"),
        col("in0.is_residential_ip").as("is_residential_ip"),
        col("in0.hashed_ip").as("hashed_ip"),
        col("in0.targeted_segment_details_by_id_type")
          .as("targeted_segment_details_by_id_type"),
        col("in0.offline_attribution").as("offline_attribution"),
        col("in0.frequency_cap_type_internal")
          .as("frequency_cap_type_internal"),
        col("in0.modeled_cap_did_override_line_item_daily_cap")
          .as("modeled_cap_did_override_line_item_daily_cap"),
        col("in0.modeled_cap_user_sample_rate")
          .as("modeled_cap_user_sample_rate"),
        col("in0.estimated_audience_imps").as("estimated_audience_imps"),
        col("in0.audience_imps").as("audience_imps"),
        col("in0.district_postal_code_lists").as("district_postal_code_lists"),
        col("in0.bidding_host_id").as("bidding_host_id"),
        col("in0.buyer_dpvp_bitmap").as("buyer_dpvp_bitmap"),
        col("in0.seller_dpvp_bitmap").as("seller_dpvp_bitmap"),
        col("in0.browser_code_id").as("browser_code_id"),
        col("in0.is_prebid_server_included").as("is_prebid_server_included"),
        col("in0.feature_tests_bitmap").as("feature_tests_bitmap"),
        col("in0.private_auction_eligible").as("private_auction_eligible"),
        col("in0.chrome_traffic_label").as("chrome_traffic_label"),
        col("in0.is_private_auction").as("is_private_auction"),
        col("in0.creative_media_subtype_id").as("creative_media_subtype_id"),
        col("in0.allowed_media_types").as("allowed_media_types")
      )

}
