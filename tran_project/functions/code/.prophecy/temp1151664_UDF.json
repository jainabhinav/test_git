{"initCode":"","code":"udf((_l_term_id: Integer, _term_id: Integer, _l_pricing_terms: Seq[Row], _i: Integer) => {\n  var term_id = _term_id\nvar i = _i \nvar l_pricing_term = Row(null, null, null, null, null, null)\nvar l_pricing_terms = (_l_pricing_terms).toArray\nvar l_term_id = _l_term_id\n\nwhile(compareTo(i, l_pricing_terms.length) < 0) {\nl_term_id = 0\nif(!_isnull(l_pricing_terms(convertToInt(i)).getAs[Integer](\"term_id\"))){\nl_term_id = convertToInt(l_pricing_terms(convertToInt(i)).getAs[Integer](\"term_id\"))\n}\nif(l_term_id == term_id){\nl_pricing_term = l_pricing_terms(convertToInt(i))\n}\ni = i + convertToInt(1)\n}\n\nRow(if (!_isnull(l_pricing_term)) {\n Row(convertToInt(l_pricing_term.get(0)), l_pricing_term.get(1), l_pricing_term.get(2), l_pricing_term.get(3), l_pricing_term.get(4), convertToInt(l_pricing_term.get(5)))\n} else {\n null\n}, convertToInt(i), convertToInt(l_term_id))\n},  StructType(\n      List(\n      StructField(\"l_pricing_term\",  StructType(\n      List(\n      StructField(\"term_id\", IntegerType, true),StructField(\"amount\", DoubleType, true),StructField(\"rate\", DoubleType, true),StructField(\"is_deduction\", BooleanType, true),StructField(\"is_media_cost_dependent\", BooleanType, true),StructField(\"data_member_id\", IntegerType, true)\n      )\n    ), false),StructField(\"i\", IntegerType, false),StructField(\"l_term_id\", IntegerType, false)\n      )\n    ))"}