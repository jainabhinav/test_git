{"initCode":"","code":"udf((_l_total_tech_fees: Double, _i: Integer, _l_is_deduction: Integer, _l_pricing_terms: Seq[Row], _l_term_id: Integer) => {\n  var l_total_tech_fees = _l_total_tech_fees\nvar i = _i \nvar l_is_deduction = _l_is_deduction\nvar l_pricing_terms = (_l_pricing_terms).toArray\nvar l_term_id = _l_term_id\n\nwhile(compareTo(i, l_pricing_terms.length) < 0) {\nl_term_id = 0\nl_is_deduction = 0\nif(!_isnull(l_pricing_terms(convertToInt(i)).getAs[Integer](\"term_id\"))){\nl_term_id = convertToInt(l_pricing_terms(convertToInt(i)).getAs[Integer](\"term_id\"))\n}\nif(!_isnull(l_pricing_terms(convertToInt(i)).getAs[Boolean](\"is_deduction\"))){\nl_is_deduction = convertToInt(l_pricing_terms(convertToInt(i)).getAs[Boolean](\"is_deduction\"))\n}\nif(Array(99, 89, 88, 85, 86).contains(l_term_id) && (l_is_deduction == 1)){\nif(!_isnull(l_pricing_terms(convertToInt(i)).getAs[Double](\"amount\"))){\nl_total_tech_fees = l_total_tech_fees + l_pricing_terms(convertToInt(i)).getAs[Double](\"amount\")\n}\n}\ni = i + convertToInt(1)\n}\n\nRow(l_total_tech_fees, convertToInt(l_is_deduction), convertToInt(i), convertToInt(l_term_id))\n},  StructType(\n      List(\n      StructField(\"l_total_tech_fees\", DoubleType, false),StructField(\"l_is_deduction\", IntegerType, false),StructField(\"i\", IntegerType, false),StructField(\"l_term_id\", IntegerType, false)\n      )\n    ))"}