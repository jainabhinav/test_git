{"parameters":[{"name":"curator_member_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"discrepancy_allowance","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"should_process_views","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"buyer_member_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"imps_for_budget_caps_pacing","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"imp_type","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"is_curated","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"view_detection_enabled","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"buyer_trx_event_type_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"commission_revshare","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"creative_overage_fees","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"viewdef_definition_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"virtual_log_dw_bid","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"has_buyer_transacted","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"payment_type_normalized","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"seller_trx_event_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"seller_revenue_cpm","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"insertion_order_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"revenue_type_normalized","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"billing_period_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"viewdef_viewable","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"split_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"data_costs_deal","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"f_preempt_over_impression_94298","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"commission_cpm","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"v_transaction_event_pricing","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"buyer_trx_event_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"campaign_group_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"has_seller_transacted","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"revenue_value","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"netflix_ppid","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"campaign_group_type_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"should_zero_seller_revenue","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"view_measurable","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"advertiser_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"media_cost_dollars_cpm","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"creative_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"f_preempt_over_impression_95337","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"flight_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"viewable","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"auction_service_deduction","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"media_buy_cost","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"seller_deduction","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"buyer_spend_cpm","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"seller_trx_event_type_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"auction_service_fees","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"serving_fees_cpm","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"data_costs","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"sup_ip_range_lookup_count","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"ttl","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"view_result","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"is_dw_normalized","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"booked_revenue_adv_curr","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"booked_revenue_dollars","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"deal_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"_f_is_buy_side","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"deal_type","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"campaign_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"is_placeholder_bid","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"serving_fees_revshare","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"view_non_measurable_reason","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"_f_is_default_or_error_imp","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"_f_is_error_imp","type":"column","metadata":{"description":"","tags":[],"mappings":[]}}],"isCustomSchemaEnabled":false,"code":"val virtual_log_dw_bid_creative_freq = when(\n    _f_is_buy_side === lit(0),\n    when(\n      isnull(col(\"log_dw_bid\")) and\n        (_f_is_error_imp === lit(1) or (is_not_null(col(\"is_dw\").cast(IntegerType)) and\n          col(\"is_dw\").cast(IntegerType) === lit(1) and imp_type.isin(lit(2), lit(4)))),\n      lit(-2)\n    ).otherwise(\n      when(\n        _f_is_default_or_error_imp === lit(1),\n        when(col(\"log_dw_bid\").isNotNull, col(\"log_dw_bid\").getField(\"creative_freq\"))\n          .when(_f_is_default_or_error_imp === lit(1),lit(-2))\n          .when(_f_is_error_imp === lit(1),lit(null).cast(IntegerType))\n          .otherwise(lit(null).cast(IntegerType))\n      ).otherwise(\n        when(imp_type.isin(lit(5), lit(9), lit(2)), col(\"log_dw_bid\").getField(\"creative_freq\")).otherwise(lit(-1))\n      )\n    )\n  ).otherwise(lit(null).cast(IntegerType))\n\n  val virtual_log_dw_bid_creative_rec = when(\n    _f_is_buy_side === lit(0),\n    when(\n      isnull(col(\"log_dw_bid\")) and\n        (_f_is_error_imp === lit(1) or (is_not_null(col(\"is_dw\").cast(IntegerType)) and\n          col(\"is_dw\").cast(IntegerType) === lit(1) and imp_type.isin(lit(2), lit(4)))),\n      lit(-2)\n    ).otherwise(\n      when(\n        _f_is_default_or_error_imp === lit(1),\n        when(col(\"log_dw_bid\").isNotNull, col(\"log_dw_bid\").getField(\"creative_rec\"))\n          .when(_f_is_default_or_error_imp === lit(1),lit(-2))\n          .when(_f_is_error_imp === lit(1),lit(null).cast(IntegerType))\n          .otherwise(lit(null).cast(IntegerType))\n      ).otherwise(\n        when(imp_type.isin(lit(5), lit(9), lit(2)), col(\"log_dw_bid\").getField(\"creative_rec\")).otherwise(lit(-1))\n      )\n    )\n  ).otherwise(lit(null).cast(IntegerType))\n\n  val virtual_log_dw_bid_advertiser_freq = when(\n    _f_is_buy_side === lit(0),\n    when(\n      isnull(col(\"log_dw_bid\")) and\n        (_f_is_error_imp === lit(1) or (is_not_null(col(\"is_dw\").cast(IntegerType)) and\n          col(\"is_dw\").cast(IntegerType) === lit(1) and imp_type.isin(lit(2), lit(4)))),\n      lit(-2)\n    ).otherwise(\n      when(\n        _f_is_default_or_error_imp === lit(1),\n        when(col(\"log_dw_bid\").isNotNull, col(\"log_dw_bid\").getField(\"advertiser_freq\"))\n          .when(_f_is_default_or_error_imp === lit(1),lit(-2))\n          .when(_f_is_error_imp === lit(1),lit(null).cast(IntegerType))\n          .otherwise(lit(null).cast(IntegerType))\n      ).otherwise(\n        when(imp_type.isin(lit(5), lit(9), lit(2)), col(\"log_dw_bid\").getField(\"advertiser_freq\")).otherwise(lit(-1))\n      )\n    )\n  ).otherwise(lit(null).cast(IntegerType))\n\n  val virtual_log_dw_bid_advertiser_rec = when(\n    _f_is_buy_side === lit(0),\n    when(\n      isnull(col(\"log_dw_bid\")) and\n        (_f_is_error_imp === lit(1) or (is_not_null(col(\"is_dw\").cast(IntegerType)) and\n          col(\"is_dw\").cast(IntegerType) === lit(1) and imp_type.isin(lit(2), lit(4)))),\n      lit(-2)\n    ).otherwise(\n      when(\n        _f_is_default_or_error_imp === lit(1),\n        when(col(\"log_dw_bid\").isNotNull, col(\"log_dw_bid\").getField(\"advertiser_rec\"))\n          .when(_f_is_default_or_error_imp === lit(1),lit(-2))\n          .when(_f_is_error_imp === lit(1),lit(null).cast(IntegerType))\n          .otherwise(lit(null).cast(IntegerType))\n      ).otherwise(\n        when(imp_type.isin(lit(5), lit(9), lit(2)), col(\"log_dw_bid\").getField(\"advertiser_rec\")).otherwise(lit(-1))\n      )\n    )\n  ).otherwise(lit(null).cast(IntegerType))\n\n  val virtual_log_dw_bid_log_type = when(\n    _f_is_buy_side === lit(0),\n    when(\n      isnull(col(\"log_dw_bid\")) and\n        (_f_is_error_imp === lit(1) or (is_not_null(col(\"is_dw\").cast(IntegerType)) and\n          col(\"is_dw\").cast(IntegerType) === lit(1) and imp_type.isin(lit(2), lit(4)))),\n      lit(null).cast(IntegerType)\n    ).otherwise(\n      when(\n        _f_is_default_or_error_imp === lit(1),\n        when(col(\"log_dw_bid\").isNotNull, col(\"log_dw_bid\").getField(\"log_type\"))\n          .when(_f_is_default_or_error_imp === lit(1),lit(null).cast(IntegerType))\n          .when(_f_is_error_imp === lit(1),lit(null).cast(IntegerType))\n          .otherwise(lit(null).cast(IntegerType))\n      ).otherwise(\n        when(imp_type.isin(lit(5), lit(9), lit(2)), col(\"log_dw_bid\").getField(\"log_type\")).otherwise(lit(2))\n      )\n    )\n  ).otherwise(lit(null).cast(IntegerType))\n\n  val virtual_log_dw_bid_pricing_type = when(\n    _f_is_buy_side === lit(0),\n    when(\n      isnull(col(\"log_dw_bid\")) and\n        (_f_is_error_imp === lit(1) or (is_not_null(col(\"is_dw\").cast(IntegerType)) and\n          col(\"is_dw\").cast(IntegerType) === lit(1) and imp_type.isin(lit(2), lit(4)))),\n      lit(\"---\")\n    ).otherwise(\n      when(\n        _f_is_default_or_error_imp === lit(1),\n        when(col(\"log_dw_bid\").isNotNull, col(\"log_dw_bid\").getField(\"pricing_type\"))\n          .when(_f_is_default_or_error_imp === lit(1),lit(null).cast(StringType))\n          .when(_f_is_error_imp === lit(1),lit(\"---\"))\n          .otherwise(lit(null).cast(StringType))\n      ).otherwise(\n        when(imp_type.isin(lit(5), lit(9), lit(2)), col(\"log_dw_bid\").getField(\"pricing_type\")).otherwise(lit(\"---\"))\n      )\n    )\n  ).otherwise(lit(null).cast(StringType))\n\n  val virtual_log_dw_bid_is_control = when(\n    _f_is_buy_side === lit(0),\n    when(\n      isnull(col(\"log_dw_bid\")) and\n        (_f_is_error_imp === lit(1) or (is_not_null(col(\"is_dw\").cast(IntegerType)) and\n          col(\"is_dw\").cast(IntegerType) === lit(1) and imp_type.isin(lit(2), lit(4)))),\n      lit(2)\n    ).otherwise(\n      when(\n        _f_is_default_or_error_imp === lit(1),\n        when(col(\"log_dw_bid\").isNotNull, col(\"log_dw_bid\").getField(\"is_control\"))\n          .when(_f_is_default_or_error_imp === lit(1),lit(null).cast(IntegerType))\n          .when(_f_is_error_imp === lit(1),lit(2).cast(IntegerType))\n          .otherwise(lit(null).cast(IntegerType))\n      ).otherwise(\n        when(imp_type.isin(lit(5), lit(9), lit(2)), col(\"log_dw_bid\").getField(\"is_control\")).otherwise(lit(null).cast(IntegerType))\n      )\n    )\n  ).otherwise(lit(null).cast(IntegerType))\n\n  val virtual_log_dw_bid_cadence_modifier = when(\n    _f_is_buy_side === lit(0),\n    when(\n      isnull(col(\"log_dw_bid\")) and\n        (_f_is_error_imp === lit(1) or (is_not_null(col(\"is_dw\").cast(IntegerType)) and\n          col(\"is_dw\").cast(IntegerType) === lit(1) and imp_type.isin(lit(2), lit(4)))),\n      lit(1.0)\n    ).otherwise(\n      when(\n        _f_is_default_or_error_imp === lit(1),\n        when(col(\"log_dw_bid\").isNotNull, col(\"log_dw_bid\").getField(\"cadence_modifier\"))\n          .when(_f_is_default_or_error_imp === lit(1),lit(0).cast(DoubleType))\n          .when(_f_is_error_imp === lit(1),lit(1).cast(DoubleType))\n          .otherwise(lit(null).cast(DoubleType))\n      ).otherwise(\n        when(imp_type.isin(lit(5), lit(9), lit(2)), col(\"log_dw_bid\").getField(\"cadence_modifier\")).otherwise(lit(null).cast(DoubleType))\n      )\n    )\n  ).otherwise(lit(null).cast(DoubleType))\n\n  val virtual_log_dw_bid_predict_type = when(\n    _f_is_buy_side === lit(0),\n    when(\n      isnull(col(\"log_dw_bid\")) and\n        (_f_is_error_imp === lit(1) or (is_not_null(col(\"is_dw\").cast(IntegerType)) and\n          col(\"is_dw\").cast(IntegerType) === lit(1) and imp_type.isin(lit(2), lit(4)))),\n      lit(-1)\n    ).otherwise(\n      when(\n        _f_is_default_or_error_imp === lit(1),\n        when(col(\"log_dw_bid\").isNotNull, col(\"log_dw_bid\").getField(\"predict_type\"))\n          .when(_f_is_default_or_error_imp === lit(1),lit(null).cast(IntegerType))\n          .when(_f_is_error_imp === lit(1),lit(-1).cast(IntegerType))\n          .otherwise(lit(null).cast(IntegerType))\n      ).otherwise(\n        when(imp_type.isin(lit(5), lit(9), lit(2)), col(\"log_dw_bid\").getField(\"predict_type\")).otherwise(lit(-2).cast(IntegerType))\n      )\n    )\n  ).otherwise(lit(null).cast(IntegerType))\n\n  val virtual_log_dw_bid_predict_type_goal = when(\n    _f_is_buy_side === lit(0),\n    when(\n      isnull(col(\"log_dw_bid\")) and\n        (_f_is_error_imp === lit(1) or (is_not_null(col(\"is_dw\").cast(IntegerType)) and\n          col(\"is_dw\").cast(IntegerType) === lit(1) and imp_type.isin(lit(2), lit(4)))),\n      lit(-1)\n    ).otherwise(\n      when(\n        _f_is_default_or_error_imp === lit(1),\n        when(col(\"log_dw_bid\").isNotNull, col(\"log_dw_bid\").getField(\"predict_type_goal\"))\n          .when(_f_is_default_or_error_imp === lit(1),lit(null).cast(IntegerType))\n          .when(_f_is_error_imp === lit(1),lit(-1).cast(IntegerType))\n          .otherwise(lit(null).cast(IntegerType))\n      ).otherwise(\n        when(imp_type.isin(lit(5), lit(9), lit(2)), col(\"log_dw_bid\").getField(\"predict_type_goal\")).otherwise(lit(-2).cast(IntegerType))\n      )\n    )\n  ).otherwise(lit(null).cast(IntegerType))\n\n  val virtual_log_dw_bid_campaign_group_freq = when(\n    _f_is_buy_side === lit(0),\n    when(\n      isnull(col(\"log_dw_bid\")) and\n        (_f_is_error_imp === lit(1) or (is_not_null(col(\"is_dw\").cast(IntegerType)) and\n          col(\"is_dw\").cast(IntegerType) === lit(1) and imp_type.isin(lit(2), lit(4)))),\n      lit(-2)\n    ).otherwise(\n      when(\n        _f_is_default_or_error_imp === lit(1),\n        when(col(\"log_dw_bid\").isNotNull, col(\"log_dw_bid\").getField(\"campaign_group_freq\"))\n          .when(_f_is_default_or_error_imp === lit(1),lit(-2))\n          .when(_f_is_error_imp === lit(1),lit(null).cast(IntegerType))\n          .otherwise(lit(null).cast(IntegerType))\n      ).otherwise(\n        when(imp_type.isin(lit(5), lit(9), lit(2)), col(\"log_dw_bid\").getField(\"campaign_group_freq\")).otherwise(lit(-1))\n      )\n    )\n  ).otherwise(lit(null).cast(IntegerType))\n\n  val virtual_log_dw_bid_campaign_group_rec = when(\n    _f_is_buy_side === lit(0),\n    when(\n      isnull(col(\"log_dw_bid\")) and\n        (_f_is_error_imp === lit(1) or (is_not_null(col(\"is_dw\").cast(IntegerType)) and\n          col(\"is_dw\").cast(IntegerType) === lit(1) and imp_type.isin(lit(2), lit(4)))),\n      lit(-2)\n    ).otherwise(\n      when(\n        _f_is_default_or_error_imp === lit(1),\n        when(col(\"log_dw_bid\").isNotNull, col(\"log_dw_bid\").getField(\"campaign_group_rec\"))\n          .when(_f_is_default_or_error_imp === lit(1),lit(-2))\n          .when(_f_is_error_imp === lit(1),lit(null).cast(IntegerType))\n          .otherwise(lit(null).cast(IntegerType))\n      ).otherwise(\n        when(imp_type.isin(lit(5), lit(9), lit(2)), col(\"log_dw_bid\").getField(\"campaign_group_rec\")).otherwise(lit(-1).cast(IntegerType))\n      )\n    )\n  ).otherwise(lit(null).cast(IntegerType))\n\n  val virtual_log_dw_bid_insertion_order_freq = when(\n    _f_is_buy_side === lit(0),\n    when(\n      isnull(col(\"log_dw_bid\")) and\n        (_f_is_error_imp === lit(1) or (is_not_null(col(\"is_dw\").cast(IntegerType)) and\n          col(\"is_dw\").cast(IntegerType) === lit(1) and imp_type.isin(lit(2), lit(4)))),\n      lit(-2)\n    ).otherwise(\n      when(\n        _f_is_default_or_error_imp === lit(1),\n        when(col(\"log_dw_bid\").isNotNull, col(\"log_dw_bid\").getField(\"insertion_order_freq\"))\n          .when(_f_is_default_or_error_imp === lit(1),lit(-2))\n          .when(_f_is_error_imp === lit(1),lit(null).cast(IntegerType))\n          .otherwise(lit(null).cast(IntegerType))\n      ).otherwise(\n        when(imp_type.isin(lit(5), lit(9), lit(2)), col(\"log_dw_bid\").getField(\"insertion_order_freq\")).otherwise(lit(-1).cast(IntegerType))\n      )\n    )\n  ).otherwise(lit(null).cast(IntegerType))\n\n  val virtual_log_dw_bid_insertion_order_rec = when(\n    _f_is_buy_side === lit(0),\n    when(\n      isnull(col(\"log_dw_bid\")) and\n        (_f_is_error_imp === lit(1) or (is_not_null(col(\"is_dw\").cast(IntegerType)) and\n          col(\"is_dw\").cast(IntegerType) === lit(1) and imp_type.isin(lit(2), lit(4)))),\n      lit(-2)\n    ).otherwise(\n      when(\n        _f_is_default_or_error_imp === lit(1),\n        when(col(\"log_dw_bid\").isNotNull, col(\"log_dw_bid\").getField(\"insertion_order_rec\"))\n          .when(_f_is_default_or_error_imp === lit(1),lit(-2))\n          .when(_f_is_error_imp === lit(1),lit(null).cast(IntegerType))\n          .otherwise(lit(null).cast(IntegerType))\n      ).otherwise(\n        when(imp_type.isin(lit(5), lit(9), lit(2)), col(\"log_dw_bid\").getField(\"insertion_order_rec\")).otherwise(lit(-1).cast(IntegerType))\n      )\n    )\n  ).otherwise(lit(null).cast(IntegerType))\n\n  val virtual_log_dw_bid_custom_model_output_code = when(\n    _f_is_buy_side === lit(0),\n    when(\n      isnull(col(\"log_dw_bid\")) and\n        (_f_is_error_imp === lit(1) or (is_not_null(col(\"is_dw\").cast(IntegerType)) and\n          col(\"is_dw\").cast(IntegerType) === lit(1) and imp_type.isin(lit(2), lit(4)))),\n      lit(\"--\")\n    ).otherwise(\n      when(\n        _f_is_default_or_error_imp === lit(1),\n        when(col(\"log_dw_bid\").isNotNull, col(\"log_dw_bid\").getField(\"custom_model_output_code\"))\n          .when(_f_is_default_or_error_imp === lit(1),lit(null).cast(StringType))\n          .when(_f_is_error_imp === lit(1),lit(null).cast(StringType))\n          .otherwise(lit(null).cast(StringType))\n      ).otherwise(\n        when(imp_type.isin(lit(5), lit(9), lit(2)), col(\"log_dw_bid\").getField(\"custom_model_output_code\")).otherwise(lit(\"---\").cast(StringType))\n      )\n    )\n  ).otherwise(lit(null).cast(StringType))\n\n  val virtual_log_dw_bid_revenue_auction_event_type = when(\n    _f_is_buy_side === lit(0),\n    when(\n      isnull(col(\"log_dw_bid\")) and\n        (_f_is_error_imp === lit(1) or (is_not_null(col(\"is_dw\").cast(IntegerType)) and\n          col(\"is_dw\").cast(IntegerType) === lit(1) and imp_type.isin(lit(2), lit(4)))),\n      lit(0).cast(IntegerType)\n    ).otherwise(\n      when(\n        _f_is_default_or_error_imp === lit(1),\n        when(col(\"log_dw_bid\").isNotNull, col(\"log_dw_bid\").getField(\"revenue_auction_event_type\"))\n          .when(_f_is_default_or_error_imp === lit(1),lit(null).cast(IntegerType))\n          .when(_f_is_error_imp === lit(1),lit(null).cast(IntegerType))\n          .otherwise(lit(null).cast(IntegerType))\n      ).otherwise(\n        when(imp_type.isin(lit(5), lit(9), lit(2)), col(\"log_dw_bid\").getField(\"revenue_auction_event_type\")).otherwise(seller_trx_event_id.cast(IntegerType))\n      )\n    )\n  ).otherwise(lit(null).cast(IntegerType))\n\n  struct(\n    coalesce(\n      col(\"log_dw_view.date_time\").cast(LongType),\n      when((ttl > lit(3600)).and(\n        is_not_null(col(\"log_impbus_preempt.date_time\").cast(LongType))\n      ),\n        col(\"log_impbus_preempt.date_time\").cast(LongType)\n      ),\n      col(\"date_time\").cast(LongType)\n    ).as(\"date_time\"),\n    col(\"auction_id_64\").cast(LongType).as(\"auction_id_64\"),\n    coalesce(\n      when(col(\"log_dw_view.user_id_64\").cast(LongType) =!= lit(0),\n        col(\"log_dw_view.user_id_64\").cast(LongType)\n      ),\n      when(col(\"log_impbus_impressions.user_id_64\").cast(LongType) =!= lit(0),\n        col(\"log_impbus_impressions.user_id_64\").cast(LongType)\n      )\n    ).as(\"user_id_64\"),\n    when(col(\"log_impbus_impressions.tag_id\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.tag_id\").cast(IntegerType)\n    ).as(\"tag_id\"),\n    when(col(\"log_impbus_impressions.venue_id\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.venue_id\").cast(IntegerType)\n    ).as(\"venue_id\"),\n    when(col(\"log_impbus_impressions.inventory_source_id\").cast(\n      IntegerType\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.inventory_source_id\").cast(IntegerType)\n    ).as(\"inventory_source_id\"),\n    lit(null).cast(IntegerType).as(\"session_frequency\"),\n    when(string_compare(col(\"log_impbus_impressions.site_domain\"),\n      lit(\"---\")\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.site_domain\")\n    ).as(\"site_domain\"),\n    f_preempt_over_impression_non_zero_explicit(\n      is_not_null(col(\"log_impbus_preempt\")),\n      col(\"log_impbus_impressions.width\").cast(IntegerType),\n      col(\"log_impbus_preempt.width\").cast(IntegerType)\n    ).as(\"width\"),\n    f_preempt_over_impression_non_zero_explicit(\n      is_not_null(col(\"log_impbus_preempt\")),\n      col(\"log_impbus_impressions.height\").cast(IntegerType),\n      col(\"log_impbus_preempt.height\").cast(IntegerType)\n    ).as(\"height\"),\n    when(string_compare(col(\"log_impbus_impressions.geo_country\"),\n      lit(\"--\")\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.geo_country\")\n    ).as(\"geo_country\"),\n    when(string_compare(col(\"log_impbus_impressions.geo_region\"),\n      lit(\"--\")\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.geo_region\")\n    ).as(\"geo_region\"),\n    when(string_compare(col(\"log_impbus_impressions.gender\"),\n      lit(\"u\")\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.gender\")\n    ).as(\"gender\"),\n    when(col(\"log_impbus_impressions.age\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.age\").cast(IntegerType)\n    ).as(\"age\"),\n    col(\"seller_member_id\").cast(IntegerType).as(\"seller_member_id\"),\n    when(col(\"imp_type\").cast(IntegerType) =!= lit(1), buyer_member_id)\n      .otherwise(lit(0))\n      .as(\"buyer_member_id\"),\n    creative_id.as(\"creative_id\"),\n    when(string_compare(col(\"log_impbus_impressions.seller_currency\"),\n      lit(\"\")\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.seller_currency\")\n    ).as(\"seller_currency\"),\n    when(string_compare(col(\"log_impbus_impressions.buyer_currency\"),\n      lit(\"\")\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.buyer_currency\")\n    ).as(\"buyer_currency\"),\n    f_preempt_over_impression_non_zero_explicit(\n      is_not_null(col(\"log_impbus_preempt\")),\n      col(\"log_impbus_impressions.buyer_bid\"),\n      col(\"log_impbus_preempt.buyer_bid\")\n    ).as(\"buyer_bid\"),\n    coalesce(when(imp_type.isin(lit(8), lit(1), lit(3)), lit(0)),\n      when(imp_type === lit(5), col(\"log_dw_bid.price\")),\n      buyer_spend_cpm\n    ).as(\"buyer_spend\"),\n    when(col(\"log_impbus_impressions.ecp\") =!= lit(0),\n      col(\"log_impbus_impressions.ecp\")\n    ).as(\"ecp\"),\n    when(col(\"log_impbus_impressions.reserve_price\") =!= lit(0.0d),\n      col(\"log_impbus_impressions.reserve_price\")\n    ).as(\"reserve_price\"),\n    coalesce(when((col(\"imp_type\").cast(IntegerType) === lit(1))\n      .or(buyer_member_id === lit(0))\n      .and(is_not_null(advertiser_id)),\n      lit(0)\n    ),\n      advertiser_id\n    ).as(\"advertiser_id\"),\n    coalesce(when((col(\"imp_type\").cast(IntegerType) === lit(1))\n      .or(buyer_member_id === lit(0))\n      .and(is_not_null(campaign_group_id)),\n      lit(0)\n    ),\n      campaign_group_id\n    ).as(\"campaign_group_id\"),\n    coalesce(\n      when((col(\"imp_type\").cast(IntegerType) === lit(1))\n        .or(buyer_member_id === lit(0))\n        .and(is_not_null(campaign_id)),\n        lit(0)\n      ),\n      when((imp_type =!= lit(6)).and(campaign_id =!= lit(0)), campaign_id)\n    ).as(\"campaign_id\"),\n    coalesce(\n      when((_f_is_buy_side === lit(1)).and(\n        col(\"log_dw_bid.creative_freq\").cast(IntegerType) =!= lit(0)\n      ),\n        col(\"log_dw_bid.creative_freq\").cast(IntegerType)\n      ),\n      when(_f_is_buy_side === lit(0),\n        virtual_log_dw_bid_creative_freq\n      )\n    ).as(\"creative_freq\"),\n    coalesce(\n      when((_f_is_buy_side === lit(1)).and(\n        col(\"log_dw_bid.creative_rec\").cast(IntegerType) =!= lit(0)\n      ),\n        col(\"log_dw_bid.creative_rec\").cast(IntegerType)\n      ),\n      when(_f_is_buy_side === lit(0),\n        virtual_log_dw_bid_creative_rec\n      )\n    ).as(\"creative_rec\"),\n    coalesce(\n      when((_f_is_buy_side === lit(1)).and(\n        col(\"log_dw_bid.predict_type\").cast(IntegerType) === lit(1)\n      ),\n        lit(1)\n      ),\n      when(\n        (_f_is_buy_side === lit(1)).and(\n          (col(\"log_dw_bid.predict_type\").cast(IntegerType) === lit(0)).or(\n            (col(\"log_dw_bid.predict_type\").cast(IntegerType) >= lit(2)).and(\n              col(\"log_dw_bid.predict_type\").cast(IntegerType) =!= lit(9)\n            )\n          )\n        ),\n        lit(2)\n      ),\n      lit(0)\n    ).as(\"is_learn\"),\n    when((_f_is_buy_side === lit(1)).and(\n      col(\"log_dw_bid.is_remarketing\").cast(IntegerType) =!= lit(0)\n    ),\n      col(\"log_dw_bid.is_remarketing\").cast(IntegerType)\n    ).as(\"is_remarketing\"),\n    coalesce(\n      when((_f_is_buy_side === lit(1)).and(\n        col(\"log_dw_bid.advertiser_freq\").cast(IntegerType) =!= lit(0)\n      ),\n        col(\"log_dw_bid.advertiser_freq\").cast(IntegerType)\n      ),\n      when((_f_is_buy_side === lit(1)).and(imp_type === lit(9)), lit(0)),\n      when(_f_is_buy_side === lit(0),\n        virtual_log_dw_bid_advertiser_freq\n      )\n    ).as(\"advertiser_frequency\"),\n    coalesce(\n      when((_f_is_buy_side === lit(1)).and(\n        col(\"log_dw_bid.advertiser_rec\").cast(IntegerType) =!= lit(0)\n      ),\n        col(\"log_dw_bid.advertiser_rec\").cast(IntegerType)\n      ),\n      when((_f_is_buy_side === lit(1)).and(imp_type === lit(9)), lit(0)),\n      when(_f_is_buy_side === lit(0),\n        virtual_log_dw_bid_advertiser_rec\n      )\n    ).as(\"advertiser_recency\"),\n    coalesce(\n      when(col(\"log_impbus_impressions.user_id_64\").cast(LongType) > lit(\n        9223372036854775807L\n      ).cast(LongType),\n        lit(-1)\n      ),\n      when(\n        (is_placeholder_bid === lit(1))\n          .or(col(\"imp_type\").cast(IntegerType) === lit(1))\n          .or(col(\"imp_type\").cast(IntegerType) === lit(3))\n          .or(imp_type === lit(8))\n          .and(\n            is_not_null(\n              col(\"log_impbus_impressions.user_id_64\").cast(LongType)\n            )\n          ),\n        col(\"log_impbus_impressions.user_id_64\").cast(LongType) % lit(1000)\n      ),\n      when(\n        (virtual_log_dw_bid_log_type === lit(2)).or(\n          is_not_null(col(\"log_dw_bid.log_type\").cast(IntegerType))\n            .and(col(\"log_dw_bid.log_type\").cast(IntegerType) === lit(2))\n        ),\n        col(\"log_impbus_impressions.user_group_id\").cast(IntegerType)\n      ),\n      col(\"log_dw_bid.user_group_id\").cast(IntegerType)\n    ).as(\"user_group_id\"),\n    lit(null).cast(IntegerType).as(\"camp_dp_id\"),\n    coalesce(when(imp_type.isin(lit(8), lit(1), lit(3)), lit(0)),\n      col(\"publisher_id\").cast(IntegerType)\n    ).as(\"media_buy_id\"),\n    media_buy_cost.as(\"media_buy_cost\"),\n    f_preempt_over_impression_non_zero_explicit(\n      is_not_null(col(\"log_impbus_preempt\")),\n      col(\"log_impbus_impressions.brand_id\").cast(IntegerType),\n      col(\"log_impbus_preempt.brand_id\").cast(IntegerType)\n    ).as(\"brand_id\"),\n    f_preempt_over_impression_non_zero_explicit(\n      is_not_null(col(\"log_impbus_preempt\")),\n      col(\"log_impbus_impressions.cleared_direct\").cast(IntegerType),\n      col(\"log_impbus_preempt.cleared_direct\").cast(IntegerType)\n    ).as(\"cleared_direct\"),\n    lit(null).cast(DoubleType).as(\"clear_fees\"),\n    when(imp_type =!= lit(9),\n      col(\"log_impbus_impressions.media_buy_rev_share_pct\")\n    ).otherwise(col(\"log_dw_bid.media_buy_rev_share_pct\"))\n      .as(\"media_buy_rev_share_pct\"),\n    revenue_value.as(\"revenue_value\"),\n    coalesce(\n      when(\n        (_f_is_buy_side === lit(1)).and(\n          string_compare(col(\"log_dw_bid.pricing_type\"), lit(\"--\")) =!= lit(0)\n        ),\n        col(\"log_dw_bid.pricing_type\")\n      ),\n      when(_f_is_buy_side === lit(0),\n        virtual_log_dw_bid_pricing_type\n      )\n    ).as(\"pricing_type\"),\n    when((_f_is_buy_side === lit(1))\n      .and(col(\"log_dw_bid.can_convert\").cast(IntegerType) =!= lit(0)),\n      col(\"log_dw_bid.can_convert\").cast(IntegerType)\n    ).as(\"can_convert\"),\n    coalesce(\n      when(\n        (is_placeholder_bid === lit(1))\n          .or(col(\"imp_type\").cast(IntegerType) === lit(1))\n          .or(col(\"imp_type\").cast(IntegerType) === lit(3))\n          .or(imp_type === lit(8)),\n        lit(0)\n      ),\n      col(\"log_impbus_impressions.pub_rule_id\").cast(IntegerType)\n    ).as(\"pub_rule_id\"),\n    coalesce(\n      when((_f_is_buy_side === lit(1))\n        .and(col(\"log_dw_bid.is_control\").cast(IntegerType) =!= lit(0)),\n        col(\"log_dw_bid.is_control\").cast(IntegerType)\n      ),\n      when((_f_is_buy_side === lit(0))\n        .and(virtual_log_dw_bid_is_control =!= lit(0)),\n        virtual_log_dw_bid_is_control\n      )\n    ).as(\"is_control\"),\n    when(col(\"log_dw_bid.control_pct\") =!= lit(0),\n      col(\"log_dw_bid.control_pct\")\n    ).as(\"control_pct\"),\n    when(col(\"log_dw_bid.control_creative_id\").cast(IntegerType) =!= lit(0),\n      col(\"log_dw_bid.control_creative_id\").cast(IntegerType)\n    ).as(\"control_creative_id\"),\n    lit(null).cast(DoubleType).as(\"predicted_cpm\"),\n    coalesce(\n      when(\n        (_f_is_buy_side === lit(1)).and(col(\"log_dw_bid.price\") > lit(999)),\n        lit(999)\n      ),\n      when(\n        (_f_is_buy_side === lit(1)).and(col(\"log_dw_bid.price\") <= lit(999)),\n        col(\"log_dw_bid.price\")\n      ),\n      lit(0)\n    ).as(\"actual_bid\"),\n    when(col(\"log_impbus_impressions.site_id\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.site_id\").cast(IntegerType)\n    ).as(\"site_id\"),\n    when(col(\"log_impbus_impressions.content_category_id\").cast(\n      IntegerType\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.content_category_id\").cast(IntegerType)\n    ).as(\"content_category_id\"),\n    coalesce(\n      when((imp_type === lit(6))\n        .and(is_dw_normalized === lit(1))\n        .and(should_process_views === lit(1)),\n        lit(0)\n      ),\n      when((imp_type === lit(7))\n        .and(is_dw_normalized === lit(1))\n        .and(should_process_views === lit(1)),\n        auction_service_fees\n      ),\n      when((imp_type === lit(7))\n        .and(is_dw_normalized === lit(0))\n        .and(should_process_views === lit(1)),\n        auction_service_fees\n      ),\n      when(f_is_non_cpm_payment_or_payment(imp_type,\n        payment_type_normalized,\n        revenue_type_normalized\n      ) === lit(1),\n        lit(0)\n      ).otherwise(auction_service_fees)\n    ).as(\"auction_service_fees\"),\n    coalesce(\n      when((imp_type === lit(6))\n        .and(is_dw_normalized === lit(1))\n        .and(should_process_views === lit(1)),\n        lit(0)\n      ),\n      when((imp_type === lit(7))\n        .and(is_dw_normalized === lit(1))\n        .and(should_process_views === lit(1)),\n        discrepancy_allowance\n      ),\n      when((imp_type === lit(7))\n        .and(is_dw_normalized === lit(0))\n        .and(should_process_views === lit(1)),\n        discrepancy_allowance\n      ),\n      when(f_is_non_cpm_payment_or_payment(imp_type,\n        payment_type_normalized,\n        revenue_type_normalized\n      ) === lit(1),\n        lit(0)\n      ).otherwise(discrepancy_allowance)\n    ).as(\"discrepancy_allowance\"),\n    lit(null).cast(DoubleType).as(\"forex_allowance\"),\n    coalesce(\n      when((imp_type === lit(6))\n        .and(is_dw_normalized === lit(1))\n        .and(should_process_views === lit(1)),\n        lit(0)\n      ),\n      when((imp_type === lit(7))\n        .and(is_dw_normalized === lit(1))\n        .and(should_process_views === lit(1)),\n        creative_overage_fees\n      ),\n      when((imp_type === lit(7))\n        .and(is_dw_normalized === lit(0))\n        .and(should_process_views === lit(1)),\n        creative_overage_fees\n      ),\n      when(f_is_non_cpm_payment_or_payment(imp_type,\n        payment_type_normalized,\n        revenue_type_normalized\n      ) === lit(1),\n        lit(0)\n      ).otherwise(creative_overage_fees)\n    ).as(\"creative_overage_fees\"),\n    coalesce(col(\"log_impbus_impressions.fold_position\").cast(IntegerType),\n      lit(0)\n    ).as(\"fold_position\"),\n    when(col(\"log_impbus_impressions.external_inv_id\").cast(\n      IntegerType\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.external_inv_id\").cast(IntegerType)\n    ).as(\"external_inv_id\"),\n    coalesce(\n      when((_f_is_buy_side === lit(1))\n        .and(col(\"log_dw_bid.cadence_modifier\") =!= lit(0)),\n        col(\"log_dw_bid.cadence_modifier\")\n      ),\n      when((_f_is_buy_side === lit(0))\n        .and(virtual_log_dw_bid_cadence_modifier =!= lit(0)),\n        virtual_log_dw_bid_cadence_modifier\n      )\n    ).as(\"cadence_modifier\"),\n    col(\"imp_type\").cast(IntegerType).as(\"imp_type\"),\n    coalesce(\n      when(_f_is_buy_side === lit(1), col(\"log_dw_bid.advertiser_currency\")),\n      lit(\"USD\")\n    ).as(\"advertiser_currency\"),\n    coalesce(\n      when(\n        (_f_is_buy_side === lit(1))\n          .and(is_not_null(col(\"log_dw_bid.advertiser_exchange_rate\")))\n          .and(col(\"log_dw_bid.advertiser_exchange_rate\") =!= lit(1.0d))\n          .and(col(\"log_dw_bid.advertiser_exchange_rate\") =!= lit(0.0d)),\n        col(\"log_dw_bid.advertiser_exchange_rate\")\n      ),\n      lit(1.0d)\n    ).as(\"advertiser_exchange_rate\"),\n    col(\"log_impbus_impressions.ip_address\").as(\"ip_address\"),\n    when(\n      col(\"log_impbus_impressions.publisher_id\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.publisher_id\").cast(IntegerType)\n    ).as(\"publisher_id\"),\n    coalesce(\n      when((imp_type === lit(6))\n        .and(is_dw_normalized === lit(1))\n        .and(should_process_views === lit(1)),\n        lit(0)\n      ),\n      when((imp_type === lit(7))\n        .and(is_dw_normalized === lit(1))\n        .and(should_process_views === lit(1)),\n        auction_service_deduction\n      ),\n      when((imp_type === lit(7))\n        .and(is_dw_normalized === lit(0))\n        .and(should_process_views === lit(1)),\n        auction_service_deduction\n      ),\n      when(f_is_non_cpm_payment_or_payment(imp_type,\n        payment_type_normalized,\n        revenue_type_normalized\n      ) === lit(1),\n        lit(0)\n      ).otherwise(auction_service_deduction)\n    ).as(\"auction_service_deduction\"),\n    coalesce(\n      when((col(\"imp_type\").cast(IntegerType) === lit(1))\n        .or(buyer_member_id === lit(0))\n        .and(is_not_null(insertion_order_id)),\n        lit(0)\n      ),\n      when(insertion_order_id =!= lit(0), insertion_order_id)\n    ).as(\"insertion_order_id\"),\n    coalesce(\n      when(_f_is_buy_side === lit(1),\n        col(\"log_dw_bid.predict_type\").cast(IntegerType)\n      ),\n      when(_f_is_buy_side === lit(0),\n        virtual_log_dw_bid_predict_type\n      )\n    ).as(\"predict_type_rev\"),\n    coalesce(\n      when((_f_is_buy_side === lit(1)).and(\n        col(\"log_dw_bid.predict_type_goal\").cast(IntegerType) =!= lit(0)\n      ),\n        col(\"log_dw_bid.predict_type_goal\").cast(IntegerType)\n      ),\n      when(_f_is_buy_side === lit(0),\n        virtual_log_dw_bid_predict_type_goal\n      )\n    ).as(\"predict_type_goal\"),\n    coalesce(\n      when(_f_is_buy_side === lit(1),\n        col(\"log_dw_bid.predict_type\").cast(IntegerType)\n      ),\n      when(_f_is_buy_side === lit(0),\n        virtual_log_dw_bid_predict_type\n      )\n    ).as(\"predict_type_cost\"),\n    booked_revenue_dollars.as(\"booked_revenue_dollars\"),\n    booked_revenue_adv_curr.as(\"booked_revenue_adv_curr\"),\n    when(commission_cpm =!= lit(0),      commission_cpm).as(\"commission_cpm\"),\n    when(commission_revshare =!= lit(0), commission_revshare)\n      .as(\"commission_revshare\"),\n    when(serving_fees_cpm =!= lit(0), serving_fees_cpm)\n      .as(\"serving_fees_cpm\"),\n    when(serving_fees_revshare =!= lit(0), serving_fees_revshare)\n      .as(\"serving_fees_revshare\"),\n    when(col(\"log_impbus_impressions.user_tz_offset\").cast(\n      IntegerType\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.user_tz_offset\").cast(IntegerType)\n    ).as(\"user_tz_offset\"),\n    f_preempt_over_impression_non_zero_explicit(\n      is_not_null(col(\"log_impbus_preempt.media_type\").cast(IntegerType)),\n      col(\"log_impbus_impressions.media_type\").cast(IntegerType),\n      col(\"log_impbus_preempt.media_type\").cast(IntegerType)\n    ).as(\"media_type\"),\n    when(col(\"log_impbus_impressions.operating_system\").cast(\n      IntegerType\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.operating_system\").cast(IntegerType)\n    ).as(\"operating_system\"),\n    when(col(\"log_impbus_impressions.browser\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.browser\").cast(IntegerType)\n    ).as(\"browser\"),\n    when(col(\"log_impbus_impressions.language\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.language\").cast(IntegerType)\n    ).as(\"language\"),\n    col(\"log_impbus_impressions.seller_currency\").as(\"publisher_currency\"),\n    coalesce(\n      when(\n        is_not_null(col(\"log_impbus_impressions.seller_exchange_rate\")).and(\n          col(\"log_impbus_impressions.seller_exchange_rate\") =!= lit(1.0d)\n        ),\n        col(\"log_impbus_impressions.seller_exchange_rate\")\n      ),\n      lit(1.0d)\n    ).as(\"publisher_exchange_rate\"),\n    media_cost_dollars_cpm.as(\"media_cost_dollars_cpm\"),\n    coalesce(\n      when(\n        (is_placeholder_bid === lit(1)).or(\n          (col(\"imp_type\").cast(IntegerType) === lit(1))\n            .or(col(\"imp_type\").cast(IntegerType) === lit(3))\n            .or(imp_type === lit(8))\n        ),\n        lit(0)\n      ),\n      payment_type_normalized\n    ).as(\"payment_type\"),\n    coalesce(\n      when(\n        (is_placeholder_bid === lit(1)).or(\n          (col(\"imp_type\").cast(IntegerType) === lit(1))\n            .or(imp_type === lit(2))\n            .or(col(\"imp_type\").cast(IntegerType) === lit(3))\n            .or(imp_type === lit(8))\n        ),\n        lit(-1)\n      ),\n      revenue_type_normalized\n    ).as(\"revenue_type\"),\n    coalesce(\n      when(should_zero_seller_revenue.cast(BooleanType), lit(0)),\n      when(\n        (v_transaction_event_pricing\n          .getField(\"buyer_charges\")\n          .getField(\"is_dw\") === lit(1)).and(\n          col(\"seller_member_id\").cast(IntegerType) === col(\"buyer_member_id\")\n            .cast(IntegerType)\n        ),\n        seller_revenue_cpm\n      ),\n      when(_f_is_buy_side === lit(0), seller_revenue_cpm),\n      when(\n        not(\n          (v_transaction_event_pricing\n            .getField(\"buyer_charges\")\n            .getField(\"is_dw\") === lit(1)).and(\n            col(\"seller_member_id\")\n              .cast(IntegerType) === col(\"buyer_member_id\").cast(IntegerType)\n          )\n        ),\n        lit(0)\n      ),\n      when(imp_type === lit(9), lit(0))\n    ).as(\"seller_revenue_cpm\"),\n    coalesce(\n      col(\"log_impbus_preempt.bidder_id\").cast(IntegerType),\n      when(is_not_null(col(\"log_impbus_preempt\")).cast(BooleanType), lit(0)),\n      col(\"log_impbus_impressions.bidder_id\").cast(IntegerType)\n    ).as(\"bidder_id\"),\n    when(string_compare(col(\"log_impbus_impressions.inv_code\"),\n      lit(\"---\")\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.inv_code\")\n    ).as(\"inv_code\"),\n    when(string_compare(col(\"log_impbus_impressions.application_id\"),\n      lit(\"---\")\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.application_id\")\n    ).as(\"application_id\"),\n    when(col(\"log_impbus_impressions.shadow_price\") =!= lit(0.0d),\n      col(\"log_impbus_impressions.shadow_price\")\n    ).as(\"shadow_price\"),\n    when(col(\"log_impbus_impressions.eap\") =!= lit(0),\n      col(\"log_impbus_impressions.eap\")\n    ).as(\"eap\"),\n    when(col(\"log_impbus_impressions.datacenter_id\").cast(\n      IntegerType\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.datacenter_id\").cast(IntegerType)\n    ).as(\"datacenter_id\"),\n    when(\n      col(\"log_impbus_impressions.imp_blacklist_or_fraud\").cast(\n        IntegerType\n      ) =!= lit(0),\n      col(\"log_impbus_impressions.imp_blacklist_or_fraud\").cast(IntegerType)\n    ).as(\"imp_blacklist_or_fraud\"),\n    f_preempt_over_impression_non_zero_explicit(\n      is_not_null(col(\"log_impbus_preempt\")),\n      col(\"log_impbus_impressions.vp_expose_domains\").cast(IntegerType),\n      col(\"log_impbus_preempt.vp_expose_domains\").cast(IntegerType)\n    ).as(\"vp_expose_domains\"),\n    f_preempt_over_impression_non_zero_explicit(\n      is_not_null(col(\"log_impbus_preempt\")),\n      col(\"log_impbus_impressions.vp_expose_categories\").cast(IntegerType),\n      col(\"log_impbus_preempt.vp_expose_categories\").cast(IntegerType)\n    ).as(\"vp_expose_categories\"),\n    f_preempt_over_impression_non_zero_explicit(\n      is_not_null(col(\"log_impbus_preempt\")),\n      col(\"log_impbus_impressions.vp_expose_pubs\").cast(IntegerType),\n      col(\"log_impbus_preempt.vp_expose_pubs\").cast(IntegerType)\n    ).as(\"vp_expose_pubs\"),\n    f_preempt_over_impression_non_zero_explicit(\n      is_not_null(col(\"log_impbus_preempt\")),\n      col(\"log_impbus_impressions.vp_expose_tag\").cast(IntegerType),\n      col(\"log_impbus_preempt.vp_expose_tag\").cast(IntegerType)\n    ).as(\"vp_expose_tag\"),\n    when(col(\"log_dw_bid.vp_expose_age\").cast(IntegerType) =!= lit(0),\n      col(\"log_dw_bid.vp_expose_age\").cast(IntegerType)\n    ).as(\"vp_expose_age\"),\n    when(col(\"log_dw_bid.vp_expose_gender\").cast(IntegerType) =!= lit(0),\n      col(\"log_dw_bid.vp_expose_gender\").cast(IntegerType)\n    ).as(\"vp_expose_gender\"),\n    when(col(\"log_impbus_impressions.inventory_url_id\").cast(\n      IntegerType\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.inventory_url_id\").cast(IntegerType)\n    ).as(\"inventory_url_id\"),\n    when(\n      col(\"log_impbus_impressions.audit_type\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.audit_type\").cast(IntegerType)\n    ).as(\"audit_type\"),\n    when(\n      col(\"log_impbus_impressions.is_exclusive\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.is_exclusive\").cast(IntegerType)\n    ).as(\"is_exclusive\"),\n    when(\n      col(\"log_impbus_impressions.truncate_ip\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.truncate_ip\").cast(IntegerType)\n    ).as(\"truncate_ip\"),\n    when(col(\"log_impbus_impressions.device_id\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.device_id\").cast(IntegerType)\n    ).as(\"device_id\"),\n    when(\n      col(\"log_impbus_impressions.carrier_id\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.carrier_id\").cast(IntegerType)\n    ).as(\"carrier_id\"),\n    f_preempt_over_impression_non_zero_explicit(\n      is_not_null(col(\"log_impbus_preempt\")),\n      col(\"log_impbus_impressions.creative_audit_status\").cast(IntegerType),\n      col(\"log_impbus_preempt.creative_audit_status\").cast(IntegerType)\n    ).as(\"creative_audit_status\"),\n    f_preempt_over_impression_non_zero_explicit(\n      is_not_null(col(\"log_impbus_preempt\")),\n      col(\"log_impbus_impressions.is_creative_hosted\").cast(IntegerType),\n      col(\"log_impbus_preempt.is_creative_hosted\").cast(IntegerType)\n    ).as(\"is_creative_hosted\"),\n    coalesce(when(should_zero_seller_revenue.cast(BooleanType), lit(0)),\n      seller_deduction\n    ).as(\"seller_deduction\"),\n    when(col(\"log_impbus_impressions.city\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.city\").cast(IntegerType)\n    ).as(\"city\"),\n    when(string_compare(col(\"log_impbus_impressions.latitude\"),\n      lit(\"\")\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.latitude\")\n    ).as(\"latitude\"),\n    when(string_compare(col(\"log_impbus_impressions.longitude\"),\n      lit(\"\")\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.longitude\")\n    ).as(\"longitude\"),\n    when(string_compare(col(\"log_impbus_impressions.device_unique_id\"),\n      lit(\"\")\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.device_unique_id\")\n    ).as(\"device_unique_id\"),\n    when(\n      col(\"log_impbus_impressions.package_id\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.package_id\").cast(IntegerType)\n    ).as(\"package_id\"),\n    when((_f_is_buy_side === lit(1)).and(\n      string_compare(col(\"log_dw_bid.targeted_segments\"),\n        lit(\"\")\n      ) =!= lit(0)\n    ),\n      col(\"log_dw_bid.targeted_segments\")\n    ).as(\"targeted_segments\"),\n    when(\n      col(\"log_impbus_impressions.supply_type\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.supply_type\").cast(IntegerType)\n    ).as(\"supply_type\"),\n    when(\n      col(\"log_impbus_impressions.is_toolbar\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.is_toolbar\").cast(IntegerType)\n    ).as(\"is_toolbar\"),\n    deal_id.as(\"deal_id\"),\n    f_preempt_over_impression_non_zero_explicit(\n      is_not_null(col(\"log_impbus_preempt\")),\n      col(\"log_impbus_impressions.vp_bitmap\").cast(LongType),\n      col(\"log_impbus_preempt.vp_bitmap\").cast(LongType)\n    ).as(\"vp_bitmap\"),\n    view_detection_enabled.as(\"view_detection_enabled\"),\n    view_result.as(\"view_result\"),\n    when(col(\"log_impbus_impressions.ozone_id\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.ozone_id\").cast(IntegerType)\n    ).as(\"ozone_id\"),\n    when(col(\"log_impbus_impressions.is_performance\").cast(\n      IntegerType\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.is_performance\").cast(IntegerType)\n    ).as(\"is_performance\"),\n    when(string_compare(col(\"log_impbus_impressions.sdk_version\"),\n      lit(\"---\")\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.sdk_version\")\n    ).as(\"sdk_version\"),\n    when(\n      col(\"log_impbus_impressions.inventory_session_frequency\").cast(\n        IntegerType\n      ) =!= lit(0),\n      col(\"log_impbus_impressions.inventory_session_frequency\").cast(\n        IntegerType\n      )\n    ).as(\"inventory_session_frequency\"),\n    when(\n      col(\"log_impbus_impressions.device_type\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.device_type\").cast(IntegerType)\n    ).as(\"device_type\"),\n    when(col(\"log_impbus_impressions.dma\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.dma\").cast(IntegerType)\n    ).as(\"dma\"),\n    when(string_compare(col(\"log_impbus_impressions.postal\"),\n      lit(\"---\")\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.postal\")\n    ).as(\"postal\"),\n    viewdef_definition_id.as(\"viewdef_definition_id\"),\n    viewdef_viewable.as(\"viewdef_viewable\"),\n    view_measurable.as(\"view_measurable\"),\n    viewable.as(\"viewable\"),\n    when(col(\"log_impbus_impressions.is_secure\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.is_secure\").cast(IntegerType)\n    ).as(\"is_secure\"),\n    view_non_measurable_reason.as(\"view_non_measurable_reason\"),\n    coalesce(when((buyer_trx_event_id === lit(1)).and(imp_type === lit(6)),\n      data_costs_deal\n    ),\n      when(_f_is_buy_side === lit(1), data_costs)\n    ).as(\"data_costs\"),\n    when(col(\"log_impbus_impressions.bidder_instance_id\").cast(\n      IntegerType\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.bidder_instance_id\").cast(IntegerType)\n    ).as(\"bidder_instance_id\"),\n    coalesce(\n      when(\n        (_f_is_buy_side === lit(1)).and(\n          col(\"log_dw_bid.campaign_group_freq\").cast(IntegerType) =!= lit(-2)\n        ),\n        col(\"log_dw_bid.campaign_group_freq\").cast(IntegerType)\n      ),\n      when((_f_is_buy_side === lit(0)).and(\n        virtual_log_dw_bid_campaign_group_freq =!= lit(-2)\n      ),\n        virtual_log_dw_bid_campaign_group_freq\n      )\n    ).as(\"campaign_group_freq\"),\n    coalesce(\n      when((_f_is_buy_side === lit(1)).and(\n        col(\"log_dw_bid.campaign_group_rec\").cast(IntegerType) =!= lit(0)\n      ),\n        col(\"log_dw_bid.campaign_group_rec\").cast(IntegerType)\n      ),\n      when(_f_is_buy_side === lit(0),\n        virtual_log_dw_bid_campaign_group_rec\n      )\n    ).as(\"campaign_group_rec\"),\n    coalesce(\n      when(\n        (_f_is_buy_side === lit(1)).and(\n          col(\"log_dw_bid.insertion_order_freq\").cast(IntegerType) =!= lit(-2)\n        ),\n        col(\"log_dw_bid.insertion_order_freq\").cast(IntegerType)\n      ),\n      when((_f_is_buy_side === lit(0)).and(\n        virtual_log_dw_bid_insertion_order_freq =!= lit(-2)\n      ),\n        virtual_log_dw_bid_insertion_order_freq\n      )\n    ).as(\"insertion_order_freq\"),\n    coalesce(\n      when(\n        (_f_is_buy_side === lit(1)).and(\n          col(\"log_dw_bid.insertion_order_rec\").cast(IntegerType) =!= lit(0)\n        ),\n        col(\"log_dw_bid.insertion_order_rec\").cast(IntegerType)\n      ),\n      when(_f_is_buy_side === lit(0),\n        virtual_log_dw_bid_insertion_order_rec\n      )\n    ).as(\"insertion_order_rec\"),\n    when((_f_is_buy_side === lit(1)).and(\n      string_compare(col(\"log_dw_bid.buyer_gender\"), lit(\"u\")) =!= lit(0)\n    ),\n      col(\"log_dw_bid.buyer_gender\")\n    ).as(\"buyer_gender\"),\n    coalesce(\n      when(\n        (_f_is_buy_side === lit(1))\n          .and(is_not_null(col(\"log_dw_bid.buyer_age\").cast(IntegerType)))\n          .and(col(\"log_dw_bid.buyer_age\").cast(IntegerType) =!= lit(-1)),\n        col(\"log_dw_bid.buyer_age\").cast(IntegerType)\n      ),\n      lit(0)\n    ).as(\"buyer_age\"),\n    when((_f_is_buy_side === lit(1))\n      .and(is_not_null(col(\"log_dw_bid.targeted_segment_list\"))),\n      col(\"log_dw_bid.targeted_segment_list\")\n    ).as(\"targeted_segment_list\"),\n    when((_f_is_buy_side === lit(1)).and(\n      col(\"log_dw_bid.custom_model_id\").cast(IntegerType) =!= lit(0)\n    ),\n      col(\"log_dw_bid.custom_model_id\").cast(IntegerType)\n    ).as(\"custom_model_id\"),\n    when(\n      (_f_is_buy_side === lit(1)).and(\n        col(\"log_dw_bid.custom_model_last_modified\").cast(LongType) =!= lit(0)\n      ),\n      col(\"log_dw_bid.custom_model_last_modified\").cast(LongType)\n    ).as(\"custom_model_last_modified\"),\n    coalesce(\n      when((_f_is_buy_side === lit(1)).and(\n        string_compare(col(\"log_dw_bid.custom_model_output_code\"),\n          lit(\"\")\n        ) =!= lit(0)\n      ),\n        col(\"log_dw_bid.custom_model_output_code\")\n      ),\n      when(_f_is_buy_side === lit(0),\n        virtual_log_dw_bid_custom_model_output_code\n      )\n    ).as(\"custom_model_output_code\"),\n    when(string_compare(col(\"log_impbus_impressions.external_uid\"),\n      lit(\"---\")\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.external_uid\")\n    ).as(\"external_uid\"),\n    when(string_compare(col(\"log_impbus_impressions.request_uuid\"),\n      lit(\"---\")\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.request_uuid\")\n    ).as(\"request_uuid\"),\n    when(\n      col(\"log_impbus_impressions.mobile_app_instance_id\").cast(\n        IntegerType\n      ) =!= lit(0),\n      col(\"log_impbus_impressions.mobile_app_instance_id\").cast(IntegerType)\n    ).as(\"mobile_app_instance_id\"),\n    when(string_compare(col(\"log_impbus_impressions.traffic_source_code\"),\n      lit(\"---\")\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.traffic_source_code\")\n    ).as(\"traffic_source_code\"),\n    when(string_compare(col(\"log_impbus_impressions.external_request_id\"),\n      lit(\"---\")\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.external_request_id\")\n    ).as(\"external_request_id\"),\n    when(string_compare(col(\"log_impbus_impressions.stitch_group_id\"),\n      lit(\"---\")\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.stitch_group_id\")\n    ).as(\"stitch_group_id\"),\n    deal_type.as(\"deal_type\"),\n    f_preempt_over_impression_non_zero_explicit(\n      is_not_null(col(\"log_impbus_preempt\")),\n      col(\"log_impbus_impressions.ym_floor_id\").cast(IntegerType),\n      col(\"log_impbus_preempt.ym_floor_id\").cast(IntegerType)\n    ).as(\"ym_floor_id\"),\n    f_preempt_over_impression_non_zero_explicit(\n      is_not_null(col(\"log_impbus_preempt\")),\n      col(\"log_impbus_impressions.ym_bias_id\").cast(IntegerType),\n      col(\"log_impbus_preempt.ym_bias_id\").cast(IntegerType)\n    ).as(\"ym_bias_id\"),\n    when(col(\"log_dw_bid.bid_priority\").cast(IntegerType) =!= lit(0),\n      col(\"log_dw_bid.bid_priority\").cast(IntegerType)\n    ).as(\"bid_priority\"),\n    lit(null)\n      .cast(\n        StructType(\n          List(\n            StructField(\"rate_card_id\", IntegerType, true),\n            StructField(\"member_id\",    IntegerType, true),\n            StructField(\"is_dw\",        BooleanType, true),\n            StructField(\n              \"pricing_terms\",\n              ArrayType(\n                StructType(\n                  List(\n                    StructField(\"term_id\",                 IntegerType, true),\n                    StructField(\"amount\",                  DoubleType,  true),\n                    StructField(\"rate\",                    DoubleType,  true),\n                    StructField(\"is_deduction\",            BooleanType, true),\n                    StructField(\"is_media_cost_dependent\", BooleanType, true),\n                    StructField(\"data_member_id\",          IntegerType, true)\n                  )\n                ),\n                true\n              ),\n              true\n            ),\n            StructField(\"fx_margin_rate_id\",      IntegerType, true),\n            StructField(\"marketplace_owner_id\",   IntegerType, true),\n            StructField(\"virtual_marketplace_id\", IntegerType, true),\n            StructField(\"amino_enabled\",          BooleanType, true)\n          )\n        )\n      )\n      .as(\"buyer_charges\"),\n    lit(null)\n      .cast(\n        StructType(\n          List(\n            StructField(\"rate_card_id\", IntegerType, true),\n            StructField(\"member_id\",    IntegerType, true),\n            StructField(\"is_dw\",        BooleanType, true),\n            StructField(\n              \"pricing_terms\",\n              ArrayType(\n                StructType(\n                  List(\n                    StructField(\"term_id\",                 IntegerType, true),\n                    StructField(\"amount\",                  DoubleType,  true),\n                    StructField(\"rate\",                    DoubleType,  true),\n                    StructField(\"is_deduction\",            BooleanType, true),\n                    StructField(\"is_media_cost_dependent\", BooleanType, true),\n                    StructField(\"data_member_id\",          IntegerType, true)\n                  )\n                ),\n                true\n              ),\n              true\n            ),\n            StructField(\"fx_margin_rate_id\",      IntegerType, true),\n            StructField(\"marketplace_owner_id\",   IntegerType, true),\n            StructField(\"virtual_marketplace_id\", IntegerType, true),\n            StructField(\"amino_enabled\",          BooleanType, true)\n          )\n        )\n      )\n      .as(\"seller_charges\"),\n    when(col(\"log_dw_bid.explore_disposition\").cast(IntegerType) =!= lit(0),\n      col(\"log_dw_bid.explore_disposition\").cast(IntegerType)\n    ).as(\"explore_disposition\"),\n    when(col(\"log_impbus_impressions.device_make_id\").cast(\n      IntegerType\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.device_make_id\").cast(IntegerType)\n    ).as(\"device_make_id\"),\n    when(\n      col(\"log_impbus_impressions.operating_system_family_id\").cast(\n        IntegerType\n      ) =!= lit(1),\n      col(\"log_impbus_impressions.operating_system_family_id\").cast(\n        IntegerType\n      )\n    ).as(\"operating_system_family_id\"),\n    col(\"log_impbus_impressions.tag_sizes\").as(\"tag_sizes\"),\n    lit(null)\n      .cast(\n        ArrayType(\n          StructType(\n            List(\n              StructField(\"model_type\", IntegerType, true),\n              StructField(\"model_id\",   IntegerType, true),\n              StructField(\"leaf_code\",  StringType,  true),\n              StructField(\"origin\",     IntegerType, true),\n              StructField(\"experiment\", IntegerType, true),\n              StructField(\"value\",      FloatType,   true)\n            )\n          ),\n          true\n        )\n      )\n      .as(\"campaign_group_models\"),\n    coalesce(col(\"log_impbus_impressions_pricing.rate_card_media_type\").cast(\n      IntegerType\n    ),\n      lit(0)\n    ).as(\"pricing_media_type\"),\n    buyer_trx_event_id.as(\"buyer_trx_event_id\"),\n    seller_trx_event_id.as(\"seller_trx_event_id\"),\n    coalesce(\n      when(\n        (_f_is_buy_side === lit(0)).and(\n          virtual_log_dw_bid_revenue_auction_event_type =!= lit(0)\n        ),\n        virtual_log_dw_bid_revenue_auction_event_type\n      ),\n      when(\n        (_f_is_buy_side === lit(1)).and(\n          col(\"log_dw_bid.revenue_auction_event_type\")\n            .cast(IntegerType) =!= lit(0)\n        ),\n        col(\"log_dw_bid.revenue_auction_event_type\").cast(IntegerType)\n      )\n    ).as(\"revenue_auction_event_type\"),\n    when(col(\"log_impbus_impressions.is_prebid\").cast(ByteType) =!= lit(0),\n      col(\"log_impbus_impressions.is_prebid\").cast(BooleanType)\n    ).as(\"is_prebid\"),\n    coalesce(\n      when(imp_type === lit(6), has_seller_transacted.cast(BooleanType)),\n      when(imp_type.isin(lit(7), lit(11)),\n        has_buyer_transacted.cast(BooleanType)\n      ),\n      lit(1).cast(BooleanType)\n    ).as(\"is_unit_of_trx\"),\n    imps_for_budget_caps_pacing.as(\"imps_for_budget_caps_pacing\"),\n    col(\"log_impbus_impressions.date_time\")\n      .cast(LongType)\n      .as(\"auction_timestamp\"),\n    when(\n      col(\"log_impbus_impressions_pricing.two_phase_reduction_applied\").cast(\n        ByteType\n      ) =!= lit(0),\n      col(\"log_impbus_impressions_pricing.two_phase_reduction_applied\").cast(\n        BooleanType\n      )\n    ).as(\"two_phase_reduction_applied\"),\n    when(col(\"log_impbus_impressions.region_id\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.region_id\").cast(IntegerType)\n    ).as(\"region_id\"),\n    when(col(\"log_impbus_impressions.media_company_id\").cast(\n      IntegerType\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.media_company_id\").cast(IntegerType)\n    ).as(\"media_company_id\"),\n    when(\n      col(\"log_impbus_impressions_pricing.trade_agreement_id\").cast(\n        IntegerType\n      ) =!= lit(0),\n      col(\"log_impbus_impressions_pricing.trade_agreement_id\").cast(\n        IntegerType\n      )\n    ).as(\"trade_agreement_id\"),\n    lit(null)\n      .cast(\n        StructType(\n          List(\n            StructField(\"user_id_64\",       LongType,   true),\n            StructField(\"device_unique_id\", StringType, true),\n            StructField(\"external_uid\",     StringType, true),\n            StructField(\"ip_address\",       BinaryType, true),\n            StructField(\"crossdevice_group\",\n              StructType(\n                List(StructField(\"graph_id\", IntegerType, true),\n                  StructField(\"group_id\", LongType,    true)\n                )\n              ),\n              true\n            ),\n            StructField(\"latitude\",                 DoubleType,  true),\n            StructField(\"longitude\",                DoubleType,  true),\n            StructField(\"ipv6_address\",             BinaryType,  true),\n            StructField(\"subject_to_gdpr\",          BooleanType, true),\n            StructField(\"geo_country\",              StringType,  true),\n            StructField(\"gdpr_consent_string\",      StringType,  true),\n            StructField(\"preempt_ip_address\",       BinaryType,  true),\n            StructField(\"device_type\",              IntegerType, true),\n            StructField(\"device_make_id\",           IntegerType, true),\n            StructField(\"device_model_id\",          IntegerType, true),\n            StructField(\"new_user_id_64\",           LongType,    true),\n            StructField(\"is_service_provider_mode\", BooleanType, true),\n            StructField(\"is_personal_info_sale\",    BooleanType, true)\n          )\n        )\n      )\n      .as(\"personal_data\"),\n    coalesce(when(is_not_null(netflix_ppid).cast(BooleanType),\n      f_string_to_anon_user_info(netflix_ppid)\n    ),\n      col(\"log_impbus_impressions.anonymized_user_info\")\n    ).as(\"anonymized_user_info\"),\n    when(string_compare(col(\"log_impbus_impressions.gdpr_consent_cookie\"),\n      lit(\"\")\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.gdpr_consent_cookie\")\n    ).as(\"gdpr_consent_cookie\"),\n    col(\"additional_clearing_events\").as(\"additional_clearing_events\"),\n    col(\"log_impbus_impressions.fx_rate_snapshot_id\")\n      .cast(IntegerType)\n      .as(\"fx_rate_snapshot_id\"),\n    coalesce(\n      when(_f_is_buy_side === lit(1),\n        col(\"log_dw_bid.crossdevice_group_anon\")\n      ),\n      when(imp_type === lit(6), col(\"log_dw_bid_deal.crossdevice_group_anon\"))\n    ).as(\"crossdevice_group_anon\"),\n    coalesce(\n      when((buyer_trx_event_id === lit(1)).and(imp_type === lit(6)),\n        col(\"log_dw_bid_deal.crossdevice_graph_cost\")\n      ),\n      when((_f_is_buy_side === lit(1)).and(imp_type =!= lit(6)),\n        col(\"log_dw_bid.crossdevice_graph_cost\")\n      )\n    ).as(\"crossdevice_graph_cost\"),\n    when(\n      (_f_is_buy_side === lit(1)).and(\n        col(\"log_dw_bid.revenue_event_type_id\").cast(IntegerType) =!= lit(0)\n      ),\n      col(\"log_dw_bid.revenue_event_type_id\").cast(IntegerType)\n    ).as(\"revenue_event_type_id\"),\n    buyer_trx_event_type_id.as(\"buyer_trx_event_type_id\"),\n    seller_trx_event_type_id.as(\"seller_trx_event_type_id\"),\n    coalesce(col(\"log_impbus_preempt.external_creative_id\"),\n      when(is_not_null(col(\"log_impbus_preempt\")).cast(BooleanType),\n        lit(\"---\")\n      )\n    ).as(\"external_creative_id\"),\n    coalesce(\n      when(is_not_null(col(\"log_dw_bid_deal\")).and(imp_type === lit(6)),\n        col(\"log_dw_bid_deal.targeted_segment_details\")\n      ),\n      when(_f_is_buy_side === lit(1),\n        col(\"log_dw_bid.targeted_segment_details\")\n      )\n    ).as(\"targeted_segment_details\"),\n    coalesce(\n      col(\"log_impbus_preempt.seat_id\").cast(IntegerType),\n      when(is_not_null(col(\"log_impbus_preempt\")).cast(BooleanType), lit(0)),\n      lit(0)\n    ).as(\"bidder_seat_id\"),\n    when(col(\"log_impbus_impressions.is_whiteops_scanned\").cast(\n      ByteType\n    ) =!= lit(0),\n      col(\"log_impbus_impressions.is_whiteops_scanned\").cast(BooleanType)\n    ).as(\"is_whiteops_scanned\"),\n    lit(null).cast(StringType).as(\"default_referrer_url\"),\n    when(is_curated === lit(1), lit(1).cast(BooleanType)).as(\"is_curated\"),\n    curator_member_id.as(\"curator_member_id\"),\n    coalesce(\n      when(\n        (_f_is_buy_side === lit(1))\n          .and(\n            is_not_null(\n              col(\"log_dw_view.revenue_info.total_partner_fees_microcents\")\n                .cast(LongType)\n            )\n          )\n          .and(\n            is_not_null(\n              col(\"log_dw_bid.revenue_info.total_partner_fees_microcents\")\n                .cast(LongType)\n            )\n          ),\n        col(\"log_dw_view.revenue_info.total_partner_fees_microcents\")\n          .cast(LongType) + col(\n          \"log_dw_bid.revenue_info.total_partner_fees_microcents\"\n        ).cast(LongType)\n      ),\n      when(\n        (_f_is_buy_side === lit(1)).and(\n          is_not_null(\n            col(\"log_dw_bid.revenue_info.total_partner_fees_microcents\")\n              .cast(LongType)\n          )\n        ),\n        col(\"log_dw_bid.revenue_info.total_partner_fees_microcents\").cast(\n          LongType\n        )\n      ),\n      when(_f_is_buy_side === lit(1), lit(0))\n    ).as(\"total_partner_fees_microcents\"),\n    lit(null).cast(DoubleType).as(\"net_buyer_spend\"),\n    when(col(\"log_impbus_preempt.is_prebid_server\").cast(ByteType) =!= lit(0),\n      col(\"log_impbus_preempt.is_prebid_server\").cast(BooleanType)\n    ).as(\"is_prebid_server\"),\n    when(\n      (_f_is_buy_side === lit(1)).and(\n        col(\"log_dw_bid.cold_start_price_type\").cast(IntegerType) =!= lit(-1)\n      ),\n      col(\"log_dw_bid.cold_start_price_type\").cast(IntegerType)\n    ).as(\"cold_start_price_type\"),\n    when((_f_is_buy_side === lit(1)).and(\n      col(\"log_dw_bid.discovery_state\").cast(IntegerType) =!= lit(-1)\n    ),\n      col(\"log_dw_bid.discovery_state\").cast(IntegerType)\n    ).as(\"discovery_state\"),\n    coalesce(\n      when(\n        _f_is_buy_side === lit(1),\n        col(\"log_dw_bid.insertion_order_budget_interval_id\").cast(IntegerType)\n      ),\n      billing_period_id,\n      lit(0)\n    ).as(\"billing_period_id\"),\n    coalesce(\n      when(\n        _f_is_buy_side === lit(1),\n        col(\"log_dw_bid.campaign_group_budget_interval_id\").cast(IntegerType)\n      ),\n      flight_id,\n      lit(0)\n    ).as(\"flight_id\"),\n    split_id.as(\"split_id\"),\n    when(\n      (imp_type === lit(7)).and(\n        v_transaction_event_pricing.getField(\"buyer_transacted\") === lit(1)\n      ),\n      v_transaction_event_pricing\n        .getField(\"net_payment_value_microcents\")\n        .cast(DoubleType) / lit(100000.0d)\n    ).as(\"net_media_cost_dollars_cpm\"),\n    coalesce(\n      when(\n        (_f_is_buy_side === lit(1))\n          .and(\n            is_not_null(\n              col(\"log_dw_view.revenue_info.total_data_costs_microcents\")\n                .cast(LongType)\n            )\n          )\n          .and(\n            is_not_null(\n              col(\"log_dw_bid.revenue_info.total_data_costs_microcents\")\n                .cast(LongType)\n            )\n          ),\n        col(\"log_dw_view.revenue_info.total_data_costs_microcents\")\n          .cast(LongType) + col(\n          \"log_dw_bid.revenue_info.total_data_costs_microcents\"\n        ).cast(LongType)\n      ),\n      when(\n        (_f_is_buy_side === lit(1)).and(\n          is_not_null(\n            col(\"log_dw_bid.revenue_info.total_data_costs_microcents\")\n              .cast(LongType)\n          )\n        ),\n        col(\"log_dw_bid.revenue_info.total_data_costs_microcents\").cast(\n          LongType\n        )\n      ),\n      when(_f_is_buy_side === lit(1), lit(0))\n    ).as(\"total_data_costs_microcents\"),\n    coalesce(\n      when(\n        (_f_is_buy_side === lit(1))\n          .and(\n            is_not_null(\n              col(\"log_dw_view.revenue_info.total_profit_microcents\")\n                .cast(LongType)\n            )\n          )\n          .and(\n            is_not_null(\n              col(\"log_dw_bid.revenue_info.total_profit_microcents\")\n                .cast(LongType)\n            )\n          ),\n        col(\"log_dw_view.revenue_info.total_profit_microcents\")\n          .cast(LongType) + col(\n          \"log_dw_bid.revenue_info.total_profit_microcents\"\n        ).cast(LongType)\n      ),\n      when(\n        (_f_is_buy_side === lit(1)).and(\n          is_not_null(\n            col(\"log_dw_bid.revenue_info.total_profit_microcents\")\n              .cast(LongType)\n          )\n        ),\n        col(\"log_dw_bid.revenue_info.total_profit_microcents\").cast(LongType)\n      ),\n      when(_f_is_buy_side === lit(1), lit(0))\n    ).as(\"total_profit_microcents\"),\n    when(\n      (_f_is_buy_side === lit(1)).and(\n        col(\"log_dw_bid.targeted_crossdevice_graph_id\")\n          .cast(IntegerType) =!= lit(0)\n      ),\n      col(\"log_dw_bid.targeted_crossdevice_graph_id\").cast(IntegerType)\n    ).as(\"targeted_crossdevice_graph_id\"),\n    when((_f_is_buy_side === lit(1))\n      .and(col(\"log_dw_bid.discovery_prediction\") =!= lit(0.0d)),\n      col(\"log_dw_bid.discovery_prediction\")\n    ).as(\"discovery_prediction\"),\n    campaign_group_type_id.as(\"campaign_group_type_id\"),\n    when(col(\"log_impbus_impressions.hb_source\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.hb_source\").cast(IntegerType)\n    ).as(\"hb_source\"),\n    f_preempt_over_impression_94298.as(\"external_campaign_id\"),\n    when(_f_is_buy_side === lit(1),\n      col(\"log_dw_bid.excluded_targeted_segment_details\")\n    ).as(\"excluded_targeted_segment_details\"),\n    lit(null).cast(StringType).as(\"trust_id\"),\n    when((_f_is_buy_side === lit(1))\n      .and(col(\"log_dw_bid.predicted_kpi_event_rate\") =!= lit(0.0d)),\n      col(\"log_dw_bid.predicted_kpi_event_rate\")\n    ).as(\"predicted_kpi_event_rate\"),\n    coalesce(\n      when(_f_is_buy_side === lit(1),\n        col(\"log_dw_bid.has_crossdevice_reach_extension\").cast(BooleanType)\n      ),\n      when(imp_type === lit(6),\n        col(\"log_dw_bid_deal.has_crossdevice_reach_extension\").cast(\n          BooleanType\n        )\n      )\n    ).as(\"has_crossdevice_reach_extension\"),\n    coalesce(\n      when(_f_is_buy_side === lit(1),\n        col(\"log_dw_bid.crossdevice_graph_membership\")\n      ),\n      when(imp_type === lit(6),\n        col(\"log_dw_bid_deal.crossdevice_graph_membership\")\n      )\n    ).as(\"crossdevice_graph_membership\"),\n    when(\n      _f_is_buy_side === lit(1),\n      coalesce(col(\n        \"log_dw_bid.revenue_info.total_segment_data_costs_microcents\"\n      ).cast(LongType),\n        lit(0)\n      ) + coalesce(\n        col(\"log_dw_view.revenue_info.total_segment_data_costs_microcents\")\n          .cast(LongType),\n        lit(0)\n      )\n    ).otherwise(lit(0)).as(\"total_segment_data_costs_microcents\"),\n    when(\n      _f_is_buy_side === lit(1),\n      coalesce(col(\"log_dw_bid.revenue_info.total_feature_costs_microcents\")\n        .cast(LongType),\n        lit(0)\n      ) + coalesce(col(\n        \"log_dw_view.revenue_info.total_feature_costs_microcents\"\n      ).cast(LongType),\n        lit(0)\n      )\n    ).otherwise(lit(0)).as(\"total_feature_costs_microcents\"),\n    when(\n      col(\"log_impbus_impressions_pricing.counterparty_ruleset_type\").cast(\n        IntegerType\n      ) =!= lit(0),\n      col(\"log_impbus_impressions_pricing.counterparty_ruleset_type\").cast(\n        IntegerType\n      )\n    ).as(\"counterparty_ruleset_type\"),\n    coalesce(col(\"log_impbus_preempt.log_product_ads\"),\n      col(\"log_impbus_impressions.log_product_ads\")\n    ).as(\"log_product_ads\"),\n    coalesce(when(imp_type.isin(lit(7),                          lit(5)),\n      coalesce(col(\"log_dw_bid.line_item_currency\"), lit(\"---\"))\n    ),\n      lit(\"---\")\n    ).as(\"buyer_line_item_currency\"),\n    coalesce(\n      when(imp_type === lit(6),\n        coalesce(col(\"log_dw_bid_deal.line_item_currency\"), lit(\"---\"))\n      ),\n      lit(\"---\")\n    ).as(\"deal_line_item_currency\"),\n    coalesce(when(_f_is_buy_side === lit(1),\n      col(\"log_dw_bid.measurement_fee_cpm_usd\")\n    ),\n      lit(0)\n    ).as(\"measurement_fee_usd\"),\n    coalesce(\n      when(_f_is_buy_side === lit(1),\n        col(\"log_dw_bid.measurement_provider_member_id\").cast(IntegerType)\n      ),\n      lit(0)\n    ).as(\"measurement_provider_member_id\"),\n    when(_f_is_buy_side === lit(1),\n      col(\"log_dw_bid.offline_attribution_provider_member_id\").cast(\n        IntegerType\n      )\n    ).as(\"offline_attribution_provider_member_id\"),\n    when(_f_is_buy_side === lit(1),\n      col(\"log_dw_bid.offline_attribution_cost_usd_cpm\")\n    ).as(\"offline_attribution_cost_usd_cpm\"),\n    when(col(\"log_impbus_impressions.pred_info\").cast(IntegerType) =!= lit(0),\n      col(\"log_impbus_impressions.pred_info\").cast(IntegerType)\n    ).as(\"pred_info\"),\n    col(\"log_impbus_impressions.imp_rejecter_do_auction\")\n      .cast(BooleanType)\n      .as(\"imp_rejecter_do_auction\"),\n    col(\"log_impbus_impressions.personal_identifiers\")\n      .as(\"personal_identifiers\"),\n    col(\"log_impbus_impressions.is_imp_rejecter_applied\")\n      .cast(BooleanType)\n      .as(\"imp_rejecter_applied\"),\n    lit(null).cast(FloatType).as(\"ip_derived_latitude\"),\n    lit(null).cast(FloatType).as(\"ip_derived_longitude\"),\n    col(\"log_impbus_impressions.personal_identifiers_experimental\")\n      .as(\"personal_identifiers_experimental\"),\n    col(\"log_impbus_impressions.postal_code_ext_id\")\n      .cast(IntegerType)\n      .as(\"postal_code_ext_id\"),\n    coalesce(when(buyer_trx_event_id === lit(2),\n      col(\"log_dw_view.ecpm_conversion_rate\")\n    ),\n      lit(1.0d)\n    ).as(\"ecpm_conversion_rate\"),\n    when(sup_ip_range_lookup_count > lit(0), lit(1).cast(BooleanType))\n      .otherwise(lit(0).cast(BooleanType))\n      .as(\"is_residential_ip\"),\n    col(\"log_impbus_impressions.hashed_ip\").as(\"hashed_ip\"),\n    coalesce(\n      when(is_not_null(col(\"log_dw_bid_deal\")).and(imp_type === lit(6)),\n        col(\"log_dw_bid_deal.targeted_segment_details_by_id_type\")\n      ),\n      when(_f_is_buy_side === lit(1),\n        col(\"log_dw_bid.targeted_segment_details_by_id_type\")\n      )\n    ).as(\"targeted_segment_details_by_id_type\"),\n    when(_f_is_buy_side === lit(1), col(\"log_dw_bid.offline_attribution\"))\n      .as(\"offline_attribution\"),\n    col(\"log_dw_bid.frequency_cap_type_internal\")\n      .cast(IntegerType)\n      .as(\"frequency_cap_type_internal\"),\n    col(\"log_dw_bid.modeled_cap_did_override_line_item_daily_cap\")\n      .cast(BooleanType)\n      .as(\"modeled_cap_did_override_line_item_daily_cap\"),\n    col(\"log_dw_bid.modeled_cap_user_sample_rate\")\n      .as(\"modeled_cap_user_sample_rate\"),\n    when(\n      coalesce(col(\"log_impbus_impressions.device_type\").cast(IntegerType),\n        lit(99)\n      ) === lit(8),\n      coalesce(\n        col(\"log_impbus_impressions_pricing_dup.estimated_audience_imps\"),\n        lit(1.0d)\n      )\n    ).otherwise(lit(1.0d)).as(\"estimated_audience_imps\"),\n    when(\n      coalesce(col(\"log_impbus_impressions.device_type\").cast(IntegerType),\n        lit(99)\n      ) === lit(8),\n      coalesce(col(\"log_impbus_impressions_pricing_dup.audience_imps\"),\n        lit(1.0d)\n      )\n    ).otherwise(lit(1.0d)).as(\"audience_imps\"),\n    col(\"log_dw_bid.district_postal_code_lists\")\n      .as(\"district_postal_code_lists\"),\n    coalesce(\n      when(imp_type.isin(lit(4), lit(7), lit(5)),\n        coalesce(col(\"log_dw_bid.bidding_host_id\").cast(IntegerType),\n          lit(0)\n        )\n      ),\n      when((imp_type === lit(6)).and(is_not_null(col(\"log_dw_bid_deal\"))),\n        coalesce(col(\"log_dw_bid_deal.bidding_host_id\").cast(IntegerType),\n          lit(0)\n        )\n      )\n    ).as(\"bidding_host_id\"),\n    lit(null).cast(LongType).as(\"buyer_dpvp_bitmap\"),\n    lit(null).cast(LongType).as(\"seller_dpvp_bitmap\"),\n    col(\"log_impbus_impressions.browser_code_id\")\n      .cast(IntegerType)\n      .as(\"browser_code_id\"),\n    col(\"log_impbus_impressions.is_prebid_server_included\")\n      .cast(IntegerType)\n      .as(\"is_prebid_server_included\"),\n    coalesce(col(\"log_dw_bid.feature_tests_bitmap\").cast(IntegerType), lit(0))\n      .as(\"feature_tests_bitmap\"),\n    coalesce(col(\"log_impbus_impressions.private_auction_eligible\").cast(\n      BooleanType\n    ),\n      lit(0).cast(BooleanType)\n    ).as(\"private_auction_eligible\"),\n    coalesce(\n      col(\"log_impbus_impressions.chrome_traffic_label\").cast(IntegerType),\n      lit(0)\n    ).as(\"chrome_traffic_label\"),\n    coalesce(\n      col(\"log_impbus_impressions.is_private_auction\").cast(BooleanType),\n      lit(0).cast(BooleanType)\n    ).as(\"is_private_auction\"),\n    f_preempt_over_impression_95337.as(\"creative_media_subtype_id\"),\n    col(\"log_impbus_impressions.allowed_media_types\").as(\n      \"allowed_media_types\"\n    )\n  )","language":"scala","description":""}