{"initCode":"","code":"udf( \n    (\n      _l_term_id:       Integer,\n      _term_id:         Integer,\n      _l_pricing_terms: Seq[Row],\n      _i:               Integer\n    ) => {\n      var term_id         = _term_id\n      var i               = _i\n      var l_pricing_term  = Row(null, null, null, null, null, null)\n      var l_pricing_terms = _l_pricing_terms.toArray\n      var l_term_id       = _l_term_id\n\n      while (compareTo(i, l_pricing_terms.length) < 0) {\n        l_term_id = 0\n        if (\n          !_isnull(l_pricing_terms(convertToInt(i)).getAs[Integer](\"term_id\"))\n        )\n          l_term_id = convertToInt(\n            l_pricing_terms(convertToInt(i)).getAs[Integer](\"term_id\")\n          )\n        if (l_term_id == term_id)\n          l_pricing_term = l_pricing_terms(convertToInt(i))\n        i = i + convertToInt(1)\n      }\n\n      Row(\n        if (!_isnull(l_pricing_term))\n          Row(\n            convertToInt(l_pricing_term.getAs[Integer](0)),\n            l_pricing_term.getAs[Double](1),\n            l_pricing_term.getAs[Double](2),\n            l_pricing_term.getAs[Boolean](3),\n            l_pricing_term.getAs[Boolean](4),\n            convertToInt(l_pricing_term.getAs[Integer](5))\n          )\n        else\n          null,\n        convertToInt(i),\n        convertToInt(l_term_id)\n      )\n    },\n    StructType(\n      List(\n        StructField(\n          \"l_pricing_term\",\n          StructType(\n            List(\n              StructField(\"term_id\",                 IntegerType, true),\n              StructField(\"amount\",                  DoubleType,  true),\n              StructField(\"rate\",                    DoubleType,  true),\n              StructField(\"is_deduction\",            BooleanType, true),\n              StructField(\"is_media_cost_dependent\", BooleanType, true),\n              StructField(\"data_member_id\",          IntegerType, true)\n            )\n          ),\n          false\n        ),\n        StructField(\"i\",         IntegerType, false),\n        StructField(\"l_term_id\", IntegerType, false)\n      )\n    )\n  )"}