package com.microsoft.ads.data.dnv.agg_dw_clicks_pb.graph

import io.prophecy.libs._
import com.microsoft.ads.data.dnv.agg_dw_clicks_pb.udfs.PipelineInitCode._
import com.microsoft.ads.data.dnv.agg_dw_clicks_pb.udfs.UDFs._
import com.microsoft.ads.data.dnv.agg_dw_clicks_pb.udfs.ColumnFunctions._
import com.microsoft.ads.data.dnv.agg_dw_clicks_pb.config.Context
import org.apache.spark._
import org.apache.spark.sql._
import org.apache.spark.sql.functions._
import org.apache.spark.sql.types._
import org.apache.spark.sql.expressions._
import java.time._

object Join_AE_with_CrossNetCPC_agg_dw_impressions {

  def apply(context: Context, left: DataFrame, right: DataFrame): DataFrame =
    left
      .as("left")
      .join(right.as("right"),
            col("left.auction_id_64") === col("right.auction_id_64"),
            "left_anti"
      )
      .select(
        col("left.date_time").as("date_time"),
        col("left.auction_id_64").as("auction_id_64"),
        col("left.user_id_64").as("user_id_64"),
        col("left.tag_id").as("tag_id"),
        col("left.venue_id").as("venue_id"),
        col("left.inventory_source_id").as("inventory_source_id"),
        col("left.session_frequency").as("session_frequency"),
        col("left.site_domain").as("site_domain"),
        col("left.width").as("width"),
        col("left.height").as("height"),
        col("left.geo_country").as("geo_country"),
        col("left.geo_region").as("geo_region"),
        col("left.gender").as("gender"),
        col("left.age").as("age"),
        col("left.seller_member_id").as("seller_member_id"),
        col("left.buyer_member_id").as("buyer_member_id"),
        col("left.creative_id").as("creative_id"),
        col("left.seller_currency").as("seller_currency"),
        col("left.buyer_currency").as("buyer_currency"),
        col("left.buyer_bid").as("buyer_bid"),
        col("left.buyer_spend").as("buyer_spend"),
        col("left.ecp").as("ecp"),
        col("left.reserve_price").as("reserve_price"),
        col("left.advertiser_id").as("advertiser_id"),
        col("left.campaign_group_id").as("campaign_group_id"),
        col("left.campaign_id").as("campaign_id"),
        col("left.creative_freq").as("creative_freq"),
        col("left.creative_rec").as("creative_rec"),
        col("left.is_learn").as("is_learn"),
        col("left.is_remarketing").as("is_remarketing"),
        col("left.advertiser_frequency").as("advertiser_frequency"),
        col("left.advertiser_recency").as("advertiser_recency"),
        col("left.user_group_id").as("user_group_id"),
        col("left.camp_dp_id").as("camp_dp_id"),
        col("left.media_buy_id").as("media_buy_id"),
        col("left.media_buy_cost").as("media_buy_cost"),
        col("left.brand_id").as("brand_id"),
        col("left.cleared_direct").as("cleared_direct"),
        col("left.clear_fees").as("clear_fees"),
        col("left.media_buy_rev_share_pct").as("media_buy_rev_share_pct"),
        col("left.revenue_value").as("revenue_value"),
        col("left.pricing_type").as("pricing_type"),
        col("left.can_convert").as("can_convert"),
        col("left.pub_rule_id").as("pub_rule_id"),
        col("left.is_control").as("is_control"),
        col("left.control_pct").as("control_pct"),
        col("left.control_creative_id").as("control_creative_id"),
        col("left.predicted_cpm").as("predicted_cpm"),
        col("left.actual_bid").as("actual_bid"),
        col("left.site_id").as("site_id"),
        col("left.content_category_id").as("content_category_id"),
        col("left.auction_service_fees").as("auction_service_fees"),
        col("left.discrepancy_allowance").as("discrepancy_allowance"),
        col("left.forex_allowance").as("forex_allowance"),
        col("left.creative_overage_fees").as("creative_overage_fees"),
        col("left.fold_position").as("fold_position"),
        col("left.external_inv_id").as("external_inv_id"),
        col("left.cadence_modifier").as("cadence_modifier"),
        col("left.imp_type").as("imp_type"),
        col("left.advertiser_currency").as("advertiser_currency"),
        col("left.advertiser_exchange_rate").as("advertiser_exchange_rate"),
        col("left.ip_address").as("ip_address"),
        col("left.publisher_id").as("publisher_id"),
        col("left.auction_service_deduction").as("auction_service_deduction"),
        col("left.insertion_order_id").as("insertion_order_id"),
        col("left.predict_type_rev").as("predict_type_rev"),
        col("left.predict_type_goal").as("predict_type_goal"),
        col("left.predict_type_cost").as("predict_type_cost"),
        col("left.booked_revenue_dollars").as("booked_revenue_dollars"),
        col("left.booked_revenue_adv_curr").as("booked_revenue_adv_curr"),
        col("left.commission_cpm").as("commission_cpm"),
        col("left.commission_revshare").as("commission_revshare"),
        col("left.serving_fees_cpm").as("serving_fees_cpm"),
        col("left.serving_fees_revshare").as("serving_fees_revshare"),
        col("left.user_tz_offset").as("user_tz_offset"),
        col("left.media_type").as("media_type"),
        col("left.operating_system").as("operating_system"),
        col("left.browser").as("browser"),
        col("left.language").as("language"),
        col("left.publisher_currency").as("publisher_currency"),
        col("left.publisher_exchange_rate").as("publisher_exchange_rate"),
        col("left.media_cost_dollars_cpm").as("media_cost_dollars_cpm"),
        col("left.payment_type").as("payment_type"),
        col("left.revenue_type").as("revenue_type"),
        col("left.seller_revenue_cpm").as("seller_revenue_cpm"),
        col("left.bidder_id").as("bidder_id"),
        col("left.inv_code").as("inv_code"),
        col("left.application_id").as("application_id"),
        col("left.shadow_price").as("shadow_price"),
        col("left.eap").as("eap"),
        col("left.datacenter_id").as("datacenter_id"),
        col("left.imp_blacklist_or_fraud").as("imp_blacklist_or_fraud"),
        col("left.vp_expose_domains").as("vp_expose_domains"),
        col("left.vp_expose_categories").as("vp_expose_categories"),
        col("left.vp_expose_pubs").as("vp_expose_pubs"),
        col("left.vp_expose_tag").as("vp_expose_tag"),
        col("left.vp_expose_age").as("vp_expose_age"),
        col("left.vp_expose_gender").as("vp_expose_gender"),
        col("left.inventory_url_id").as("inventory_url_id"),
        col("left.audit_type").as("audit_type"),
        col("left.is_exclusive").as("is_exclusive"),
        col("left.truncate_ip").as("truncate_ip"),
        col("left.device_id").as("device_id"),
        col("left.carrier_id").as("carrier_id"),
        col("left.creative_audit_status").as("creative_audit_status"),
        col("left.is_creative_hosted").as("is_creative_hosted"),
        col("left.seller_deduction").as("seller_deduction"),
        col("left.city").as("city"),
        col("left.latitude").as("latitude"),
        col("left.longitude").as("longitude"),
        col("left.device_unique_id").as("device_unique_id"),
        col("left.package_id").as("package_id"),
        col("left.targeted_segments").as("targeted_segments"),
        col("left.supply_type").as("supply_type"),
        col("left.is_toolbar").as("is_toolbar"),
        col("left.deal_id").as("deal_id"),
        col("left.vp_bitmap").as("vp_bitmap"),
        col("left.view_detection_enabled").as("view_detection_enabled"),
        col("left.view_result").as("view_result"),
        col("left.ozone_id").as("ozone_id"),
        col("left.is_performance").as("is_performance"),
        col("left.sdk_version").as("sdk_version"),
        col("left.inventory_session_frequency")
          .as("inventory_session_frequency"),
        col("left.device_type").as("device_type"),
        col("left.dma").as("dma"),
        col("left.postal").as("postal"),
        col("left.viewdef_definition_id").as("viewdef_definition_id"),
        col("left.viewdef_viewable").as("viewdef_viewable"),
        col("left.view_measurable").as("view_measurable"),
        col("left.viewable").as("viewable"),
        col("left.is_secure").as("is_secure"),
        col("left.view_non_measurable_reason").as("view_non_measurable_reason"),
        col("left.data_costs").as("data_costs"),
        col("left.bidder_instance_id").as("bidder_instance_id"),
        col("left.campaign_group_freq").as("campaign_group_freq"),
        col("left.campaign_group_rec").as("campaign_group_rec"),
        col("left.insertion_order_freq").as("insertion_order_freq"),
        col("left.insertion_order_rec").as("insertion_order_rec"),
        col("left.buyer_gender").as("buyer_gender"),
        col("left.buyer_age").as("buyer_age"),
        col("left.targeted_segment_list").as("targeted_segment_list"),
        col("left.custom_model_id").as("custom_model_id"),
        col("left.custom_model_last_modified").as("custom_model_last_modified"),
        col("left.custom_model_output_code").as("custom_model_output_code"),
        col("left.external_uid").as("external_uid"),
        col("left.request_uuid").as("request_uuid"),
        col("left.mobile_app_instance_id").as("mobile_app_instance_id"),
        col("left.traffic_source_code").as("traffic_source_code"),
        col("left.external_request_id").as("external_request_id"),
        col("left.stitch_group_id").as("stitch_group_id"),
        col("left.deal_type").as("deal_type"),
        col("left.ym_floor_id").as("ym_floor_id"),
        col("left.ym_bias_id").as("ym_bias_id"),
        col("left.bid_priority").as("bid_priority"),
        col("left.buyer_charges").as("buyer_charges"),
        col("left.seller_charges").as("seller_charges"),
        col("left.explore_disposition").as("explore_disposition"),
        col("left.device_make_id").as("device_make_id"),
        col("left.operating_system_family_id").as("operating_system_family_id"),
        col("left.tag_sizes").as("tag_sizes"),
        col("left.campaign_group_models").as("campaign_group_models"),
        col("left.pricing_media_type").as("pricing_media_type"),
        col("left.buyer_trx_event_id").as("buyer_trx_event_id"),
        col("left.seller_trx_event_id").as("seller_trx_event_id"),
        col("left.revenue_auction_event_type").as("revenue_auction_event_type"),
        col("left.is_prebid").as("is_prebid"),
        col("left.is_unit_of_trx").as("is_unit_of_trx"),
        col("left.imps_for_budget_caps_pacing")
          .as("imps_for_budget_caps_pacing"),
        col("left.auction_timestamp").as("auction_timestamp"),
        col("left.two_phase_reduction_applied")
          .as("two_phase_reduction_applied"),
        col("left.region_id").as("region_id"),
        col("left.media_company_id").as("media_company_id"),
        col("left.trade_agreement_id").as("trade_agreement_id"),
        col("left.personal_data").as("personal_data"),
        col("left.anonymized_user_info").as("anonymized_user_info"),
        col("left.gdpr_consent_cookie").as("gdpr_consent_cookie"),
        col("left.additional_clearing_events").as("additional_clearing_events"),
        col("left.fx_rate_snapshot_id").as("fx_rate_snapshot_id"),
        col("left.crossdevice_group_anon").as("crossdevice_group_anon"),
        col("left.crossdevice_graph_cost").as("crossdevice_graph_cost"),
        col("left.revenue_event_type_id").as("revenue_event_type_id"),
        col("left.buyer_trx_event_type_id").as("buyer_trx_event_type_id"),
        col("left.seller_trx_event_type_id").as("seller_trx_event_type_id"),
        col("left.external_creative_id").as("external_creative_id"),
        col("left.targeted_segment_details").as("targeted_segment_details"),
        col("left.bidder_seat_id").as("bidder_seat_id"),
        col("left.is_whiteops_scanned").as("is_whiteops_scanned"),
        col("left.default_referrer_url").as("default_referrer_url"),
        col("left.is_curated").as("is_curated"),
        col("left.curator_member_id").as("curator_member_id"),
        col("left.total_partner_fees_microcents")
          .as("total_partner_fees_microcents"),
        col("left.net_buyer_spend").as("net_buyer_spend"),
        col("left.is_prebid_server").as("is_prebid_server"),
        col("left.cold_start_price_type").as("cold_start_price_type"),
        col("left.discovery_state").as("discovery_state"),
        col("left.billing_period_id").as("billing_period_id"),
        col("left.flight_id").as("flight_id"),
        col("left.split_id").as("split_id"),
        col("left.net_media_cost_dollars_cpm").as("net_media_cost_dollars_cpm"),
        col("left.total_data_costs_microcents")
          .as("total_data_costs_microcents"),
        col("left.total_profit_microcents").as("total_profit_microcents"),
        col("left.targeted_crossdevice_graph_id")
          .as("targeted_crossdevice_graph_id"),
        col("left.discovery_prediction").as("discovery_prediction"),
        col("left.campaign_group_type_id").as("campaign_group_type_id"),
        col("left.hb_source").as("hb_source"),
        col("left.external_campaign_id").as("external_campaign_id"),
        col("left.excluded_targeted_segment_details")
          .as("excluded_targeted_segment_details"),
        col("left.trust_id").as("trust_id"),
        col("left.predicted_kpi_event_rate").as("predicted_kpi_event_rate"),
        col("left.has_crossdevice_reach_extension")
          .as("has_crossdevice_reach_extension"),
        col("left.crossdevice_graph_membership")
          .as("crossdevice_graph_membership"),
        col("left.total_segment_data_costs_microcents")
          .as("total_segment_data_costs_microcents"),
        col("left.total_feature_costs_microcents")
          .as("total_feature_costs_microcents"),
        col("left.counterparty_ruleset_type").as("counterparty_ruleset_type"),
        col("left.log_product_ads").as("log_product_ads"),
        col("left.buyer_line_item_currency").as("buyer_line_item_currency"),
        col("left.deal_line_item_currency").as("deal_line_item_currency"),
        col("left.measurement_fee_usd").as("measurement_fee_usd"),
        col("left.measurement_provider_member_id")
          .as("measurement_provider_member_id"),
        col("left.offline_attribution_provider_member_id")
          .as("offline_attribution_provider_member_id"),
        col("left.offline_attribution_cost_usd_cpm")
          .as("offline_attribution_cost_usd_cpm"),
        col("left.pred_info").as("pred_info"),
        col("left.imp_rejecter_do_auction").as("imp_rejecter_do_auction"),
        col("left.personal_identifiers").as("personal_identifiers"),
        col("left.imp_rejecter_applied").as("imp_rejecter_applied"),
        col("left.ip_derived_latitude").as("ip_derived_latitude"),
        col("left.ip_derived_longitude").as("ip_derived_longitude"),
        col("left.personal_identifiers_experimental")
          .as("personal_identifiers_experimental"),
        col("left.postal_code_ext_id").as("postal_code_ext_id"),
        col("left.ecpm_conversion_rate").as("ecpm_conversion_rate"),
        col("left.is_residential_ip").as("is_residential_ip"),
        col("left.hashed_ip").as("hashed_ip"),
        col("left.targeted_segment_details_by_id_type")
          .as("targeted_segment_details_by_id_type"),
        col("left.offline_attribution").as("offline_attribution"),
        col("left.frequency_cap_type_internal")
          .as("frequency_cap_type_internal"),
        col("left.modeled_cap_did_override_line_item_daily_cap")
          .as("modeled_cap_did_override_line_item_daily_cap"),
        col("left.modeled_cap_user_sample_rate")
          .as("modeled_cap_user_sample_rate"),
        col("left.estimated_audience_imps").as("estimated_audience_imps"),
        col("left.audience_imps").as("audience_imps"),
        col("left.district_postal_code_lists").as("district_postal_code_lists"),
        col("left.bidding_host_id").as("bidding_host_id"),
        col("left.buyer_dpvp_bitmap").as("buyer_dpvp_bitmap"),
        col("left.seller_dpvp_bitmap").as("seller_dpvp_bitmap"),
        col("left.browser_code_id").as("browser_code_id"),
        col("left.is_prebid_server_included").as("is_prebid_server_included"),
        col("left.feature_tests_bitmap").as("feature_tests_bitmap"),
        col("left.private_auction_eligible").as("private_auction_eligible"),
        col("left.chrome_traffic_label").as("chrome_traffic_label"),
        col("left.is_private_auction").as("is_private_auction"),
        col("left.creative_media_subtype_id").as("creative_media_subtype_id"),
        col("left.allowed_media_types").as("allowed_media_types")
      )

}
