{"parameters":[{"name":"curator_member_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"discrepancy_allowance","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"should_process_views","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"buyer_member_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"imps_for_budget_caps_pacing","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"imp_type","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"is_curated","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"view_detection_enabled","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"buyer_trx_event_type_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"commission_revshare","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"creative_overage_fees","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"viewdef_definition_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"virtual_log_dw_bid","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"has_buyer_transacted","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"payment_type_normalized","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"seller_trx_event_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"seller_revenue_cpm","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"insertion_order_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"revenue_type_normalized","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"billing_period_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"viewdef_viewable","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"split_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"data_costs_deal","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"seller_charges_pricing_terms","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"f_preempt_over_impression_94298","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"commission_cpm","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"v_transaction_event_pricing","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"buyer_trx_event_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"campaign_group_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"has_seller_transacted","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"buyer_charges_pricing_terms","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"revenue_value","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"campaign_group_type_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"should_zero_seller_revenue","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"view_measurable","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"advertiser_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"media_cost_dollars_cpm","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"creative_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"f_preempt_over_impression_95337","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"flight_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"viewable","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"auction_service_deduction","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"media_buy_cost","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"seller_deduction","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"buyer_spend_cpm","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"seller_trx_event_type_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"auction_service_fees","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"serving_fees_cpm","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"data_costs","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"sup_ip_range_lookup_count","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"ttl","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"view_result","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"is_dw_normalized","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"booked_revenue_adv_curr","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"booked_revenue_dollars","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"deal_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"_f_is_buy_side","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"deal_type","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"campaign_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"is_placeholder_bid","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"serving_fees_revshare","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"view_non_measurable_reason","type":"column","metadata":{"description":"","tags":[],"mappings":[]}}],"isCustomSchemaEnabled":false,"code":"struct(coalesce(col(\"log_dw_view.date_time\").cast(LongType), when((ttl > lit(3600)) and is_not_null(col(\"log_impbus_preempt.date_time\").cast(LongType)), col(\"log_impbus_preempt.date_time\").cast(LongType)), col(\"date_time\").cast(LongType)).as(\"date_time\"),col(\"auction_id_64\").cast(LongType).as(\"auction_id_64\"),coalesce(when(col(\"log_dw_view.user_id_64\").cast(LongType) =!= lit(0), col(\"log_dw_view.user_id_64\").cast(LongType)), when(col(\"log_impbus_impressions.user_id_64\").cast(LongType) =!= lit(0), col(\"log_impbus_impressions.user_id_64\").cast(LongType))).as(\"user_id_64\"),when(col(\"log_impbus_impressions.tag_id\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.tag_id\").cast(IntegerType)).as(\"tag_id\"),when(col(\"log_impbus_impressions.venue_id\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.venue_id\").cast(IntegerType)).as(\"venue_id\"),when(col(\"log_impbus_impressions.inventory_source_id\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.inventory_source_id\").cast(IntegerType)).as(\"inventory_source_id\"),lit(null).as(\"session_frequency\"),when(string_compare(col(\"log_impbus_impressions.site_domain\"), lit(\"---\")) =!= lit(0), col(\"log_impbus_impressions.site_domain\")).as(\"site_domain\"),f_preempt_over_impression_non_zero_explicit(is_not_null(col(\"log_impbus_preempt\")), col(\"log_impbus_impressions.width\").cast(IntegerType), col(\"log_impbus_preempt.width\").cast(IntegerType)).as(\"width\"),f_preempt_over_impression_non_zero_explicit(is_not_null(col(\"log_impbus_preempt\")), col(\"log_impbus_impressions.height\").cast(IntegerType), col(\"log_impbus_preempt.height\").cast(IntegerType)).as(\"height\"),when(string_compare(col(\"log_impbus_impressions.geo_country\"), lit(\"--\")) =!= lit(0), col(\"log_impbus_impressions.geo_country\")).as(\"geo_country\"),when(string_compare(col(\"log_impbus_impressions.geo_region\"), lit(\"--\")) =!= lit(0), col(\"log_impbus_impressions.geo_region\")).as(\"geo_region\"),when(string_compare(col(\"log_impbus_impressions.gender\"), lit(\"u\")) =!= lit(0), col(\"log_impbus_impressions.gender\")).as(\"gender\"),when(col(\"log_impbus_impressions.age\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.age\").cast(IntegerType)).as(\"age\"),col(\"seller_member_id\").cast(IntegerType).as(\"seller_member_id\"),when(col(\"imp_type\").cast(IntegerType) =!= lit(1), buyer_member_id).otherwise(lit(0)).as(\"buyer_member_id\"),creative_id.as(\"creative_id\"),when(string_compare(col(\"log_impbus_impressions.seller_currency\"), lit(\"\")) =!= lit(0), col(\"log_impbus_impressions.seller_currency\")).as(\"seller_currency\"),when(string_compare(col(\"log_impbus_impressions.buyer_currency\"), lit(\"\")) =!= lit(0), col(\"log_impbus_impressions.buyer_currency\")).as(\"buyer_currency\"),f_preempt_over_impression_non_zero_explicit(is_not_null(col(\"log_impbus_preempt\")), col(\"log_impbus_impressions.buyer_bid\"), col(\"log_impbus_preempt.buyer_bid\")).as(\"buyer_bid\"),coalesce(when(imp_type.isin(lit(8), lit(1), lit(3)), lit(0)), when(imp_type === lit(5), col(\"log_dw_bid.price\")), buyer_spend_cpm).as(\"buyer_spend\"),when(col(\"log_impbus_impressions.ecp\") =!= lit(0), col(\"log_impbus_impressions.ecp\")).as(\"ecp\"),when(col(\"log_impbus_impressions.reserve_price\") =!= lit(0.0), col(\"log_impbus_impressions.reserve_price\")).as(\"reserve_price\"),coalesce(when(((col(\"imp_type\").cast(IntegerType) === lit(1)) or (buyer_member_id === lit(0))) and is_not_null(advertiser_id), lit(0)), advertiser_id).as(\"advertiser_id\"),coalesce(when(((col(\"imp_type\").cast(IntegerType) === lit(1)) or (buyer_member_id === lit(0))) and is_not_null(campaign_group_id), lit(0)), campaign_group_id).as(\"campaign_group_id\"),coalesce(when(((col(\"imp_type\").cast(IntegerType) === lit(1)) or (buyer_member_id === lit(0))) and is_not_null(campaign_id), lit(0)), when((imp_type =!= lit(6)) and (campaign_id =!= lit(0)), campaign_id)).as(\"campaign_id\"),coalesce(when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.creative_freq\").cast(IntegerType) =!= lit(0)), col(\"log_dw_bid.creative_freq\").cast(IntegerType)), when(_f_is_buy_side === lit(0), virtual_log_dw_bid.getField(\"creative_freq\"))).as(\"creative_freq\"),coalesce(when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.creative_rec\").cast(IntegerType) =!= lit(0)), col(\"log_dw_bid.creative_rec\").cast(IntegerType)), when(_f_is_buy_side === lit(0), virtual_log_dw_bid.getField(\"creative_rec\"))).as(\"creative_rec\"),coalesce(when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.predict_type\").cast(IntegerType) === lit(1)), lit(1)), when((_f_is_buy_side === lit(1)) and ((col(\"log_dw_bid.predict_type\").cast(IntegerType) === lit(0)) or ((col(\"log_dw_bid.predict_type\").cast(IntegerType) >= lit(2)) and (col(\"log_dw_bid.predict_type\").cast(IntegerType) =!= lit(9)))), lit(2)), lit(0)).as(\"is_learn\"),when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.is_remarketing\").cast(IntegerType) =!= lit(0)), col(\"log_dw_bid.is_remarketing\").cast(IntegerType)).as(\"is_remarketing\"),coalesce(when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.advertiser_freq\").cast(IntegerType) =!= lit(0)), col(\"log_dw_bid.advertiser_freq\").cast(IntegerType)), when((_f_is_buy_side === lit(1)) and (imp_type === lit(9)), lit(0)), when(_f_is_buy_side === lit(0), virtual_log_dw_bid.getField(\"advertiser_freq\"))).as(\"advertiser_frequency\"),coalesce(when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.advertiser_rec\").cast(IntegerType) =!= lit(0)), col(\"log_dw_bid.advertiser_rec\").cast(IntegerType)), when((_f_is_buy_side === lit(1)) and (imp_type === lit(9)), lit(0)), when(_f_is_buy_side === lit(0), virtual_log_dw_bid.getField(\"advertiser_rec\"))).as(\"advertiser_recency\"),coalesce(when(col(\"log_impbus_impressions.user_id_64\").cast(LongType) > lit(9223372036854775807L).cast(LongType), lit(-1)), when(((((is_placeholder_bid === lit(1)) or (col(\"imp_type\").cast(IntegerType) === lit(1))) or (col(\"imp_type\").cast(IntegerType) === lit(3))) or (imp_type === lit(8))) and is_not_null(col(\"log_impbus_impressions.user_id_64\").cast(LongType)), col(\"log_impbus_impressions.user_id_64\").cast(LongType) % lit(1000)), when((virtual_log_dw_bid.getField(\"log_type\") === lit(2)) or (is_not_null(col(\"log_dw_bid.log_type\").cast(IntegerType)) and (col(\"log_dw_bid.log_type\").cast(IntegerType) === lit(2))), col(\"log_impbus_impressions.user_group_id\").cast(IntegerType)), col(\"log_dw_bid.user_group_id\").cast(IntegerType)).as(\"user_group_id\"),lit(null).as(\"camp_dp_id\"),coalesce(when(imp_type.isin(lit(8), lit(1), lit(3)), lit(0)), col(\"publisher_id\").cast(IntegerType)).as(\"media_buy_id\"),media_buy_cost.as(\"media_buy_cost\"),f_preempt_over_impression_non_zero_explicit(is_not_null(col(\"log_impbus_preempt\")), col(\"log_impbus_impressions.brand_id\").cast(IntegerType), col(\"log_impbus_preempt.brand_id\").cast(IntegerType)).as(\"brand_id\"),f_preempt_over_impression_non_zero_explicit(is_not_null(col(\"log_impbus_preempt\")), col(\"log_impbus_impressions.cleared_direct\").cast(IntegerType), col(\"log_impbus_preempt.cleared_direct\").cast(IntegerType)).as(\"cleared_direct\"),lit(null).as(\"clear_fees\"),when(imp_type =!= lit(9), col(\"log_impbus_impressions.media_buy_rev_share_pct\")).otherwise(col(\"log_dw_bid.media_buy_rev_share_pct\")).as(\"media_buy_rev_share_pct\"),revenue_value.as(\"revenue_value\"),coalesce(when((_f_is_buy_side === lit(1)) and (string_compare(col(\"log_dw_bid.pricing_type\"), lit(\"--\")) =!= lit(0)), col(\"log_dw_bid.pricing_type\")), when(_f_is_buy_side === lit(0), virtual_log_dw_bid.getField(\"pricing_type\"))).as(\"pricing_type\"),when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.can_convert\").cast(IntegerType) =!= lit(0)), col(\"log_dw_bid.can_convert\").cast(IntegerType)).as(\"can_convert\"),coalesce(when((((is_placeholder_bid === lit(1)) or (col(\"imp_type\").cast(IntegerType) === lit(1))) or (col(\"imp_type\").cast(IntegerType) === lit(3))) or (imp_type === lit(8)), lit(0)), col(\"log_impbus_impressions.pub_rule_id\").cast(IntegerType)).as(\"pub_rule_id\"),coalesce(when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.is_control\").cast(IntegerType) =!= lit(0)), col(\"log_dw_bid.is_control\").cast(IntegerType)), when((_f_is_buy_side === lit(0)) and (virtual_log_dw_bid.getField(\"is_control\") =!= lit(0)), virtual_log_dw_bid.getField(\"is_control\"))).as(\"is_control\"),when(col(\"log_dw_bid.control_pct\") =!= lit(0), col(\"log_dw_bid.control_pct\")).as(\"control_pct\"),when(col(\"log_dw_bid.control_creative_id\").cast(IntegerType) =!= lit(0), col(\"log_dw_bid.control_creative_id\").cast(IntegerType)).as(\"control_creative_id\"),lit(null).as(\"predicted_cpm\"),coalesce(when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.price\") > lit(999)), lit(999)), when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.price\") <= lit(999)), col(\"log_dw_bid.price\")), lit(0)).as(\"actual_bid\"),when(col(\"log_impbus_impressions.site_id\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.site_id\").cast(IntegerType)).as(\"site_id\"),when(col(\"log_impbus_impressions.content_category_id\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.content_category_id\").cast(IntegerType)).as(\"content_category_id\"),coalesce(when(((imp_type === lit(6)) and (is_dw_normalized === lit(1))) and (should_process_views === lit(1)), lit(0)), when(((imp_type === lit(7)) and (is_dw_normalized === lit(1))) and (should_process_views === lit(1)), auction_service_fees), when(((imp_type === lit(7)) and (is_dw_normalized === lit(0))) and (should_process_views === lit(1)), auction_service_fees), when(f_is_non_cpm_payment_or_payment(imp_type, payment_type_normalized, revenue_type_normalized) === lit(1), lit(0)).otherwise(auction_service_fees)).as(\"auction_service_fees\"),coalesce(when(((imp_type === lit(6)) and (is_dw_normalized === lit(1))) and (should_process_views === lit(1)), lit(0)), when(((imp_type === lit(7)) and (is_dw_normalized === lit(1))) and (should_process_views === lit(1)), discrepancy_allowance), when(((imp_type === lit(7)) and (is_dw_normalized === lit(0))) and (should_process_views === lit(1)), discrepancy_allowance), when(f_is_non_cpm_payment_or_payment(imp_type, payment_type_normalized, revenue_type_normalized) === lit(1), lit(0)).otherwise(discrepancy_allowance)).as(\"discrepancy_allowance\"),lit(null).as(\"forex_allowance\"),coalesce(when(((imp_type === lit(6)) and (is_dw_normalized === lit(1))) and (should_process_views === lit(1)), lit(0)), when(((imp_type === lit(7)) and (is_dw_normalized === lit(1))) and (should_process_views === lit(1)), creative_overage_fees), when(((imp_type === lit(7)) and (is_dw_normalized === lit(0))) and (should_process_views === lit(1)), creative_overage_fees), when(f_is_non_cpm_payment_or_payment(imp_type, payment_type_normalized, revenue_type_normalized) === lit(1), lit(0)).otherwise(creative_overage_fees)).as(\"creative_overage_fees\"),coalesce(col(\"log_impbus_impressions.fold_position\").cast(IntegerType), lit(0)).as(\"fold_position\"),when(col(\"log_impbus_impressions.external_inv_id\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.external_inv_id\").cast(IntegerType)).as(\"external_inv_id\"),coalesce(when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.cadence_modifier\") =!= lit(0)), col(\"log_dw_bid.cadence_modifier\")), when((_f_is_buy_side === lit(0)) and (virtual_log_dw_bid.getField(\"cadence_modifier\") =!= lit(0)), virtual_log_dw_bid.getField(\"cadence_modifier\"))).as(\"cadence_modifier\"),col(\"imp_type\").cast(IntegerType).as(\"imp_type\"),coalesce(when(_f_is_buy_side === lit(1), col(\"log_dw_bid.advertiser_currency\")), lit(\"USD\")).as(\"advertiser_currency\"),coalesce(when((((_f_is_buy_side === lit(1)) and is_not_null(col(\"log_dw_bid.advertiser_exchange_rate\"))) and (col(\"log_dw_bid.advertiser_exchange_rate\") =!= lit(1.0))) and (col(\"log_dw_bid.advertiser_exchange_rate\") =!= lit(0.0)), col(\"log_dw_bid.advertiser_exchange_rate\")), lit(1.0)).as(\"advertiser_exchange_rate\"),col(\"log_impbus_impressions.ip_address\").as(\"ip_address\"),when(col(\"log_impbus_impressions.publisher_id\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.publisher_id\").cast(IntegerType)).as(\"publisher_id\"),coalesce(when(((imp_type === lit(6)) and (is_dw_normalized === lit(1))) and (should_process_views === lit(1)), lit(0)), when(((imp_type === lit(7)) and (is_dw_normalized === lit(1))) and (should_process_views === lit(1)), auction_service_deduction), when(((imp_type === lit(7)) and (is_dw_normalized === lit(0))) and (should_process_views === lit(1)), auction_service_deduction), when(f_is_non_cpm_payment_or_payment(imp_type, payment_type_normalized, revenue_type_normalized) === lit(1), lit(0)).otherwise(auction_service_deduction)).as(\"auction_service_deduction\"),coalesce(when(((col(\"imp_type\").cast(IntegerType) === lit(1)) or (buyer_member_id === lit(0))) and is_not_null(insertion_order_id), lit(0)), when(insertion_order_id =!= lit(0), insertion_order_id)).as(\"insertion_order_id\"),coalesce(when(_f_is_buy_side === lit(1), col(\"log_dw_bid.predict_type\").cast(IntegerType)), when(_f_is_buy_side === lit(0), virtual_log_dw_bid.getField(\"predict_type\"))).as(\"predict_type_rev\"),coalesce(when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.predict_type_goal\").cast(IntegerType) =!= lit(0)), col(\"log_dw_bid.predict_type_goal\").cast(IntegerType)), when(_f_is_buy_side === lit(0), virtual_log_dw_bid.getField(\"predict_type_goal\"))).as(\"predict_type_goal\"),coalesce(when(_f_is_buy_side === lit(1), col(\"log_dw_bid.predict_type\").cast(IntegerType)), when(_f_is_buy_side === lit(0), virtual_log_dw_bid.getField(\"predict_type\"))).as(\"predict_type_cost\"),booked_revenue_dollars.as(\"booked_revenue_dollars\"),booked_revenue_adv_curr.as(\"booked_revenue_adv_curr\"),when(commission_cpm =!= lit(0), commission_cpm).as(\"commission_cpm\"),when(commission_revshare =!= lit(0), commission_revshare).as(\"commission_revshare\"),when(serving_fees_cpm =!= lit(0), serving_fees_cpm).as(\"serving_fees_cpm\"),when(serving_fees_revshare =!= lit(0), serving_fees_revshare).as(\"serving_fees_revshare\"),when(col(\"log_impbus_impressions.user_tz_offset\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.user_tz_offset\").cast(IntegerType)).as(\"user_tz_offset\"),f_preempt_over_impression_non_zero_explicit(is_not_null(col(\"log_impbus_preempt.media_type\").cast(IntegerType)), col(\"log_impbus_impressions.media_type\").cast(IntegerType), col(\"log_impbus_preempt.media_type\").cast(IntegerType)).as(\"media_type\"),when(col(\"log_impbus_impressions.operating_system\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.operating_system\").cast(IntegerType)).as(\"operating_system\"),when(col(\"log_impbus_impressions.browser\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.browser\").cast(IntegerType)).as(\"browser\"),when(col(\"log_impbus_impressions.language\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.language\").cast(IntegerType)).as(\"language\"),col(\"log_impbus_impressions.seller_currency\").as(\"publisher_currency\"),coalesce(when(is_not_null(col(\"log_impbus_impressions.seller_exchange_rate\")) and (col(\"log_impbus_impressions.seller_exchange_rate\") =!= lit(1.0)), col(\"log_impbus_impressions.seller_exchange_rate\")), lit(1.0)).as(\"publisher_exchange_rate\"),media_cost_dollars_cpm.as(\"media_cost_dollars_cpm\"),coalesce(when((is_placeholder_bid === lit(1)) or (((col(\"imp_type\").cast(IntegerType) === lit(1)) or (col(\"imp_type\").cast(IntegerType) === lit(3))) or (imp_type === lit(8))), lit(0)), payment_type_normalized).as(\"payment_type\"),coalesce(when((is_placeholder_bid === lit(1)) or ((((col(\"imp_type\").cast(IntegerType) === lit(1)) or (imp_type === lit(2))) or (col(\"imp_type\").cast(IntegerType) === lit(3))) or (imp_type === lit(8))), lit(-1)), revenue_type_normalized).as(\"revenue_type\"),coalesce(when(should_zero_seller_revenue.cast(BooleanType), lit(0)), when((v_transaction_event_pricing.getField(\"buyer_charges\").getField(\"is_dw\") === lit(1)) and (col(\"seller_member_id\").cast(IntegerType) === col(\"buyer_member_id\").cast(IntegerType)), seller_revenue_cpm), when(_f_is_buy_side === lit(0), seller_revenue_cpm), when(!((v_transaction_event_pricing.getField(\"buyer_charges\").getField(\"is_dw\") === lit(1)) and (col(\"seller_member_id\").cast(IntegerType) === col(\"buyer_member_id\").cast(IntegerType))), lit(0)), when(imp_type === lit(9), lit(0))).as(\"seller_revenue_cpm\"),coalesce(col(\"log_impbus_preempt.bidder_id\").cast(IntegerType), when(is_not_null(col(\"log_impbus_preempt\")), lit(0)), col(\"log_impbus_impressions.bidder_id\").cast(IntegerType)).as(\"bidder_id\"),when(string_compare(col(\"log_impbus_impressions.inv_code\"), lit(\"---\")) =!= lit(0), col(\"log_impbus_impressions.inv_code\")).as(\"inv_code\"),when(string_compare(col(\"log_impbus_impressions.application_id\"), lit(\"---\")) =!= lit(0), col(\"log_impbus_impressions.application_id\")).as(\"application_id\"),when(col(\"log_impbus_impressions.shadow_price\") =!= lit(0.0), col(\"log_impbus_impressions.shadow_price\")).as(\"shadow_price\"),when(col(\"log_impbus_impressions.eap\") =!= lit(0), col(\"log_impbus_impressions.eap\")).as(\"eap\"),when(col(\"log_impbus_impressions.datacenter_id\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.datacenter_id\").cast(IntegerType)).as(\"datacenter_id\"),when(col(\"log_impbus_impressions.imp_blacklist_or_fraud\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.imp_blacklist_or_fraud\").cast(IntegerType)).as(\"imp_blacklist_or_fraud\"),f_preempt_over_impression_non_zero_explicit(is_not_null(col(\"log_impbus_preempt\")), col(\"log_impbus_impressions.vp_expose_domains\").cast(IntegerType), col(\"log_impbus_preempt.vp_expose_domains\").cast(IntegerType)).as(\"vp_expose_domains\"),f_preempt_over_impression_non_zero_explicit(is_not_null(col(\"log_impbus_preempt\")), col(\"log_impbus_impressions.vp_expose_categories\").cast(IntegerType), col(\"log_impbus_preempt.vp_expose_categories\").cast(IntegerType)).as(\"vp_expose_categories\"),f_preempt_over_impression_non_zero_explicit(is_not_null(col(\"log_impbus_preempt\")), col(\"log_impbus_impressions.vp_expose_pubs\").cast(IntegerType), col(\"log_impbus_preempt.vp_expose_pubs\").cast(IntegerType)).as(\"vp_expose_pubs\"),f_preempt_over_impression_non_zero_explicit(is_not_null(col(\"log_impbus_preempt\")), col(\"log_impbus_impressions.vp_expose_tag\").cast(IntegerType), col(\"log_impbus_preempt.vp_expose_tag\").cast(IntegerType)).as(\"vp_expose_tag\"),when(col(\"log_dw_bid.vp_expose_age\").cast(IntegerType) =!= lit(0), col(\"log_dw_bid.vp_expose_age\").cast(IntegerType)).as(\"vp_expose_age\"),when(col(\"log_dw_bid.vp_expose_gender\").cast(IntegerType) =!= lit(0), col(\"log_dw_bid.vp_expose_gender\").cast(IntegerType)).as(\"vp_expose_gender\"),when(col(\"log_impbus_impressions.inventory_url_id\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.inventory_url_id\").cast(IntegerType)).as(\"inventory_url_id\"),when(col(\"log_impbus_impressions.audit_type\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.audit_type\").cast(IntegerType)).as(\"audit_type\"),when(col(\"log_impbus_impressions.is_exclusive\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.is_exclusive\").cast(IntegerType)).as(\"is_exclusive\"),when(col(\"log_impbus_impressions.truncate_ip\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.truncate_ip\").cast(IntegerType)).as(\"truncate_ip\"),when(col(\"log_impbus_impressions.device_id\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.device_id\").cast(IntegerType)).as(\"device_id\"),when(col(\"log_impbus_impressions.carrier_id\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.carrier_id\").cast(IntegerType)).as(\"carrier_id\"),f_preempt_over_impression_non_zero_explicit(is_not_null(col(\"log_impbus_preempt\")), col(\"log_impbus_impressions.creative_audit_status\").cast(IntegerType), col(\"log_impbus_preempt.creative_audit_status\").cast(IntegerType)).as(\"creative_audit_status\"),f_preempt_over_impression_non_zero_explicit(is_not_null(col(\"log_impbus_preempt\")), col(\"log_impbus_impressions.is_creative_hosted\").cast(IntegerType), col(\"log_impbus_preempt.is_creative_hosted\").cast(IntegerType)).as(\"is_creative_hosted\"),coalesce(when(should_zero_seller_revenue.cast(BooleanType), lit(0)), seller_deduction).as(\"seller_deduction\"),when(col(\"log_impbus_impressions.city\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.city\").cast(IntegerType)).as(\"city\"),when(string_compare(col(\"log_impbus_impressions.latitude\"), lit(\"\")) =!= lit(0), col(\"log_impbus_impressions.latitude\")).as(\"latitude\"),when(string_compare(col(\"log_impbus_impressions.longitude\"), lit(\"\")) =!= lit(0), col(\"log_impbus_impressions.longitude\")).as(\"longitude\"),when(string_compare(col(\"log_impbus_impressions.device_unique_id\"), lit(\"\")) =!= lit(0), col(\"log_impbus_impressions.device_unique_id\")).as(\"device_unique_id\"),when(col(\"log_impbus_impressions.package_id\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.package_id\").cast(IntegerType)).as(\"package_id\"),when((_f_is_buy_side === lit(1)) and (string_compare(col(\"log_dw_bid.targeted_segments\"), lit(\"\")) =!= lit(0)), col(\"log_dw_bid.targeted_segments\")).as(\"targeted_segments\"),when(col(\"log_impbus_impressions.supply_type\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.supply_type\").cast(IntegerType)).as(\"supply_type\"),when(col(\"log_impbus_impressions.is_toolbar\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.is_toolbar\").cast(IntegerType)).as(\"is_toolbar\"),deal_id.as(\"deal_id\"),f_preempt_over_impression_non_zero_explicit(is_not_null(col(\"log_impbus_preempt\")), col(\"log_impbus_impressions.vp_bitmap\").cast(LongType), col(\"log_impbus_preempt.vp_bitmap\").cast(LongType)).as(\"vp_bitmap\"),view_detection_enabled.as(\"view_detection_enabled\"),view_result.as(\"view_result\"),when(col(\"log_impbus_impressions.ozone_id\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.ozone_id\").cast(IntegerType)).as(\"ozone_id\"),when(col(\"log_impbus_impressions.is_performance\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.is_performance\").cast(IntegerType)).as(\"is_performance\"),when(string_compare(col(\"log_impbus_impressions.sdk_version\"), lit(\"---\")) =!= lit(0), col(\"log_impbus_impressions.sdk_version\")).as(\"sdk_version\"),when(col(\"log_impbus_impressions.inventory_session_frequency\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.inventory_session_frequency\").cast(IntegerType)).as(\"inventory_session_frequency\"),when(col(\"log_impbus_impressions.device_type\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.device_type\").cast(IntegerType)).as(\"device_type\"),when(col(\"log_impbus_impressions.dma\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.dma\").cast(IntegerType)).as(\"dma\"),when(string_compare(col(\"log_impbus_impressions.postal\"), lit(\"---\")) =!= lit(0), col(\"log_impbus_impressions.postal\")).as(\"postal\"),viewdef_definition_id.as(\"viewdef_definition_id\"),viewdef_viewable.as(\"viewdef_viewable\"),view_measurable.as(\"view_measurable\"),viewable.as(\"viewable\"),when(col(\"log_impbus_impressions.is_secure\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.is_secure\").cast(IntegerType)).as(\"is_secure\"),view_non_measurable_reason.as(\"view_non_measurable_reason\"),coalesce(when((buyer_trx_event_id === lit(1)) and (imp_type === lit(6)), data_costs_deal), when(_f_is_buy_side === lit(1), data_costs)).as(\"data_costs\"),when(col(\"log_impbus_impressions.bidder_instance_id\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.bidder_instance_id\").cast(IntegerType)).as(\"bidder_instance_id\"),coalesce(when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.campaign_group_freq\").cast(IntegerType) =!= lit(-2)), col(\"log_dw_bid.campaign_group_freq\").cast(IntegerType)), when((_f_is_buy_side === lit(0)) and (virtual_log_dw_bid.getField(\"campaign_group_freq\") =!= lit(-2)), virtual_log_dw_bid.getField(\"campaign_group_freq\"))).as(\"campaign_group_freq\"),coalesce(when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.campaign_group_rec\").cast(IntegerType) =!= lit(0)), col(\"log_dw_bid.campaign_group_rec\").cast(IntegerType)), when(_f_is_buy_side === lit(0), virtual_log_dw_bid.getField(\"campaign_group_rec\"))).as(\"campaign_group_rec\"),coalesce(when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.insertion_order_freq\").cast(IntegerType) =!= lit(-2)), col(\"log_dw_bid.insertion_order_freq\").cast(IntegerType)), when((_f_is_buy_side === lit(0)) and (virtual_log_dw_bid.getField(\"insertion_order_freq\") =!= lit(-2)), virtual_log_dw_bid.getField(\"insertion_order_freq\"))).as(\"insertion_order_freq\"),coalesce(when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.insertion_order_rec\").cast(IntegerType) =!= lit(0)), col(\"log_dw_bid.insertion_order_rec\").cast(IntegerType)), when(_f_is_buy_side === lit(0), virtual_log_dw_bid.getField(\"insertion_order_rec\"))).as(\"insertion_order_rec\"),when((_f_is_buy_side === lit(1)) and (string_compare(col(\"log_dw_bid.buyer_gender\"), lit(\"u\")) =!= lit(0)), col(\"log_dw_bid.buyer_gender\")).as(\"buyer_gender\"),coalesce(when(((_f_is_buy_side === lit(1)) and is_not_null(col(\"log_dw_bid.buyer_age\").cast(IntegerType))) and (col(\"log_dw_bid.buyer_age\").cast(IntegerType) =!= lit(-1)), col(\"log_dw_bid.buyer_age\").cast(IntegerType)), lit(0)).as(\"buyer_age\"),when((_f_is_buy_side === lit(1)) and is_not_null(col(\"log_dw_bid.targeted_segment_list\")), col(\"log_dw_bid.targeted_segment_list\")).as(\"targeted_segment_list\"),when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.custom_model_id\").cast(IntegerType) =!= lit(0)), col(\"log_dw_bid.custom_model_id\").cast(IntegerType)).as(\"custom_model_id\"),when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.custom_model_last_modified\").cast(LongType) =!= lit(0)), col(\"log_dw_bid.custom_model_last_modified\").cast(LongType)).as(\"custom_model_last_modified\"),coalesce(when((_f_is_buy_side === lit(1)) and (string_compare(col(\"log_dw_bid.custom_model_output_code\"), lit(\"\")) =!= lit(0)), col(\"log_dw_bid.custom_model_output_code\")), when(_f_is_buy_side === lit(0), virtual_log_dw_bid.getField(\"custom_model_output_code\"))).as(\"custom_model_output_code\"),when(string_compare(col(\"log_impbus_impressions.external_uid\"), lit(\"---\")) =!= lit(0), col(\"log_impbus_impressions.external_uid\")).as(\"external_uid\"),when(string_compare(col(\"log_impbus_impressions.request_uuid\"), lit(\"---\")) =!= lit(0), col(\"log_impbus_impressions.request_uuid\")).as(\"request_uuid\"),when(col(\"log_impbus_impressions.mobile_app_instance_id\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.mobile_app_instance_id\").cast(IntegerType)).as(\"mobile_app_instance_id\"),when(string_compare(col(\"log_impbus_impressions.traffic_source_code\"), lit(\"---\")) =!= lit(0), col(\"log_impbus_impressions.traffic_source_code\")).as(\"traffic_source_code\"),when(string_compare(col(\"log_impbus_impressions.external_request_id\"), lit(\"---\")) =!= lit(0), col(\"log_impbus_impressions.external_request_id\")).as(\"external_request_id\"),when(string_compare(col(\"log_impbus_impressions.stitch_group_id\"), lit(\"---\")) =!= lit(0), col(\"log_impbus_impressions.stitch_group_id\")).as(\"stitch_group_id\"),deal_type.as(\"deal_type\"),f_preempt_over_impression_non_zero_explicit(is_not_null(col(\"log_impbus_preempt\")), col(\"log_impbus_impressions.ym_floor_id\").cast(IntegerType), col(\"log_impbus_preempt.ym_floor_id\").cast(IntegerType)).as(\"ym_floor_id\"),f_preempt_over_impression_non_zero_explicit(is_not_null(col(\"log_impbus_preempt\")), col(\"log_impbus_impressions.ym_bias_id\").cast(IntegerType), col(\"log_impbus_preempt.ym_bias_id\").cast(IntegerType)).as(\"ym_bias_id\"),when(col(\"log_dw_bid.bid_priority\").cast(IntegerType) =!= lit(0), col(\"log_dw_bid.bid_priority\").cast(IntegerType)).as(\"bid_priority\"),struct(coalesce(col(\"log_impbus_auction_event.auction_event_pricing.buyer_charges.rate_card_id\").cast(IntegerType), col(\"log_impbus_impressions_pricing.impression_event_pricing.buyer_charges.rate_card_id\").cast(IntegerType), col(\"log_impbus_impressions_pricing.buyer_charges.rate_card_id\").cast(IntegerType)).as(\"rate_card_id\"),coalesce(col(\"log_impbus_auction_event.auction_event_pricing.buyer_charges.member_id\").cast(IntegerType), col(\"log_impbus_impressions_pricing.impression_event_pricing.buyer_charges.member_id\").cast(IntegerType), col(\"log_impbus_impressions_pricing.buyer_charges.member_id\").cast(IntegerType)).as(\"member_id\"),coalesce(col(\"log_impbus_auction_event.auction_event_pricing.buyer_charges.is_dw\").cast(BooleanType), col(\"log_impbus_impressions_pricing.impression_event_pricing.buyer_charges.is_dw\").cast(BooleanType), col(\"log_impbus_impressions_pricing.buyer_charges.is_dw\").cast(BooleanType)).as(\"is_dw\"),coalesce(col(\"log_impbus_auction_event.auction_event_pricing.buyer_charges.pricing_terms\"), col(\"log_impbus_impressions_pricing.impression_event_pricing.buyer_charges.pricing_terms\"), buyer_charges_pricing_terms, col(\"log_impbus_impressions_pricing.buyer_charges.pricing_terms\")).as(\"pricing_terms\"),coalesce(col(\"log_impbus_auction_event.auction_event_pricing.buyer_charges.fx_margin_rate_id\").cast(IntegerType), col(\"log_impbus_impressions_pricing.impression_event_pricing.buyer_charges.fx_margin_rate_id\").cast(IntegerType), col(\"log_impbus_impressions_pricing.buyer_charges.fx_margin_rate_id\").cast(IntegerType)).as(\"fx_margin_rate_id\"),coalesce(col(\"log_impbus_auction_event.auction_event_pricing.buyer_charges.marketplace_owner_id\").cast(IntegerType), col(\"log_impbus_impressions_pricing.impression_event_pricing.buyer_charges.marketplace_owner_id\").cast(IntegerType), col(\"log_impbus_impressions_pricing.buyer_charges.marketplace_owner_id\").cast(IntegerType)).as(\"marketplace_owner_id\"),coalesce(col(\"log_impbus_auction_event.auction_event_pricing.buyer_charges.virtual_marketplace_id\").cast(IntegerType), col(\"log_impbus_impressions_pricing.impression_event_pricing.buyer_charges.virtual_marketplace_id\").cast(IntegerType), col(\"log_impbus_impressions_pricing.buyer_charges.virtual_marketplace_id\").cast(IntegerType)).as(\"virtual_marketplace_id\"),coalesce(col(\"log_impbus_auction_event.auction_event_pricing.buyer_charges.amino_enabled\").cast(BooleanType), col(\"log_impbus_impressions_pricing.impression_event_pricing.buyer_charges.amino_enabled\").cast(BooleanType), col(\"log_impbus_impressions_pricing.buyer_charges.amino_enabled\").cast(BooleanType)).as(\"amino_enabled\")).as(\"buyer_charges\"),struct(coalesce(col(\"log_impbus_auction_event.auction_event_pricing.seller_charges.rate_card_id\").cast(IntegerType), col(\"log_impbus_impressions_pricing.impression_event_pricing.seller_charges.rate_card_id\").cast(IntegerType), col(\"log_impbus_impressions_pricing.seller_charges.rate_card_id\").cast(IntegerType)).as(\"rate_card_id\"),coalesce(col(\"log_impbus_auction_event.auction_event_pricing.seller_charges.member_id\").cast(IntegerType), col(\"log_impbus_impressions_pricing.impression_event_pricing.seller_charges.member_id\").cast(IntegerType), col(\"log_impbus_impressions_pricing.seller_charges.member_id\").cast(IntegerType)).as(\"member_id\"),coalesce(col(\"log_impbus_auction_event.auction_event_pricing.seller_charges.is_dw\").cast(BooleanType), col(\"log_impbus_impressions_pricing.impression_event_pricing.seller_charges.is_dw\").cast(BooleanType), col(\"log_impbus_impressions_pricing.seller_charges.is_dw\").cast(BooleanType)).as(\"is_dw\"),coalesce(when(should_zero_seller_revenue.cast(BooleanType), f_drop_is_deduction_pricing_terms(seller_charges_pricing_terms)), col(\"log_impbus_auction_event.auction_event_pricing.seller_charges.pricing_terms\"), col(\"log_impbus_impressions_pricing.impression_event_pricing.seller_charges.pricing_terms\"), seller_charges_pricing_terms, col(\"log_impbus_impressions_pricing.seller_charges.pricing_terms\")).as(\"pricing_terms\"),coalesce(col(\"log_impbus_auction_event.auction_event_pricing.seller_charges.fx_margin_rate_id\").cast(IntegerType), col(\"log_impbus_impressions_pricing.impression_event_pricing.seller_charges.fx_margin_rate_id\").cast(IntegerType), col(\"log_impbus_impressions_pricing.seller_charges.fx_margin_rate_id\").cast(IntegerType)).as(\"fx_margin_rate_id\"),coalesce(col(\"log_impbus_auction_event.auction_event_pricing.seller_charges.marketplace_owner_id\").cast(IntegerType), col(\"log_impbus_impressions_pricing.impression_event_pricing.seller_charges.marketplace_owner_id\").cast(IntegerType), col(\"log_impbus_impressions_pricing.seller_charges.marketplace_owner_id\").cast(IntegerType)).as(\"marketplace_owner_id\"),coalesce(col(\"log_impbus_auction_event.auction_event_pricing.seller_charges.virtual_marketplace_id\").cast(IntegerType), col(\"log_impbus_impressions_pricing.impression_event_pricing.seller_charges.virtual_marketplace_id\").cast(IntegerType), col(\"log_impbus_impressions_pricing.seller_charges.virtual_marketplace_id\").cast(IntegerType)).as(\"virtual_marketplace_id\"),coalesce(col(\"log_impbus_auction_event.auction_event_pricing.seller_charges.amino_enabled\").cast(BooleanType), col(\"log_impbus_impressions_pricing.impression_event_pricing.seller_charges.amino_enabled\").cast(BooleanType), col(\"log_impbus_impressions_pricing.seller_charges.amino_enabled\").cast(BooleanType)).as(\"amino_enabled\")).as(\"seller_charges\"),when(col(\"log_dw_bid.explore_disposition\").cast(IntegerType) =!= lit(0), col(\"log_dw_bid.explore_disposition\").cast(IntegerType)).as(\"explore_disposition\"),when(col(\"log_impbus_impressions.device_make_id\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.device_make_id\").cast(IntegerType)).as(\"device_make_id\"),when(col(\"log_impbus_impressions.operating_system_family_id\").cast(IntegerType) =!= lit(1), col(\"log_impbus_impressions.operating_system_family_id\").cast(IntegerType)).as(\"operating_system_family_id\"),col(\"log_impbus_impressions.tag_sizes\").as(\"tag_sizes\"),lit(null).as(\"campaign_group_models\"),coalesce(col(\"log_impbus_impressions_pricing.rate_card_media_type\").cast(IntegerType), lit(0)).as(\"pricing_media_type\"),buyer_trx_event_id.as(\"buyer_trx_event_id\"),seller_trx_event_id.as(\"seller_trx_event_id\"),coalesce(when((_f_is_buy_side === lit(0)) and (virtual_log_dw_bid.getField(\"revenue_auction_event_type\") =!= lit(0)), virtual_log_dw_bid.getField(\"revenue_auction_event_type\")), when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.revenue_auction_event_type\").cast(IntegerType) =!= lit(0)), col(\"log_dw_bid.revenue_auction_event_type\").cast(IntegerType))).as(\"revenue_auction_event_type\"),when(col(\"log_impbus_impressions.is_prebid\").cast(ByteType) =!= lit(0), col(\"log_impbus_impressions.is_prebid\").cast(BooleanType)).as(\"is_prebid\"),coalesce(when(imp_type === lit(6), has_seller_transacted.cast(BooleanType)), when(imp_type.isin(lit(7), lit(11)), has_buyer_transacted.cast(BooleanType)), lit(1).cast(BooleanType)).as(\"is_unit_of_trx\"),imps_for_budget_caps_pacing.as(\"imps_for_budget_caps_pacing\"),col(\"log_impbus_impressions.date_time\").cast(LongType).as(\"auction_timestamp\"),when(col(\"log_impbus_impressions_pricing.two_phase_reduction_applied\").cast(ByteType) =!= lit(0), col(\"log_impbus_impressions_pricing.two_phase_reduction_applied\").cast(BooleanType)).as(\"two_phase_reduction_applied\"),when(col(\"log_impbus_impressions.region_id\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.region_id\").cast(IntegerType)).as(\"region_id\"),when(col(\"log_impbus_impressions.media_company_id\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.media_company_id\").cast(IntegerType)).as(\"media_company_id\"),when(col(\"log_impbus_impressions_pricing.trade_agreement_id\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions_pricing.trade_agreement_id\").cast(IntegerType)).as(\"trade_agreement_id\"),struct(lit(null).cast(LongType).as(\"user_id_64\"),lit(null).cast(StringType).as(\"device_unique_id\"),lit(null).cast(StringType).as(\"external_uid\"),lit(null).cast(BinaryType).as(\"ip_address\"),struct(lit(null).cast(IntegerType).as(\"graph_id\"),lit(null).cast(LongType).as(\"group_id\")).as(\"crossdevice_group\"),lit(null).cast(DoubleType).as(\"latitude\"),lit(null).cast(DoubleType).as(\"longitude\"),lit(null).cast(BinaryType).as(\"ipv6_address\"),lit(null).cast(BooleanType).as(\"subject_to_gdpr\"),lit(null).cast(StringType).as(\"geo_country\"),lit(null).cast(StringType).as(\"gdpr_consent_string\"),lit(null).cast(BinaryType).as(\"preempt_ip_address\"),lit(null).cast(IntegerType).as(\"device_type\"),lit(null).cast(IntegerType).as(\"device_make_id\"),lit(null).cast(IntegerType).as(\"device_model_id\"),lit(null).cast(LongType).as(\"new_user_id_64\"),lit(null).cast(BooleanType).as(\"is_service_provider_mode\"),lit(null).cast(BooleanType).as(\"is_personal_info_sale\")).as(\"personal_data\"),struct(lit(null).cast(BinaryType).as(\"user_id\")).as(\"anonymized_user_info\"),when(string_compare(col(\"log_impbus_impressions.gdpr_consent_cookie\"), lit(\"\")) =!= lit(0), col(\"log_impbus_impressions.gdpr_consent_cookie\")).as(\"gdpr_consent_cookie\"),col(\"additional_clearing_events\").as(\"additional_clearing_events\"),col(\"log_impbus_impressions.fx_rate_snapshot_id\").cast(IntegerType).as(\"fx_rate_snapshot_id\"),struct(lit(null).cast(IntegerType).as(\"graph_id\"),lit(null).cast(BinaryType).as(\"group_id\")).as(\"crossdevice_group_anon\"),struct(lit(null).cast(IntegerType).as(\"graph_provider_member_id\"),lit(null).cast(DoubleType).as(\"cost_cpm_usd\")).as(\"crossdevice_graph_cost\"),when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.revenue_event_type_id\").cast(IntegerType) =!= lit(0)), col(\"log_dw_bid.revenue_event_type_id\").cast(IntegerType)).as(\"revenue_event_type_id\"),buyer_trx_event_type_id.as(\"buyer_trx_event_type_id\"),seller_trx_event_type_id.as(\"seller_trx_event_type_id\"),coalesce(col(\"log_impbus_preempt.external_creative_id\"), when(is_not_null(col(\"log_impbus_preempt\")), lit(\"---\"))).as(\"external_creative_id\"),coalesce(when(is_not_null(col(\"log_dw_bid_deal\")) and (imp_type === lit(6)), col(\"log_dw_bid_deal.targeted_segment_details\")), when(_f_is_buy_side === lit(1), col(\"log_dw_bid.targeted_segment_details\"))).as(\"targeted_segment_details\"),coalesce(col(\"log_impbus_preempt.seat_id\").cast(IntegerType), when(is_not_null(col(\"log_impbus_preempt\")), lit(0)), lit(0)).as(\"bidder_seat_id\"),when(col(\"log_impbus_impressions.is_whiteops_scanned\").cast(ByteType) =!= lit(0), col(\"log_impbus_impressions.is_whiteops_scanned\").cast(BooleanType)).as(\"is_whiteops_scanned\"),lit(null).as(\"default_referrer_url\"),when(is_curated === lit(1), lit(1).cast(BooleanType)).as(\"is_curated\"),curator_member_id.as(\"curator_member_id\"),coalesce(when(((_f_is_buy_side === lit(1)) and is_not_null(col(\"log_dw_view.revenue_info.total_partner_fees_microcents\").cast(LongType))) and is_not_null(col(\"log_dw_bid.revenue_info.total_partner_fees_microcents\").cast(LongType)), col(\"log_dw_view.revenue_info.total_partner_fees_microcents\").cast(LongType) + col(\"log_dw_bid.revenue_info.total_partner_fees_microcents\").cast(LongType)), when((_f_is_buy_side === lit(1)) and is_not_null(col(\"log_dw_bid.revenue_info.total_partner_fees_microcents\").cast(LongType)), col(\"log_dw_bid.revenue_info.total_partner_fees_microcents\").cast(LongType)), when(_f_is_buy_side === lit(1), lit(0))).as(\"total_partner_fees_microcents\"),lit(null).as(\"net_buyer_spend\"),when(col(\"log_impbus_preempt.is_prebid_server\").cast(ByteType) =!= lit(0), col(\"log_impbus_preempt.is_prebid_server\").cast(BooleanType)).as(\"is_prebid_server\"),when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.cold_start_price_type\").cast(IntegerType) =!= lit(-1)), col(\"log_dw_bid.cold_start_price_type\").cast(IntegerType)).as(\"cold_start_price_type\"),when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.discovery_state\").cast(IntegerType) =!= lit(-1)), col(\"log_dw_bid.discovery_state\").cast(IntegerType)).as(\"discovery_state\"),coalesce(when(_f_is_buy_side === lit(1), col(\"log_dw_bid.insertion_order_budget_interval_id\").cast(IntegerType)), billing_period_id, lit(0)).as(\"billing_period_id\"),coalesce(when(_f_is_buy_side === lit(1), col(\"log_dw_bid.campaign_group_budget_interval_id\").cast(IntegerType)), flight_id, lit(0)).as(\"flight_id\"),split_id.as(\"split_id\"),when((imp_type === lit(7)) and (v_transaction_event_pricing.getField(\"buyer_transacted\") === lit(1)), v_transaction_event_pricing.getField(\"net_payment_value_microcents\").cast(DoubleType) / lit(100000.0)).as(\"net_media_cost_dollars_cpm\"),coalesce(when(((_f_is_buy_side === lit(1)) and is_not_null(col(\"log_dw_view.revenue_info.total_data_costs_microcents\").cast(LongType))) and is_not_null(col(\"log_dw_bid.revenue_info.total_data_costs_microcents\").cast(LongType)), col(\"log_dw_view.revenue_info.total_data_costs_microcents\").cast(LongType) + col(\"log_dw_bid.revenue_info.total_data_costs_microcents\").cast(LongType)), when((_f_is_buy_side === lit(1)) and is_not_null(col(\"log_dw_bid.revenue_info.total_data_costs_microcents\").cast(LongType)), col(\"log_dw_bid.revenue_info.total_data_costs_microcents\").cast(LongType)), when(_f_is_buy_side === lit(1), lit(0))).as(\"total_data_costs_microcents\"),coalesce(when(((_f_is_buy_side === lit(1)) and is_not_null(col(\"log_dw_view.revenue_info.total_profit_microcents\").cast(LongType))) and is_not_null(col(\"log_dw_bid.revenue_info.total_profit_microcents\").cast(LongType)), col(\"log_dw_view.revenue_info.total_profit_microcents\").cast(LongType) + col(\"log_dw_bid.revenue_info.total_profit_microcents\").cast(LongType)), when((_f_is_buy_side === lit(1)) and is_not_null(col(\"log_dw_bid.revenue_info.total_profit_microcents\").cast(LongType)), col(\"log_dw_bid.revenue_info.total_profit_microcents\").cast(LongType)), when(_f_is_buy_side === lit(1), lit(0))).as(\"total_profit_microcents\"),when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.targeted_crossdevice_graph_id\").cast(IntegerType) =!= lit(0)), col(\"log_dw_bid.targeted_crossdevice_graph_id\").cast(IntegerType)).as(\"targeted_crossdevice_graph_id\"),when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.discovery_prediction\") =!= lit(0.0)), col(\"log_dw_bid.discovery_prediction\")).as(\"discovery_prediction\"),campaign_group_type_id.as(\"campaign_group_type_id\"),when(col(\"log_impbus_impressions.hb_source\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.hb_source\").cast(IntegerType)).as(\"hb_source\"),f_preempt_over_impression_94298.as(\"external_campaign_id\"),when(_f_is_buy_side === lit(1), col(\"log_dw_bid.excluded_targeted_segment_details\")).as(\"excluded_targeted_segment_details\"),lit(null).cast(StringType).as(\"trust_id\"),when((_f_is_buy_side === lit(1)) and (col(\"log_dw_bid.predicted_kpi_event_rate\") =!= lit(0.0)), col(\"log_dw_bid.predicted_kpi_event_rate\")).as(\"predicted_kpi_event_rate\"),coalesce(when(_f_is_buy_side === lit(1), col(\"log_dw_bid.has_crossdevice_reach_extension\").cast(BooleanType)), when(imp_type === lit(6), col(\"log_dw_bid_deal.has_crossdevice_reach_extension\").cast(BooleanType))).as(\"has_crossdevice_reach_extension\"),coalesce(when(_f_is_buy_side === lit(1), col(\"log_dw_bid.crossdevice_graph_membership\")), when(imp_type === lit(6), col(\"log_dw_bid_deal.crossdevice_graph_membership\"))).as(\"crossdevice_graph_membership\"),when(_f_is_buy_side === lit(1), coalesce(col(\"log_dw_bid.revenue_info.total_segment_data_costs_microcents\").cast(LongType), lit(0)) + coalesce(col(\"log_dw_view.revenue_info.total_segment_data_costs_microcents\").cast(LongType), lit(0))).otherwise(lit(0)).as(\"total_segment_data_costs_microcents\"),when(_f_is_buy_side === lit(1), coalesce(col(\"log_dw_bid.revenue_info.total_feature_costs_microcents\").cast(LongType), lit(0)) + coalesce(col(\"log_dw_view.revenue_info.total_feature_costs_microcents\").cast(LongType), lit(0))).otherwise(lit(0)).as(\"total_feature_costs_microcents\"),when(col(\"log_impbus_impressions_pricing.counterparty_ruleset_type\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions_pricing.counterparty_ruleset_type\").cast(IntegerType)).as(\"counterparty_ruleset_type\"),struct(lit(null).cast(IntegerType).as(\"product_feed_id\"),lit(null).cast(IntegerType).as(\"item_selection_strategy_id\"),lit(null).cast(StringType).as(\"product_uuid\")).as(\"log_product_ads\"),coalesce(when(imp_type.isin(lit(7), lit(5)), coalesce(col(\"log_dw_bid.line_item_currency\"), lit(\"---\"))), lit(\"---\")).as(\"buyer_line_item_currency\"),coalesce(when(imp_type === lit(6), coalesce(col(\"log_dw_bid_deal.line_item_currency\"), lit(\"---\"))), lit(\"---\")).as(\"deal_line_item_currency\"),coalesce(when(_f_is_buy_side === lit(1), col(\"log_dw_bid.measurement_fee_cpm_usd\")), lit(0)).as(\"measurement_fee_usd\"),coalesce(when(_f_is_buy_side === lit(1), col(\"log_dw_bid.measurement_provider_member_id\").cast(IntegerType)), lit(0)).as(\"measurement_provider_member_id\"),when(_f_is_buy_side === lit(1), col(\"log_dw_bid.offline_attribution_provider_member_id\").cast(IntegerType)).as(\"offline_attribution_provider_member_id\"),when(_f_is_buy_side === lit(1), col(\"log_dw_bid.offline_attribution_cost_usd_cpm\")).as(\"offline_attribution_cost_usd_cpm\"),when(col(\"log_impbus_impressions.pred_info\").cast(IntegerType) =!= lit(0), col(\"log_impbus_impressions.pred_info\").cast(IntegerType)).as(\"pred_info\"),col(\"log_impbus_impressions.imp_rejecter_do_auction\").cast(BooleanType).as(\"imp_rejecter_do_auction\"),col(\"log_impbus_impressions.personal_identifiers\").as(\"personal_identifiers\"),col(\"log_impbus_impressions.is_imp_rejecter_applied\").cast(BooleanType).as(\"imp_rejecter_applied\"),lit(null).cast(DoubleType).as(\"ip_derived_latitude\"),lit(null).cast(DoubleType).as(\"ip_derived_longitude\"),col(\"log_impbus_impressions.personal_identifiers_experimental\").as(\"personal_identifiers_experimental\"),col(\"log_impbus_impressions.postal_code_ext_id\").cast(IntegerType).as(\"postal_code_ext_id\"),coalesce(when(buyer_trx_event_id === lit(2), col(\"log_dw_view.ecpm_conversion_rate\")), lit(1.0)).as(\"ecpm_conversion_rate\"),when(sup_ip_range_lookup_count > lit(0), lit(1).cast(BooleanType)).otherwise(lit(0).cast(BooleanType)).as(\"is_residential_ip\"),col(\"log_impbus_impressions.hashed_ip\").as(\"hashed_ip\"),coalesce(when(is_not_null(col(\"log_dw_bid_deal\")) and (imp_type === lit(6)), col(\"log_dw_bid_deal.targeted_segment_details_by_id_type\")), when(_f_is_buy_side === lit(1), col(\"log_dw_bid.targeted_segment_details_by_id_type\"))).as(\"targeted_segment_details_by_id_type\"),when(_f_is_buy_side === lit(1), col(\"log_dw_bid.offline_attribution\")).as(\"offline_attribution\"),col(\"log_dw_bid.frequency_cap_type_internal\").cast(IntegerType).as(\"frequency_cap_type_internal\"),col(\"log_dw_bid.modeled_cap_did_override_line_item_daily_cap\").cast(BooleanType).as(\"modeled_cap_did_override_line_item_daily_cap\"),col(\"log_dw_bid.modeled_cap_user_sample_rate\").as(\"modeled_cap_user_sample_rate\"),when(coalesce(col(\"log_impbus_impressions.device_type\").cast(IntegerType), lit(99)) === lit(8), coalesce(col(\"log_impbus_impressions_pricing_dup.estimated_audience_imps\"), lit(1.0))).otherwise(lit(1.0)).as(\"estimated_audience_imps\"),when(coalesce(col(\"log_impbus_impressions.device_type\").cast(IntegerType), lit(99)) === lit(8), coalesce(col(\"log_impbus_impressions_pricing_dup.audience_imps\"), lit(1.0))).otherwise(lit(1.0)).as(\"audience_imps\"),col(\"log_dw_bid.district_postal_code_lists\").as(\"district_postal_code_lists\"),coalesce(when(imp_type.isin(lit(4), lit(7), lit(5)), coalesce(col(\"log_dw_bid.bidding_host_id\").cast(IntegerType), lit(0))), when((imp_type === lit(6)) and is_not_null(col(\"log_dw_bid_deal\")), coalesce(col(\"log_dw_bid_deal.bidding_host_id\").cast(IntegerType), lit(0)))).as(\"bidding_host_id\"),lit(null).cast(LongType).as(\"buyer_dpvp_bitmap\"),lit(null).cast(LongType).as(\"seller_dpvp_bitmap\"),col(\"log_impbus_impressions.browser_code_id\").cast(IntegerType).as(\"browser_code_id\"),col(\"log_impbus_impressions.is_prebid_server_included\").cast(IntegerType).as(\"is_prebid_server_included\"),coalesce(col(\"log_dw_bid.feature_tests_bitmap\").cast(IntegerType), lit(0)).as(\"feature_tests_bitmap\"),coalesce(col(\"log_impbus_impressions.private_auction_eligible\").cast(BooleanType), lit(0).cast(BooleanType)).as(\"private_auction_eligible\"),coalesce(col(\"log_impbus_impressions.chrome_traffic_label\").cast(IntegerType), lit(0)).as(\"chrome_traffic_label\"),coalesce(col(\"log_impbus_impressions.is_private_auction\").cast(BooleanType), lit(0).cast(BooleanType)).as(\"is_private_auction\"),f_preempt_over_impression_95337.as(\"creative_media_subtype_id\"),col(\"log_impbus_impressions.allowed_media_types\").as(\"allowed_media_types\"))","language":"scala","description":""}