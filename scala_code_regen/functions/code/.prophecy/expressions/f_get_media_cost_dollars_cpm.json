{"parameters":[{"name":"imp_type","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"payment_type","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"revenue_type","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"media_buy_cost","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"media_buy_rev_share_pct","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"seller_revenue_cpm","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"buyer_spend_cpm","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"booked_revenue_dollars","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"commission_cpm","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"commission_revshare","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"serving_fees_cpm","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"serving_fees_revshare","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"apply_cost_on_default","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"revenue_value","type":"column","metadata":{"description":"","tags":[],"mappings":[]}}],"isCustomSchemaEnabled":true,"code":"var l_payment_type: org.apache.spark.sql.Column = lit(0)\nvar l_revenue_type: org.apache.spark.sql.Column = lit(0)\nvar l_media_buy_cost: org.apache.spark.sql.Column = lit(0)\nvar l_media_buy_rev_share_pct: org.apache.spark.sql.Column = lit(0)\nvar l_seller_revenue_cpm: org.apache.spark.sql.Column = lit(0)\nvar l_buyer_spend_cpm: org.apache.spark.sql.Column = lit(0)\nvar l_booked_revenue_dollars: org.apache.spark.sql.Column = lit(0)\nvar l_commission_cpm: org.apache.spark.sql.Column = lit(0)\nvar l_commission_revshare: org.apache.spark.sql.Column = lit(0)\nvar l_serving_fees_cpm: org.apache.spark.sql.Column = lit(0)\nvar l_serving_fees_revshare: org.apache.spark.sql.Column = lit(0)\nvar l_apply_cost_on_default: org.apache.spark.sql.Column = lit(0)\nvar l_revenue_dollars_cpm: org.apache.spark.sql.Column = lit(0)\nvar l_network_revenue_dollars_cpm: org.apache.spark.sql.Column = lit(0)\nvar l_media_cost_dollars_cpm: org.apache.spark.sql.Column = lit(0)\nvar l_revenue_value: org.apache.spark.sql.Column = lit(0)\nl_payment_type = coalesce(payment_type, lit(0)).cast(IntegerType)\nl_revenue_type = coalesce(revenue_type, lit(0)).cast(IntegerType)\nl_media_buy_cost = coalesce(media_buy_cost, lit(0)).cast(DoubleType)\nl_media_buy_rev_share_pct = coalesce(media_buy_rev_share_pct, lit(0)).cast(DoubleType)\nl_seller_revenue_cpm = coalesce(seller_revenue_cpm, lit(0)).cast(DoubleType)\nl_buyer_spend_cpm = coalesce(buyer_spend_cpm, lit(0)).cast(DoubleType)\nl_booked_revenue_dollars = coalesce(booked_revenue_dollars, lit(0)).cast(DoubleType)\nl_commission_cpm = coalesce(commission_cpm, lit(0)).cast(DoubleType)\nl_commission_revshare = coalesce(commission_revshare, lit(0)).cast(DoubleType)\nl_serving_fees_cpm = coalesce(serving_fees_cpm, lit(0)).cast(DoubleType)\nl_serving_fees_revshare = coalesce(serving_fees_revshare, lit(0)).cast(DoubleType)\nl_revenue_value = coalesce(revenue_value, lit(0)).cast(DoubleType)\nl_media_cost_dollars_cpm = when(coalesce(imp_type, lit(0)) === lit(2), when(l_media_buy_rev_share_pct === lit(0), l_media_buy_cost).otherwise(l_media_cost_dollars_cpm)).when(coalesce(imp_type, lit(0)) === lit(4), when((l_apply_cost_on_default === lit(1)) and (l_media_buy_rev_share_pct <= lit(0)), l_media_buy_cost).otherwise(l_media_cost_dollars_cpm)).when(coalesce(imp_type, lit(0)) === lit(5), when(l_media_buy_rev_share_pct > lit(0), when(l_revenue_type.isin(lit(1), lit(2)), l_media_buy_cost * l_media_buy_rev_share_pct).otherwise({\nl_media_cost_dollars_cpm = (((l_media_buy_rev_share_pct * (((l_booked_revenue_dollars * lit(1000)) - l_commission_cpm) - (l_commission_revshare * (l_booked_revenue_dollars * lit(1000))))) - l_serving_fees_cpm) / (lit(1) + l_serving_fees_revshare)).cast(DoubleType)\nl_media_cost_dollars_cpm = when((((l_media_buy_rev_share_pct * (((l_booked_revenue_dollars * lit(1000)) - l_commission_cpm) - (l_commission_revshare * (l_booked_revenue_dollars * lit(1000))))) - l_serving_fees_cpm) / (lit(1) + l_serving_fees_revshare)) < lit(0), lit(0)).otherwise(l_media_cost_dollars_cpm).cast(DoubleType)\nl_media_cost_dollars_cpm\n})).otherwise(l_media_buy_cost)).when(coalesce(imp_type, lit(0)) === lit(6), when((l_payment_type === lit(4)) and l_revenue_type.isin(lit(3), lit(4)), lit(0)).when(l_media_buy_rev_share_pct > lit(0), l_seller_revenue_cpm * l_media_buy_rev_share_pct).otherwise(l_media_buy_cost)).when(coalesce(imp_type, lit(0)) === lit(7), when(!l_payment_type.isin(lit(2), lit(-1), lit(1)), l_buyer_spend_cpm).otherwise(l_media_cost_dollars_cpm)).when(coalesce(imp_type, lit(0)) === lit(9), when(l_media_buy_rev_share_pct > lit(0), {\nl_media_cost_dollars_cpm = (l_media_buy_rev_share_pct * ((l_booked_revenue_dollars - (l_commission_cpm / lit(1000))) - (l_commission_revshare * l_booked_revenue_dollars))).cast(DoubleType)\nl_media_cost_dollars_cpm = when((l_media_buy_rev_share_pct * ((l_booked_revenue_dollars - (l_commission_cpm / lit(1000))) - (l_commission_revshare * l_booked_revenue_dollars))) < lit(0), lit(0)).otherwise(l_media_cost_dollars_cpm).cast(DoubleType)\nl_media_cost_dollars_cpm\n}).otherwise(l_media_buy_cost)).when(coalesce(imp_type, lit(0)) === lit(10), when(l_media_buy_rev_share_pct > lit(0), lit(1000) * (l_media_buy_rev_share_pct * (l_revenue_value - (l_commission_revshare * l_revenue_value)))).otherwise(lit(1000) * l_media_buy_cost)).otherwise(lit(0)).cast(DoubleType)\nl_media_cost_dollars_cpm","language":"scala","description":""}