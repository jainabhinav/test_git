{"initCode":"","code":"udf(\n    (\n      _l_term_id:       Integer,\n      _l_pricing_terms: Seq[Row],\n      _i:               Integer,\n      _l_is_deduction:  Integer\n    ) => {\n      var i                                        = _i\n      var l_is_deduction                           = _l_is_deduction\n      var l_pricing_terms                          = _l_pricing_terms.toArray\n      var l_term_id                                = _l_term_id\n      var l_is_curator_margin_media_cost_dependent = 0\n\n      while (compareTo(i, l_pricing_terms.length) < 0) {\n        l_term_id = 0\n        l_is_deduction = 0\n        if (\n          !_isnull(l_pricing_terms(convertToInt(i)).getAs[Integer](\"term_id\"))\n        )\n          l_term_id = convertToInt(\n            l_pricing_terms(convertToInt(i)).getAs[Integer](\"term_id\")\n          )\n        if (\n          !_isnull(\n            l_pricing_terms(convertToInt(i)).getAs[Boolean](\"is_deduction\")\n          )\n        )\n          l_is_deduction = convertToInt(\n            l_pricing_terms(convertToInt(i)).getAs[Boolean](\"is_deduction\")\n          )\n        if ((l_term_id == 95) && (l_is_deduction == 1)) {\n          if (\n            !_isnull(\n              l_pricing_terms(convertToInt(i))\n                .getAs[Boolean](\"is_media_cost_dependent\")\n            )\n          )\n            l_is_curator_margin_media_cost_dependent = convertToInt(\n              l_pricing_terms(convertToInt(i))\n                .getAs[Boolean](\"is_media_cost_dependent\")\n            )\n        }\n        i = i + convertToInt(1)\n      }\n\n      Row(convertToInt(l_is_curator_margin_media_cost_dependent),\n          convertToInt(l_is_deduction),\n          convertToInt(i),\n          convertToInt(l_term_id)\n      )\n    },\n    StructType(\n      List(\n        StructField(\"l_is_curator_margin_media_cost_dependent\",\n                    IntegerType,\n                    false\n        ),\n        StructField(\"l_is_deduction\", IntegerType, false),\n        StructField(\"i\",              IntegerType, false),\n        StructField(\"l_term_id\",      IntegerType, false)\n      )\n    )\n  )"}