{"parameters":[{"name":"l_ve","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"l_vi","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"l_clicks","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"l_pixels","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"global_variable_substituted_XR_BUSINESS_DATE","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"global_variable_substituted_XR_BUSINESS_HOUR","type":"column","metadata":{"description":"","tags":[],"mappings":[]}}],"output":{"type":"struct","fields":[{"name":"booked_revenue_dollars","type":"double","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"media_cost_dollar_cpm","type":"double","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"serving_fees","type":"double","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"commissions","type":"double","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"reseller_revenue","type":"double","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}}]},"isCustomSchemaEnabled":true,"code":"var l_fin_booked_revenue_dollars: org.apache.spark.sql.Column =\n    lit(null).cast(DoubleType)\n\n  var l_fin_media_cost_dollar_cpm: org.apache.spark.sql.Column =\n    lit(null).cast(DoubleType)\n\n  var l_fin_serving_fees: org.apache.spark.sql.Column =\n    lit(null).cast(DoubleType)\n\n  var l_fin_commissions: org.apache.spark.sql.Column =\n    lit(null).cast(DoubleType)\n\n  var l_fin_reseller_revenue: org.apache.spark.sql.Column =\n    lit(null).cast(DoubleType)\n\n  var l_fin: org.apache.spark.sql.Column = struct(\n    lit(null).as(\"booked_revenue_dollars\"),\n    lit(null).as(\"media_cost_dollar_cpm\"),\n    lit(null).as(\"serving_fees\"),\n    lit(null).as(\"commissions\"),\n    lit(null).as(\"reseller_revenue\")\n  )\n\n  var l_booked_revenue_dollars: org.apache.spark.sql.Column = lit(0.0)\n  var l_media_cost_dollar_cpm:  org.apache.spark.sql.Column = lit(0.0)\n  var l_serving_fees:           org.apache.spark.sql.Column = lit(0.0)\n  var l_commissions:            org.apache.spark.sql.Column = lit(0.0)\n  var l_reseller_revenue:       org.apache.spark.sql.Column = lit(0.0)\n  l_booked_revenue_dollars = when(((isnull(l_ve)\n                                    .and(isnull(l_vi)))\n                                    .and(isnull(l_clicks)))\n                                    .and(isnull(l_pixels)),\n                                  lit(null).cast(DoubleType)\n  ).otherwise(l_booked_revenue_dollars).cast(DoubleType)\n  l_media_cost_dollar_cpm = when(((isnull(l_ve)\n                                   .and(isnull(l_vi)))\n                                   .and(isnull(l_clicks)))\n                                   .and(isnull(l_pixels)),\n                                 lit(null).cast(DoubleType)\n  ).otherwise(l_media_cost_dollar_cpm).cast(DoubleType)\n  l_serving_fees = when(((isnull(l_ve)\n                          .and(isnull(l_vi)))\n                          .and(isnull(l_clicks)))\n                          .and(isnull(l_pixels)),\n                        lit(null).cast(DoubleType)\n  ).otherwise(l_serving_fees).cast(DoubleType)\n  l_commissions = when(((isnull(l_ve)\n                         .and(isnull(l_vi)))\n                         .and(isnull(l_clicks)))\n                         .and(isnull(l_pixels)),\n                       lit(null).cast(DoubleType)\n  ).otherwise(l_commissions).cast(DoubleType)\n  l_reseller_revenue = when(((isnull(l_ve)\n                              .and(isnull(l_vi)))\n                              .and(isnull(l_clicks)))\n                              .and(isnull(l_pixels)),\n                            lit(null).cast(DoubleType)\n  ).otherwise(l_reseller_revenue).cast(DoubleType)\n  l_booked_revenue_dollars = when(\n    is_not_null(l_ve.getField(\"date_time\")).and(\n      f_is_curr_hour(l_ve.getField(\"date_time\"),\n                     global_variable_substituted_XR_BUSINESS_DATE,\n                     global_variable_substituted_XR_BUSINESS_HOUR\n      ).cast(BooleanType)\n    ),\n    coalesce(l_ve.getField(\"booked_revenue_dollars\"), lit(0.0))\n  ).otherwise(l_booked_revenue_dollars).cast(DoubleType)\n  l_media_cost_dollar_cpm = when(\n    is_not_null(l_ve.getField(\"date_time\")).and(\n      f_is_curr_hour(l_ve.getField(\"date_time\"),\n                     global_variable_substituted_XR_BUSINESS_DATE,\n                     global_variable_substituted_XR_BUSINESS_HOUR\n      ).cast(BooleanType)\n    ),\n    coalesce(l_ve.getField(\"media_cost_dollars_cpm\") / lit(1000), lit(0.0))\n  ).otherwise(l_media_cost_dollar_cpm).cast(DoubleType)\n  l_serving_fees = when(\n    is_not_null(l_ve.getField(\"date_time\")).and(\n      f_is_curr_hour(l_ve.getField(\"date_time\"),\n                     global_variable_substituted_XR_BUSINESS_DATE,\n                     global_variable_substituted_XR_BUSINESS_HOUR\n      ).cast(BooleanType)\n    ),\n    lit(null).cast(DoubleType)\n  ).otherwise(l_serving_fees).cast(DoubleType)\n  l_commissions = when(\n    is_not_null(l_ve.getField(\"date_time\")).and(\n      f_is_curr_hour(l_ve.getField(\"date_time\"),\n                     global_variable_substituted_XR_BUSINESS_DATE,\n                     global_variable_substituted_XR_BUSINESS_HOUR\n      ).cast(BooleanType)\n    ),\n    lit(null).cast(DoubleType)\n  ).otherwise(l_commissions).cast(DoubleType)\n  l_reseller_revenue = when(\n    is_not_null(l_ve.getField(\"date_time\")).and(\n      f_is_curr_hour(l_ve.getField(\"date_time\"),\n                     global_variable_substituted_XR_BUSINESS_DATE,\n                     global_variable_substituted_XR_BUSINESS_HOUR\n      ).cast(BooleanType)\n    ),\n    lit(null).cast(DoubleType)\n  ).otherwise(l_reseller_revenue).cast(DoubleType)\n  l_booked_revenue_dollars = when(\n    is_not_null(l_vi.getField(\"date_time\")).and(\n      f_is_curr_hour(l_vi.getField(\"date_time\"),\n                     global_variable_substituted_XR_BUSINESS_DATE,\n                     global_variable_substituted_XR_BUSINESS_HOUR\n      ).cast(BooleanType)\n    ),\n    l_booked_revenue_dollars + coalesce(l_vi.getField(\"booked_revenue_dollars\"),\n                                        lit(0.0)\n    )\n  ).otherwise(l_booked_revenue_dollars).cast(DoubleType)\n  l_media_cost_dollar_cpm = when(\n    is_not_null(l_vi.getField(\"date_time\")).and(\n      f_is_curr_hour(l_vi.getField(\"date_time\"),\n                     global_variable_substituted_XR_BUSINESS_DATE,\n                     global_variable_substituted_XR_BUSINESS_HOUR\n      ).cast(BooleanType)\n    ),\n    l_media_cost_dollar_cpm + coalesce(\n      l_vi.getField(\"buyer_media_cost_cpm\") / lit(1000),\n      lit(0.0)\n    )\n  ).otherwise(l_media_cost_dollar_cpm).cast(DoubleType)\n  l_serving_fees = when(\n    is_not_null(l_vi.getField(\"date_time\")).and(\n      f_is_curr_hour(l_vi.getField(\"date_time\"),\n                     global_variable_substituted_XR_BUSINESS_DATE,\n                     global_variable_substituted_XR_BUSINESS_HOUR\n      ).cast(BooleanType)\n    ),\n    (coalesce(l_vi.getField(\"serving_fees_cpm\"), lit(0.0)) + coalesce(\n      l_vi.getField(\"serving_fees_revshare\") * l_vi.getField(\n        \"buyer_media_cost_cpm\"\n      ),\n      lit(0.0)\n    )) / lit(1000)\n  ).otherwise(l_serving_fees).cast(DoubleType)\n  l_commissions = when(\n    is_not_null(l_vi.getField(\"date_time\")).and(\n      f_is_curr_hour(l_vi.getField(\"date_time\"),\n                     global_variable_substituted_XR_BUSINESS_DATE,\n                     global_variable_substituted_XR_BUSINESS_HOUR\n      ).cast(BooleanType)\n    ),\n    coalesce(l_vi.getField(\"commission_cpm\") / lit(1000), lit(0.0)) + coalesce(\n      l_vi.getField(\"commission_revshare\") * l_vi.getField(\n        \"booked_revenue_dollars\"\n      ),\n      lit(0.0)\n    )\n  ).otherwise(l_commissions).cast(DoubleType)\n  l_reseller_revenue = when(\n    is_not_null(l_vi.getField(\"date_time\")).and(\n      f_is_curr_hour(l_vi.getField(\"date_time\"),\n                     global_variable_substituted_XR_BUSINESS_DATE,\n                     global_variable_substituted_XR_BUSINESS_HOUR\n      ).cast(BooleanType)\n    ),\n    coalesce(l_vi.getField(\"seller_revenue\"), lit(0.0))\n  ).otherwise(l_reseller_revenue).cast(DoubleType)\n  l_booked_revenue_dollars = when(\n    is_not_null(l_clicks.getField(\"date_time\")).and(\n      f_is_curr_hour(l_clicks.getField(\"date_time\"),\n                     global_variable_substituted_XR_BUSINESS_DATE,\n                     global_variable_substituted_XR_BUSINESS_HOUR\n      ).cast(BooleanType)\n    ),\n    l_booked_revenue_dollars + coalesce(\n      l_clicks.getField(\"booked_revenue_dollars\"),\n      lit(0.0)\n    )\n  ).otherwise(l_booked_revenue_dollars).cast(DoubleType)\n  l_media_cost_dollar_cpm = when(\n    is_not_null(l_clicks.getField(\"date_time\")).and(\n      f_is_curr_hour(l_clicks.getField(\"date_time\"),\n                     global_variable_substituted_XR_BUSINESS_DATE,\n                     global_variable_substituted_XR_BUSINESS_HOUR\n      ).cast(BooleanType)\n    ),\n    l_media_cost_dollar_cpm + coalesce(\n      l_clicks.getField(\"media_cost_dollars_cpm\") / lit(1000),\n      lit(0.0)\n    )\n  ).otherwise(l_media_cost_dollar_cpm).cast(DoubleType)\n  l_serving_fees = when(\n    is_not_null(l_clicks.getField(\"date_time\")).and(\n      f_is_curr_hour(l_clicks.getField(\"date_time\"),\n                     global_variable_substituted_XR_BUSINESS_DATE,\n                     global_variable_substituted_XR_BUSINESS_HOUR\n      ).cast(BooleanType)\n    ),\n    coalesce(l_serving_fees, lit(0.0)) + coalesce(\n      l_clicks.getField(\"serving_fees_revshare\") * (l_clicks.getField(\n        \"media_cost_dollars_cpm\"\n      ) / lit(1000)),\n      lit(0.0)\n    )\n  ).otherwise(l_serving_fees).cast(DoubleType)\n  l_commissions = when(\n    is_not_null(l_clicks.getField(\"date_time\")).and(\n      f_is_curr_hour(l_clicks.getField(\"date_time\"),\n                     global_variable_substituted_XR_BUSINESS_DATE,\n                     global_variable_substituted_XR_BUSINESS_HOUR\n      ).cast(BooleanType)\n    ),\n    coalesce(l_commissions, lit(0.0)) + coalesce(\n      l_clicks.getField(\"commission_revshare\") * l_booked_revenue_dollars,\n      lit(0.0)\n    )\n  ).otherwise(l_commissions).cast(DoubleType)\n  l_booked_revenue_dollars = when(\n    is_not_null(l_pixels.getField(\"date_time\")).and(\n      f_is_curr_hour(l_pixels.getField(\"date_time\"),\n                     global_variable_substituted_XR_BUSINESS_DATE,\n                     global_variable_substituted_XR_BUSINESS_HOUR\n      ).cast(BooleanType)\n    ),\n    l_booked_revenue_dollars + coalesce(\n      l_pixels.getField(\"booked_revenue_dollars\"),\n      lit(0.0)\n    )\n  ).otherwise(l_booked_revenue_dollars).cast(DoubleType)\n  l_media_cost_dollar_cpm = when(\n    is_not_null(l_pixels.getField(\"date_time\")).and(\n      f_is_curr_hour(l_pixels.getField(\"date_time\"),\n                     global_variable_substituted_XR_BUSINESS_DATE,\n                     global_variable_substituted_XR_BUSINESS_HOUR\n      ).cast(BooleanType)\n    ),\n    l_media_cost_dollar_cpm + coalesce(\n      l_pixels.getField(\"media_cost_dollars_cpm\") / lit(1000),\n      lit(0.0)\n    )\n  ).otherwise(l_media_cost_dollar_cpm).cast(DoubleType)\n  l_serving_fees = when(\n    is_not_null(l_pixels.getField(\"date_time\")).and(\n      f_is_curr_hour(l_pixels.getField(\"date_time\"),\n                     global_variable_substituted_XR_BUSINESS_DATE,\n                     global_variable_substituted_XR_BUSINESS_HOUR\n      ).cast(BooleanType)\n    ),\n    coalesce(l_serving_fees, lit(0.0)) + coalesce(\n      l_pixels.getField(\"serving_fees_revshare\") * (l_pixels.getField(\n        \"media_cost_dollars_cpm\"\n      ) / lit(1000)),\n      lit(0.0)\n    )\n  ).otherwise(l_serving_fees).cast(DoubleType)\n  l_commissions = when(\n    is_not_null(l_pixels.getField(\"date_time\")).and(\n      f_is_curr_hour(l_pixels.getField(\"date_time\"),\n                     global_variable_substituted_XR_BUSINESS_DATE,\n                     global_variable_substituted_XR_BUSINESS_HOUR\n      ).cast(BooleanType)\n    ),\n    coalesce(l_commissions, lit(0.0)) + coalesce(\n      l_pixels.getField(\"commission_revshare\") * l_booked_revenue_dollars,\n      lit(0.0)\n    )\n  ).otherwise(l_commissions).cast(DoubleType)\n  l_fin_booked_revenue_dollars = l_booked_revenue_dollars.cast(DoubleType)\n  l_fin_media_cost_dollar_cpm = l_media_cost_dollar_cpm.cast(DoubleType)\n  l_fin_serving_fees = l_serving_fees.cast(DoubleType)\n  l_fin_commissions = l_commissions.cast(DoubleType)\n  l_fin_reseller_revenue = l_reseller_revenue.cast(DoubleType)\n  l_fin = struct(\n    l_fin_booked_revenue_dollars.as(\"booked_revenue_dollars\"),\n    l_fin_media_cost_dollar_cpm.as(\"media_cost_dollar_cpm\"),\n    l_fin_serving_fees.as(\"serving_fees\"),\n    l_fin_commissions.as(\"commissions\"),\n    l_fin_reseller_revenue.as(\"reseller_revenue\")\n  )\n  l_fin","language":"scala","description":""}