{"parameters":[{"name":"imp_type","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"payment_type","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"revenue_type","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"media_buy_cost","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"media_buy_rev_share_pct","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"seller_revenue_cpm","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"buyer_spend_cpm","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"booked_revenue_dollars","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"commission_cpm","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"commission_revshare","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"serving_fees_cpm","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"serving_fees_revshare","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"apply_cost_on_default","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"revenue_value","type":"column","metadata":{"description":"","tags":[],"mappings":[]}}],"output":"double","isCustomSchemaEnabled":true,"code":"var l_payment_type:                org.apache.spark.sql.Column = lit(0)\n  var l_revenue_type:                org.apache.spark.sql.Column = lit(0)\n  var l_media_buy_cost:              org.apache.spark.sql.Column = lit(0)\n  var l_media_buy_rev_share_pct:     org.apache.spark.sql.Column = lit(0)\n  var l_seller_revenue_cpm:          org.apache.spark.sql.Column = lit(0)\n  var l_buyer_spend_cpm:             org.apache.spark.sql.Column = lit(0)\n  var l_booked_revenue_dollars:      org.apache.spark.sql.Column = lit(0)\n  var l_commission_cpm:              org.apache.spark.sql.Column = lit(0)\n  var l_commission_revshare:         org.apache.spark.sql.Column = lit(0)\n  var l_serving_fees_cpm:            org.apache.spark.sql.Column = lit(0)\n  var l_serving_fees_revshare:       org.apache.spark.sql.Column = lit(0)\n  var l_apply_cost_on_default:       org.apache.spark.sql.Column = lit(0)\n  var l_revenue_dollars_cpm:         org.apache.spark.sql.Column = lit(0)\n  var l_network_revenue_dollars_cpm: org.apache.spark.sql.Column = lit(0)\n  var l_media_cost_dollars_cpm:      org.apache.spark.sql.Column = lit(0)\n  var l_revenue_value:               org.apache.spark.sql.Column = lit(0)\n  l_payment_type = coalesce(payment_type,     lit(0)).cast(IntegerType)\n  l_revenue_type = coalesce(revenue_type,     lit(0)).cast(IntegerType)\n  l_media_buy_cost = coalesce(media_buy_cost, lit(0)).cast(DoubleType)\n  l_media_buy_rev_share_pct =\n    coalesce(media_buy_rev_share_pct,                 lit(0)).cast(DoubleType)\n  l_seller_revenue_cpm = coalesce(seller_revenue_cpm, lit(0)).cast(DoubleType)\n  l_buyer_spend_cpm = coalesce(buyer_spend_cpm,       lit(0)).cast(DoubleType)\n  l_booked_revenue_dollars =\n    coalesce(booked_revenue_dollars,                    lit(0)).cast(DoubleType)\n  l_commission_cpm = coalesce(commission_cpm,           lit(0)).cast(DoubleType)\n  l_commission_revshare = coalesce(commission_revshare, lit(0)).cast(DoubleType)\n  l_serving_fees_cpm = coalesce(serving_fees_cpm,       lit(0)).cast(DoubleType)\n  l_serving_fees_revshare =\n    coalesce(serving_fees_revshare,         lit(0)).cast(DoubleType)\n  l_revenue_value = coalesce(revenue_value, lit(0)).cast(DoubleType)\n  l_media_cost_dollars_cpm = when(coalesce(imp_type, lit(0)) === lit(2),\n                                  when(l_media_buy_rev_share_pct === lit(0),\n                                       l_media_buy_cost\n                                  ).otherwise(l_media_cost_dollars_cpm)\n  ).when(\n      coalesce(imp_type, lit(0)) === lit(4),\n      when((l_apply_cost_on_default === lit(1)).and(\n             l_media_buy_rev_share_pct <= lit(0)\n           ),\n           l_media_buy_cost\n      ).otherwise(l_media_cost_dollars_cpm)\n    )\n    .when(\n      coalesce(imp_type, lit(0)) === lit(5),\n      when(\n        l_media_buy_rev_share_pct > lit(0),\n        when(l_revenue_type.isin(lit(1), lit(2)),\n             l_media_buy_cost * l_media_buy_rev_share_pct\n        ).otherwise {\n          l_media_cost_dollars_cpm =\n            (((l_media_buy_rev_share_pct * (((l_booked_revenue_dollars * lit(\n              1000\n            )) - l_commission_cpm) - (l_commission_revshare * (l_booked_revenue_dollars * lit(\n              1000\n            ))))) - l_serving_fees_cpm) / (lit(1) + l_serving_fees_revshare))\n              .cast(DoubleType)\n          l_media_cost_dollars_cpm = when(\n            (((l_media_buy_rev_share_pct * (((l_booked_revenue_dollars * lit(\n              1000\n            )) - l_commission_cpm) - (l_commission_revshare * (l_booked_revenue_dollars * lit(\n              1000\n            ))))) - l_serving_fees_cpm) / (lit(\n              1\n            ) + l_serving_fees_revshare)) < lit(0),\n            lit(0)\n          ).otherwise(l_media_cost_dollars_cpm).cast(DoubleType)\n          l_media_cost_dollars_cpm\n        }\n      ).otherwise(l_media_buy_cost)\n    )\n    .when(\n      coalesce(imp_type, lit(0)) === lit(6),\n      when((l_payment_type === lit(4)).and(l_revenue_type.isin(lit(3), lit(4))),\n           lit(0)\n      ).when(l_media_buy_rev_share_pct > lit(0),\n              l_seller_revenue_cpm * l_media_buy_rev_share_pct\n        )\n        .otherwise(l_media_buy_cost)\n    )\n    .when(coalesce(imp_type, lit(0)) === lit(7),\n          when(not(l_payment_type.isin(lit(2), lit(-1), lit(1))),\n               l_buyer_spend_cpm\n          ).otherwise(l_media_cost_dollars_cpm)\n    )\n    .when(\n      coalesce(imp_type, lit(0)) === lit(9),\n      when(\n        l_media_buy_rev_share_pct > lit(0), {\n          l_media_cost_dollars_cpm =\n            (l_media_buy_rev_share_pct * ((l_booked_revenue_dollars - (l_commission_cpm / lit(\n              1000\n            ))) - (l_commission_revshare * l_booked_revenue_dollars)))\n              .cast(DoubleType)\n          l_media_cost_dollars_cpm = when(\n            (l_media_buy_rev_share_pct * ((l_booked_revenue_dollars - (l_commission_cpm / lit(\n              1000\n            ))) - (l_commission_revshare * l_booked_revenue_dollars))) < lit(0),\n            lit(0)\n          ).otherwise(l_media_cost_dollars_cpm).cast(DoubleType)\n          l_media_cost_dollars_cpm\n        }\n      ).otherwise(l_media_buy_cost)\n    )\n    .when(\n      coalesce(imp_type, lit(0)) === lit(10),\n      when(\n        l_media_buy_rev_share_pct > lit(0),\n        lit(\n          1000\n        ) * (l_media_buy_rev_share_pct * (l_revenue_value - (l_commission_revshare * l_revenue_value)))\n      ).otherwise(lit(1000) * l_media_buy_cost)\n    )\n    .otherwise(lit(0))\n    .cast(DoubleType)\n  l_media_cost_dollars_cpm","language":"scala","description":""}