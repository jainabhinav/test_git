{"parameters":[{"name":"fx_rate_snapshot_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"advertiser_currency","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"advertiser_currency_rate","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"publisher_currency","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"publisher_currency_rate","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"advertiser_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"imp_type","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"buyer_member_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"seller_member_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"sup_bidder_advertiser_pb_lookup","type":"column","metadata":{"description":"","tags":[],"mappings":[]}}],"output":{"type":"struct","fields":[{"name":"fx_rate_snapshot_id","type":"integer","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"advertiser_currency","type":"string","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"advertiser_exchange_rate","type":"double","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"publisher_currency","type":"string","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"publisher_exchange_rate","type":"double","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"advertiser_default_currency","type":"string","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"advertiser_default_exchange_rate","type":"double","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"member_currency","type":"string","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"member_exchange_rate","type":"double","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"billing_currency","type":"string","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"billing_exchange_rate","type":"double","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}}]},"isCustomSchemaEnabled":true,"code":"var l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id\n    : org.apache.spark.sql.Column = lit(null).cast(IntegerType)\n\n  var l_agg_platform_video_analytics_hourly_pb_currency_advertiser_currency\n    : org.apache.spark.sql.Column = lit(null).cast(StringType)\n\n  var l_agg_platform_video_analytics_hourly_pb_currency_advertiser_exchange_rate\n    : org.apache.spark.sql.Column = lit(null).cast(DoubleType)\n\n  var l_agg_platform_video_analytics_hourly_pb_currency_publisher_currency\n    : org.apache.spark.sql.Column = lit(null).cast(StringType)\n\n  var l_agg_platform_video_analytics_hourly_pb_currency_publisher_exchange_rate\n    : org.apache.spark.sql.Column = lit(null).cast(DoubleType)\n\n  var l_agg_platform_video_analytics_hourly_pb_currency_advertiser_default_currency\n    : org.apache.spark.sql.Column = lit(null).cast(StringType)\n\n  var l_agg_platform_video_analytics_hourly_pb_currency_advertiser_default_exchange_rate\n    : org.apache.spark.sql.Column = lit(null).cast(DoubleType)\n\n  var l_agg_platform_video_analytics_hourly_pb_currency_member_currency\n    : org.apache.spark.sql.Column = lit(null).cast(StringType)\n\n  var l_agg_platform_video_analytics_hourly_pb_currency_member_exchange_rate\n    : org.apache.spark.sql.Column = lit(null).cast(DoubleType)\n\n  var l_agg_platform_video_analytics_hourly_pb_currency_billing_currency\n    : org.apache.spark.sql.Column = lit(null).cast(StringType)\n\n  var l_agg_platform_video_analytics_hourly_pb_currency_billing_exchange_rate\n    : org.apache.spark.sql.Column = lit(null).cast(DoubleType)\n\n  var l_api_member_dde: org.apache.spark.sql.Column = lit(null).cast(\n    StructType(\n      List(\n        StructField(\"id\",                    IntegerType, true),\n        StructField(\"billing_name\",          StringType,  true),\n        StructField(\"bidder_id\",             IntegerType, true),\n        StructField(\"is_billable\",           IntegerType, true),\n        StructField(\"enable_ip_truncation\",  IntegerType, true),\n        StructField(\"vendor_id\",             IntegerType, true),\n        StructField(\"final_auction_type_id\", IntegerType, true),\n        StructField(\"default_referrer_url\",  StringType,  true),\n        StructField(\"member_currency\",       StringType,  true),\n        StructField(\"billing_currency\",      StringType,  true)\n      )\n    )\n  )\n\n  var l_api_member_dde_1: org.apache.spark.sql.Column = lit(null).cast(\n    StructType(\n      List(\n        StructField(\"id\",                    IntegerType, true),\n        StructField(\"billing_name\",          StringType,  true),\n        StructField(\"bidder_id\",             IntegerType, true),\n        StructField(\"is_billable\",           IntegerType, true),\n        StructField(\"enable_ip_truncation\",  IntegerType, true),\n        StructField(\"vendor_id\",             IntegerType, true),\n        StructField(\"final_auction_type_id\", IntegerType, true),\n        StructField(\"default_referrer_url\",  StringType,  true),\n        StructField(\"member_currency\",       StringType,  true),\n        StructField(\"billing_currency\",      StringType,  true)\n      )\n    )\n  )\n\n  var l_api_member_dde_3: org.apache.spark.sql.Column = lit(null).cast(\n    StructType(\n      List(\n        StructField(\"id\",                    IntegerType, true),\n        StructField(\"billing_name\",          StringType,  true),\n        StructField(\"bidder_id\",             IntegerType, true),\n        StructField(\"is_billable\",           IntegerType, true),\n        StructField(\"enable_ip_truncation\",  IntegerType, true),\n        StructField(\"vendor_id\",             IntegerType, true),\n        StructField(\"final_auction_type_id\", IntegerType, true),\n        StructField(\"default_referrer_url\",  StringType,  true),\n        StructField(\"member_currency\",       StringType,  true),\n        StructField(\"billing_currency\",      StringType,  true)\n      )\n    )\n  )\n\n  var l_currency:    org.apache.spark.sql.Column = rpad(lit(null), 3, \" \")\n  var l_currency_1:  org.apache.spark.sql.Column = rpad(lit(null), 3, \" \")\n  var l_currency_3:  org.apache.spark.sql.Column = rpad(lit(null), 3, \" \")\n  var l_member_id:   org.apache.spark.sql.Column = lit(null).cast(IntegerType)\n  var l_member_id_0: org.apache.spark.sql.Column = lit(null).cast(IntegerType)\n\n  var l_agg_platform_video_analytics_hourly_pb_currency\n    : org.apache.spark.sql.Column = lit(null).cast(\n    StructType(\n      List(\n        StructField(\"fx_rate_snapshot_id\",              IntegerType, true),\n        StructField(\"advertiser_currency\",              StringType,  true),\n        StructField(\"advertiser_exchange_rate\",         DoubleType,  true),\n        StructField(\"publisher_currency\",               StringType,  true),\n        StructField(\"publisher_exchange_rate\",          DoubleType,  true),\n        StructField(\"advertiser_default_currency\",      StringType,  true),\n        StructField(\"advertiser_default_exchange_rate\", DoubleType,  true),\n        StructField(\"member_currency\",                  StringType,  true),\n        StructField(\"member_exchange_rate\",             DoubleType,  true),\n        StructField(\"billing_currency\",                 StringType,  true),\n        StructField(\"billing_exchange_rate\",            DoubleType,  true)\n      )\n    )\n  )\n\n  var l_sup_bidder_fx_rate: org.apache.spark.sql.Column = lit(null).cast(\n    StructType(\n      List(\n        StructField(\"fx_rate_snapshot_id\", IntegerType, true),\n        StructField(\"currency_id\",         IntegerType, true),\n        StructField(\"code\",                StringType,  true),\n        StructField(\"rate\",                DoubleType,  true),\n        StructField(\"as_of_timestamp\",     LongType,    true)\n      )\n    )\n  )\n\n  var l_sup_bidder_fx_rate_5: org.apache.spark.sql.Column = lit(null).cast(\n    StructType(\n      List(\n        StructField(\"fx_rate_snapshot_id\", IntegerType, true),\n        StructField(\"currency_id\",         IntegerType, true),\n        StructField(\"code\",                StringType,  true),\n        StructField(\"rate\",                DoubleType,  true),\n        StructField(\"as_of_timestamp\",     LongType,    true)\n      )\n    )\n  )\n\n  var l_sup_bidder_fx_rate_4: org.apache.spark.sql.Column = lit(null).cast(\n    StructType(\n      List(\n        StructField(\"fx_rate_snapshot_id\", IntegerType, true),\n        StructField(\"currency_id\",         IntegerType, true),\n        StructField(\"code\",                StringType,  true),\n        StructField(\"rate\",                DoubleType,  true),\n        StructField(\"as_of_timestamp\",     LongType,    true)\n      )\n    )\n  )\n\n  var l_sup_bidder_fx_rate_1: org.apache.spark.sql.Column = lit(null).cast(\n    StructType(\n      List(\n        StructField(\"fx_rate_snapshot_id\", IntegerType, true),\n        StructField(\"currency_id\",         IntegerType, true),\n        StructField(\"code\",                StringType,  true),\n        StructField(\"rate\",                DoubleType,  true),\n        StructField(\"as_of_timestamp\",     LongType,    true)\n      )\n    )\n  )\n\n  var l_sup_bidder_fx_rate_0: org.apache.spark.sql.Column = lit(null).cast(\n    StructType(\n      List(\n        StructField(\"fx_rate_snapshot_id\", IntegerType, true),\n        StructField(\"currency_id\",         IntegerType, true),\n        StructField(\"code\",                StringType,  true),\n        StructField(\"rate\",                DoubleType,  true),\n        StructField(\"as_of_timestamp\",     LongType,    true)\n      )\n    )\n  )\n\n  l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id =\n    fx_rate_snapshot_id.cast(IntegerType)\n  l_agg_platform_video_analytics_hourly_pb_currency_advertiser_currency =\n    coalesce(advertiser_currency, lit(\"USD\"))\n  l_agg_platform_video_analytics_hourly_pb_currency_advertiser_exchange_rate =\n    coalesce(advertiser_currency_rate, lit(1.0)).cast(DoubleType)\n  l_agg_platform_video_analytics_hourly_pb_currency_advertiser_currency =\n    when(isnull(fx_rate_snapshot_id).and(\n           isnull(advertiser_currency).or(isnull(advertiser_currency_rate))\n         ),\n         lit(\"USD\")\n    ).otherwise(\n      l_agg_platform_video_analytics_hourly_pb_currency_advertiser_currency\n    )\n  l_agg_platform_video_analytics_hourly_pb_currency_advertiser_exchange_rate =\n    when(isnull(fx_rate_snapshot_id).and(\n           isnull(advertiser_currency).or(isnull(advertiser_currency_rate))\n         ),\n         lit(1.0)\n    ).otherwise(\n        l_agg_platform_video_analytics_hourly_pb_currency_advertiser_exchange_rate\n      )\n      .cast(DoubleType)\n  l_agg_platform_video_analytics_hourly_pb_currency_publisher_currency =\n    coalesce(publisher_currency, lit(\"USD\"))\n  l_agg_platform_video_analytics_hourly_pb_currency_publisher_exchange_rate =\n    coalesce(publisher_currency_rate, lit(1.0)).cast(DoubleType)\n  l_agg_platform_video_analytics_hourly_pb_currency_publisher_currency =\n    when(isnull(fx_rate_snapshot_id).and(\n           isnull(publisher_currency).or(isnull(publisher_currency_rate))\n         ),\n         lit(\"USD\")\n    ).otherwise(\n      l_agg_platform_video_analytics_hourly_pb_currency_publisher_currency\n    )\n  l_agg_platform_video_analytics_hourly_pb_currency_publisher_exchange_rate =\n    when(isnull(fx_rate_snapshot_id).and(\n           isnull(publisher_currency).or(isnull(publisher_currency_rate))\n         ),\n         lit(1.0)\n    ).otherwise(\n        l_agg_platform_video_analytics_hourly_pb_currency_publisher_exchange_rate\n      )\n      .cast(DoubleType)\n  l_agg_platform_video_analytics_hourly_pb_currency_advertiser_default_currency =\n    lit(\"USD\")\n  l_agg_platform_video_analytics_hourly_pb_currency_advertiser_default_exchange_rate =\n    lit(1.0).cast(DoubleType)\n  l_agg_platform_video_analytics_hourly_pb_currency_billing_currency = lit(\n    \"USD\"\n  )\n  l_agg_platform_video_analytics_hourly_pb_currency_billing_exchange_rate =\n    lit(1.0).cast(DoubleType)\n  l_agg_platform_video_analytics_hourly_pb_currency_member_currency = lit(\"USD\")\n  l_agg_platform_video_analytics_hourly_pb_currency_member_exchange_rate =\n    lit(1.0).cast(DoubleType)\n  l_member_id_0 = when(\n    is_not_null(imp_type).cast(BooleanType),\n    when(imp_type\n           .isin(lit(9), lit(10), lit(11), lit(7), lit(5))\n           .and(is_not_null(buyer_member_id)),\n         buyer_member_id.cast(IntegerType)\n    ).when(is_not_null(seller_member_id).cast(BooleanType),\n            seller_member_id.cast(IntegerType)\n      )\n      .otherwise(l_member_id)\n  ).otherwise(l_member_id).cast(IntegerType)\n  l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id = when(\n    isnull(fx_rate_snapshot_id).and(\n      string_compare(\n        l_agg_platform_video_analytics_hourly_pb_currency_advertiser_currency,\n        lit(\"USD\")\n      ) =!= lit(0)\n    ),\n    when(is_not_null(lookup(\"sup_code_fx_rate\", advertiser_currency)),\n         lookup(\"sup_code_fx_rate\",             advertiser_currency).getField(\n           \"fx_rate_snapshot_id\"\n         )\n    ).otherwise(\n      l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id\n    )\n  ).otherwise(\n      l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id\n    )\n    .cast(IntegerType)\n  l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id = when(\n    isnull(fx_rate_snapshot_id).and(\n      string_compare(\n        l_agg_platform_video_analytics_hourly_pb_currency_publisher_currency,\n        lit(\"USD\")\n      ) =!= lit(0)\n    ),\n    when(is_not_null(lookup(\"sup_code_fx_rate\", publisher_currency)),\n         lookup(\"sup_code_fx_rate\",             publisher_currency).getField(\n           \"fx_rate_snapshot_id\"\n         )\n    ).otherwise(\n      l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id\n    )\n  ).otherwise(\n      l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id\n    )\n    .cast(IntegerType)\n  l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id = when(\n    isnull(fx_rate_snapshot_id).and(is_not_null(l_member_id_0)), {\n      l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id =\n        when(\n          (is_not_null(advertiser_id)\n            .cast(BooleanType)\n            .and(\n              is_not_null(\n                rpad(sup_bidder_advertiser_pb_lookup\n                       .getField(\"advertiser_default_currency\"),\n                     3,\n                     \" \"\n                )\n              ).and(\n                string_compare(rpad(sup_bidder_advertiser_pb_lookup\n                                      .getField(\"advertiser_default_currency\"),\n                                    3,\n                                    \" \"\n                               ),\n                               lit(\"USD\")\n                ) =!= lit(0)\n              )\n            ))\n            .and(\n              is_not_null(\n                lookup(\"sup_code_fx_rate\",\n                       rpad(sup_bidder_advertiser_pb_lookup\n                              .getField(\"advertiser_default_currency\"),\n                            3,\n                            \" \"\n                       )\n                )\n              ).cast(BooleanType)\n            ),\n          lookup(\"sup_code_fx_rate\",\n                 rpad(sup_bidder_advertiser_pb_lookup.getField(\n                        \"advertiser_default_currency\"\n                      ),\n                      3,\n                      \" \"\n                 )\n          ).getField(\"fx_rate_snapshot_id\")\n        ).otherwise(\n            l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id\n          )\n          .cast(IntegerType)\n      l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id =\n        when(\n          is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0)).cast(\n            BooleanType\n          ), {\n            l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id =\n              when(\n                (is_not_null(\n                  lookup(\"sup_api_member_pb\", l_member_id_0).getField(\n                    \"member_currency\"\n                  )\n                ).and(is_currency_2_enabled_member(l_member_id_0) === lit(1)))\n                  .and(\n                    string_compare(lookup(\"sup_api_member_pb\", l_member_id_0)\n                                     .getField(\"member_currency\"),\n                                   lit(\"USD\")\n                    ) =!= lit(0)\n                  ),\n                when(\n                  is_not_null(\n                    l_agg_platform_video_analytics_hourly_pb_currency_member_exchange_rate\n                  ),\n                  lookup(\"sup_code_fx_rate\",\n                         lookup(\"sup_api_member_pb\", l_member_id_0).getField(\n                           \"member_currency\"\n                         )\n                  ).getField(\"fx_rate_snapshot_id\")\n                ).otherwise(\n                  l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id\n                )\n              ).otherwise(\n                  l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id\n                )\n                .cast(IntegerType)\n            l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id =\n              when(\n                is_not_null(\n                  lookup(\"sup_api_member_pb\", l_member_id_0).getField(\n                    \"billing_currency\"\n                  )\n                ).and(\n                  string_compare(lookup(\"sup_api_member_pb\", l_member_id_0)\n                                   .getField(\"billing_currency\"),\n                                 lit(\"USD\")\n                  ) =!= lit(0)\n                ),\n                when(\n                  is_not_null(\n                    lookup(\"sup_code_fx_rate\",\n                           lookup(\"sup_api_member_pb\", l_member_id_0).getField(\n                             \"billing_currency\"\n                           )\n                    )\n                  ),\n                  lookup(\"sup_code_fx_rate\",\n                         lookup(\"sup_api_member_pb\", l_member_id_0).getField(\n                           \"billing_currency\"\n                         )\n                  ).getField(\"fx_rate_snapshot_id\")\n                ).otherwise(\n                  l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id\n                )\n              ).otherwise(\n                  l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id\n                )\n                .cast(IntegerType)\n            l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id\n          }\n        ).otherwise(\n            l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id\n          )\n          .cast(IntegerType)\n      l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id\n    }\n  ).otherwise(\n      l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id\n    )\n    .cast(IntegerType)\n  l_agg_platform_video_analytics_hourly_pb_currency_advertiser_exchange_rate =\n    when(\n      is_not_null(fx_rate_snapshot_id).cast(BooleanType),\n      when(\n        string_compare(\n          l_agg_platform_video_analytics_hourly_pb_currency_advertiser_currency,\n          lit(\"USD\")\n        ) =!= lit(0), {\n          l_agg_platform_video_analytics_hourly_pb_currency_advertiser_exchange_rate =\n            lookup(\"sup_bidder_fx_rates\",\n                   fx_rate_snapshot_id,\n                   advertiser_currency\n            ).getField(\"rate\").cast(DoubleType)\n          l_agg_platform_video_analytics_hourly_pb_currency_advertiser_exchange_rate =\n            when(isnull(\n                   lookup(\"sup_bidder_fx_rates\",\n                          fx_rate_snapshot_id,\n                          advertiser_currency\n                   ).getField(\"rate\")\n                 ).cast(BooleanType),\n                 lit(1.0)\n            ).otherwise(\n                l_agg_platform_video_analytics_hourly_pb_currency_advertiser_exchange_rate\n              )\n              .cast(DoubleType)\n          l_agg_platform_video_analytics_hourly_pb_currency_advertiser_exchange_rate\n        }\n      ).otherwise(lit(1.0))\n    ).when(\n        string_compare(\n          l_agg_platform_video_analytics_hourly_pb_currency_advertiser_currency,\n          lit(\"USD\")\n        ) =!= lit(0),\n        when(isnull(lookup(\"sup_code_fx_rate\", advertiser_currency))\n               .cast(BooleanType),\n             lit(1.0)\n        ).otherwise(\n          lookup(\"sup_code_fx_rate\", advertiser_currency).getField(\"rate\")\n        )\n      )\n      .otherwise(lit(1.0))\n      .cast(DoubleType)\n  l_agg_platform_video_analytics_hourly_pb_currency_advertiser_currency = when(\n    is_not_null(fx_rate_snapshot_id).cast(BooleanType),\n    when(\n      string_compare(\n        l_agg_platform_video_analytics_hourly_pb_currency_advertiser_currency,\n        lit(\"USD\")\n      ) =!= lit(0),\n      when(isnull(\n             lookup(\"sup_bidder_fx_rates\",\n                    fx_rate_snapshot_id,\n                    advertiser_currency\n             ).getField(\"rate\")\n           ).cast(BooleanType),\n           lit(\"USD\")\n      ).otherwise(\n        l_agg_platform_video_analytics_hourly_pb_currency_advertiser_currency\n      )\n    ).otherwise(\n      l_agg_platform_video_analytics_hourly_pb_currency_advertiser_currency\n    )\n  ).when(\n      string_compare(\n        l_agg_platform_video_analytics_hourly_pb_currency_advertiser_currency,\n        lit(\"USD\")\n      ) =!= lit(0),\n      when(isnull(lookup(\"sup_code_fx_rate\", advertiser_currency))\n             .cast(BooleanType),\n           lit(\"USD\")\n      ).otherwise(\n        l_agg_platform_video_analytics_hourly_pb_currency_advertiser_currency\n      )\n    )\n    .otherwise(\n      l_agg_platform_video_analytics_hourly_pb_currency_advertiser_currency\n    )\n  l_sup_bidder_fx_rate_1 = when(\n    isnull(fx_rate_snapshot_id).and(\n      string_compare(\n        l_agg_platform_video_analytics_hourly_pb_currency_advertiser_currency,\n        lit(\"USD\")\n      ) =!= lit(0)\n    ),\n    lookup(\"sup_code_fx_rate\", advertiser_currency)\n  ).when(\n      isnull(fx_rate_snapshot_id).and(\n        not(\n          string_compare(\n            l_agg_platform_video_analytics_hourly_pb_currency_advertiser_currency,\n            lit(\"USD\")\n          ) =!= lit(0)\n        )\n      ),\n      l_sup_bidder_fx_rate\n    )\n    .otherwise(l_sup_bidder_fx_rate_1)\n  l_agg_platform_video_analytics_hourly_pb_currency_publisher_exchange_rate =\n    when(\n      is_not_null(fx_rate_snapshot_id).cast(BooleanType),\n      when(\n        string_compare(\n          l_agg_platform_video_analytics_hourly_pb_currency_publisher_currency,\n          lit(\"USD\")\n        ) =!= lit(0), {\n          l_agg_platform_video_analytics_hourly_pb_currency_publisher_exchange_rate =\n            lookup(\"sup_bidder_fx_rates\",\n                   fx_rate_snapshot_id,\n                   publisher_currency\n            ).getField(\"rate\").cast(DoubleType)\n          l_agg_platform_video_analytics_hourly_pb_currency_publisher_exchange_rate =\n            when(isnull(\n                   lookup(\"sup_bidder_fx_rates\",\n                          fx_rate_snapshot_id,\n                          publisher_currency\n                   ).getField(\"rate\")\n                 ).cast(BooleanType),\n                 lit(1.0)\n            ).otherwise(\n                l_agg_platform_video_analytics_hourly_pb_currency_publisher_exchange_rate\n              )\n              .cast(DoubleType)\n          l_agg_platform_video_analytics_hourly_pb_currency_publisher_exchange_rate\n        }\n      ).otherwise(lit(1.0))\n    ).when(\n        string_compare(\n          l_agg_platform_video_analytics_hourly_pb_currency_publisher_currency,\n          lit(\"USD\")\n        ) =!= lit(0),\n        when(isnull(lookup(\"sup_code_fx_rate\", publisher_currency))\n               .cast(BooleanType),\n             lit(1.0)\n        ).otherwise(\n          lookup(\"sup_code_fx_rate\", publisher_currency).getField(\"rate\")\n        )\n      )\n      .otherwise(lit(1.0))\n      .cast(DoubleType)\n  l_sup_bidder_fx_rate_5 = when(\n    isnull(fx_rate_snapshot_id).and(is_not_null(l_member_id_0)),\n    when(\n      is_not_null(advertiser_id).cast(BooleanType),\n      when(\n        is_not_null(\n          rpad(sup_bidder_advertiser_pb_lookup.getField(\n                 \"advertiser_default_currency\"\n               ),\n               3,\n               \" \"\n          )\n        ).and(\n          string_compare(rpad(sup_bidder_advertiser_pb_lookup\n                                .getField(\"advertiser_default_currency\"),\n                              3,\n                              \" \"\n                         ),\n                         lit(\"USD\")\n          ) =!= lit(0)\n        ),\n        lookup(\"sup_code_fx_rate\",\n               rpad(sup_bidder_advertiser_pb_lookup.getField(\n                      \"advertiser_default_currency\"\n                    ),\n                    3,\n                    \" \"\n               )\n        )\n      ).otherwise(l_sup_bidder_fx_rate_0)\n    ).otherwise(l_sup_bidder_fx_rate_0)\n  ).otherwise(l_sup_bidder_fx_rate_5)\n  l_agg_platform_video_analytics_hourly_pb_currency_publisher_currency = when(\n    is_not_null(fx_rate_snapshot_id).cast(BooleanType),\n    when(\n      string_compare(\n        l_agg_platform_video_analytics_hourly_pb_currency_publisher_currency,\n        lit(\"USD\")\n      ) =!= lit(0),\n      when(isnull(\n             lookup(\"sup_bidder_fx_rates\",\n                    fx_rate_snapshot_id,\n                    publisher_currency\n             ).getField(\"rate\")\n           ).cast(BooleanType),\n           lit(\"USD\")\n      ).otherwise(\n        l_agg_platform_video_analytics_hourly_pb_currency_publisher_currency\n      )\n    ).otherwise(\n      l_agg_platform_video_analytics_hourly_pb_currency_publisher_currency\n    )\n  ).when(\n      string_compare(\n        l_agg_platform_video_analytics_hourly_pb_currency_publisher_currency,\n        lit(\"USD\")\n      ) =!= lit(0),\n      when(isnull(lookup(\"sup_code_fx_rate\", publisher_currency))\n             .cast(BooleanType),\n           lit(\"USD\")\n      ).otherwise(\n        l_agg_platform_video_analytics_hourly_pb_currency_publisher_currency\n      )\n    )\n    .otherwise(\n      l_agg_platform_video_analytics_hourly_pb_currency_publisher_currency\n    )\n  l_agg_platform_video_analytics_hourly_pb_currency_advertiser_default_exchange_rate =\n    when(\n      is_not_null(fx_rate_snapshot_id).cast(BooleanType),\n      when(\n        (is_not_null(l_member_id_0)\n          .cast(BooleanType)\n          .and(is_not_null(advertiser_id).cast(BooleanType)))\n          .and(\n            is_not_null(\n              rpad(sup_bidder_advertiser_pb_lookup\n                     .getField(\"advertiser_default_currency\"),\n                   3,\n                   \" \"\n              )\n            ).and(\n              string_compare(rpad(sup_bidder_advertiser_pb_lookup\n                                    .getField(\"advertiser_default_currency\"),\n                                  3,\n                                  \" \"\n                             ),\n                             lit(\"USD\")\n              ) =!= lit(0)\n            )\n          ), {\n          l_agg_platform_video_analytics_hourly_pb_currency_advertiser_default_exchange_rate =\n            lookup(\"sup_bidder_fx_rates\",\n                   fx_rate_snapshot_id,\n                   rpad(sup_bidder_advertiser_pb_lookup.getField(\n                          \"advertiser_default_currency\"\n                        ),\n                        3,\n                        \" \"\n                   )\n            ).getField(\"rate\").cast(DoubleType)\n          l_agg_platform_video_analytics_hourly_pb_currency_advertiser_default_exchange_rate =\n            when(isnull(\n                   l_agg_platform_video_analytics_hourly_pb_currency_advertiser_default_exchange_rate\n                 ),\n                 lit(1.0)\n            ).otherwise(\n                l_agg_platform_video_analytics_hourly_pb_currency_advertiser_default_exchange_rate\n              )\n              .cast(DoubleType)\n          l_agg_platform_video_analytics_hourly_pb_currency_advertiser_default_exchange_rate\n        }\n      ).otherwise(\n        l_agg_platform_video_analytics_hourly_pb_currency_advertiser_default_exchange_rate\n      )\n    ).when(\n        (is_not_null(l_member_id_0)\n          .cast(BooleanType)\n          .and(is_not_null(advertiser_id).cast(BooleanType)))\n          .and(\n            is_not_null(\n              rpad(sup_bidder_advertiser_pb_lookup\n                     .getField(\"advertiser_default_currency\"),\n                   3,\n                   \" \"\n              )\n            ).and(\n              string_compare(rpad(sup_bidder_advertiser_pb_lookup\n                                    .getField(\"advertiser_default_currency\"),\n                                  3,\n                                  \" \"\n                             ),\n                             lit(\"USD\")\n              ) =!= lit(0)\n            )\n          ),\n        when(\n          is_not_null(\n            lookup(\"sup_code_fx_rate\",\n                   rpad(sup_bidder_advertiser_pb_lookup\n                          .getField(\"advertiser_default_currency\"),\n                        3,\n                        \" \"\n                   )\n            )\n          ).cast(BooleanType),\n          lookup(\"sup_code_fx_rate\",\n                 rpad(sup_bidder_advertiser_pb_lookup.getField(\n                        \"advertiser_default_currency\"\n                      ),\n                      3,\n                      \" \"\n                 )\n          ).getField(\"rate\")\n        ).otherwise(lit(1.0))\n      )\n      .otherwise(\n        l_agg_platform_video_analytics_hourly_pb_currency_advertiser_default_exchange_rate\n      )\n      .cast(DoubleType)\n  l_agg_platform_video_analytics_hourly_pb_currency_advertiser_default_currency =\n    when(\n      is_not_null(fx_rate_snapshot_id).cast(BooleanType),\n      when(\n        (is_not_null(l_member_id_0)\n          .cast(BooleanType)\n          .and(is_not_null(advertiser_id).cast(BooleanType)))\n          .and(\n            is_not_null(\n              rpad(sup_bidder_advertiser_pb_lookup\n                     .getField(\"advertiser_default_currency\"),\n                   3,\n                   \" \"\n              )\n            ).and(\n              string_compare(rpad(sup_bidder_advertiser_pb_lookup\n                                    .getField(\"advertiser_default_currency\"),\n                                  3,\n                                  \" \"\n                             ),\n                             lit(\"USD\")\n              ) =!= lit(0)\n            )\n          ),\n        when(\n          is_not_null(\n            l_agg_platform_video_analytics_hourly_pb_currency_advertiser_default_exchange_rate\n          ).cast(BooleanType),\n          rpad(sup_bidder_advertiser_pb_lookup.getField(\n                 \"advertiser_default_currency\"\n               ),\n               3,\n               \" \"\n          )\n        ).otherwise(lit(\"USD\"))\n      ).otherwise(\n        l_agg_platform_video_analytics_hourly_pb_currency_advertiser_default_currency\n      )\n    ).when(\n        (is_not_null(l_member_id_0)\n          .cast(BooleanType)\n          .and(is_not_null(advertiser_id).cast(BooleanType)))\n          .and(\n            is_not_null(\n              rpad(sup_bidder_advertiser_pb_lookup\n                     .getField(\"advertiser_default_currency\"),\n                   3,\n                   \" \"\n              )\n            ).and(\n              string_compare(rpad(sup_bidder_advertiser_pb_lookup\n                                    .getField(\"advertiser_default_currency\"),\n                                  3,\n                                  \" \"\n                             ),\n                             lit(\"USD\")\n              ) =!= lit(0)\n            )\n          ),\n        when(\n          is_not_null(\n            lookup(\"sup_code_fx_rate\",\n                   rpad(sup_bidder_advertiser_pb_lookup\n                          .getField(\"advertiser_default_currency\"),\n                        3,\n                        \" \"\n                   )\n            )\n          ).cast(BooleanType),\n          rpad(sup_bidder_advertiser_pb_lookup.getField(\n                 \"advertiser_default_currency\"\n               ),\n               3,\n               \" \"\n          )\n        ).otherwise(lit(\"USD\"))\n      )\n      .otherwise(\n        l_agg_platform_video_analytics_hourly_pb_currency_advertiser_default_currency\n      )\n  l_agg_platform_video_analytics_hourly_pb_currency_billing_currency = when(\n    is_not_null(fx_rate_snapshot_id).cast(BooleanType),\n    when(\n      (is_not_null(l_member_id_0)\n        .cast(BooleanType)\n        .and(\n          is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0))\n            .cast(BooleanType)\n        ))\n        .and(\n          is_not_null(\n            lookup(\"sup_api_member_pb\", l_member_id_0)\n              .getField(\"billing_currency\")\n          ).cast(BooleanType)\n        ), {\n        l_agg_platform_video_analytics_hourly_pb_currency_billing_currency =\n          lookup(\"sup_api_member_pb\", l_member_id_0).getField(\n            \"billing_currency\"\n          )\n        l_agg_platform_video_analytics_hourly_pb_currency_billing_currency =\n          when(\n            isnull(\n              lookup(\"sup_bidder_fx_rates\",\n                     fx_rate_snapshot_id,\n                     lookup(\"sup_api_member_pb\", l_member_id_0).getField(\n                       \"billing_currency\"\n                     )\n              ).getField(\"rate\")\n            ).cast(BooleanType),\n            lit(\"USD\")\n          ).otherwise(\n            l_agg_platform_video_analytics_hourly_pb_currency_billing_currency\n          )\n        l_agg_platform_video_analytics_hourly_pb_currency_billing_currency\n      }\n    ).otherwise(\n      l_agg_platform_video_analytics_hourly_pb_currency_billing_currency\n    )\n  ).when(\n      (is_not_null(l_member_id_0)\n        .cast(BooleanType)\n        .and(\n          is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0))\n            .cast(BooleanType)\n        ))\n        .and(\n          is_not_null(\n            lookup(\"sup_api_member_pb\", l_member_id_0)\n              .getField(\"billing_currency\")\n          ).and(\n            string_compare(lookup(\"sup_api_member_pb\", l_member_id_0)\n                             .getField(\"billing_currency\"),\n                           lit(\"USD\")\n            ) =!= lit(0)\n          )\n        ),\n      when(isnull(\n             lookup(\"sup_code_fx_rate\",\n                    lookup(\"sup_api_member_pb\", l_member_id_0)\n                      .getField(\"billing_currency\")\n             )\n           ).cast(BooleanType),\n           lit(\"USD\")\n      ).otherwise(\n        lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"billing_currency\")\n      )\n    )\n    .otherwise(\n      l_agg_platform_video_analytics_hourly_pb_currency_billing_currency\n    )\n  l_agg_platform_video_analytics_hourly_pb_currency_member_exchange_rate = when(\n    is_not_null(fx_rate_snapshot_id).cast(BooleanType),\n    when(\n      (is_not_null(l_member_id_0)\n        .cast(BooleanType)\n        .and(\n          is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0))\n            .cast(BooleanType)\n        ))\n        .and(\n          is_not_null(\n            lookup(\"sup_api_member_pb\", l_member_id_0)\n              .getField(\"member_currency\")\n          ).and(is_currency_2_enabled_member(l_member_id_0) === lit(1))\n        ), {\n        l_agg_platform_video_analytics_hourly_pb_currency_member_exchange_rate =\n          lookup(\"sup_bidder_fx_rates\",\n                 fx_rate_snapshot_id,\n                 lookup(\"sup_api_member_pb\", l_member_id_0).getField(\n                   \"member_currency\"\n                 )\n          ).getField(\"rate\").cast(DoubleType)\n        l_agg_platform_video_analytics_hourly_pb_currency_member_exchange_rate =\n          when(\n            isnull(\n              lookup(\"sup_bidder_fx_rates\",\n                     fx_rate_snapshot_id,\n                     lookup(\"sup_api_member_pb\", l_member_id_0).getField(\n                       \"member_currency\"\n                     )\n              ).getField(\"rate\")\n            ).cast(BooleanType),\n            lit(1.0)\n          ).otherwise(\n              l_agg_platform_video_analytics_hourly_pb_currency_member_exchange_rate\n            )\n            .cast(DoubleType)\n        l_agg_platform_video_analytics_hourly_pb_currency_member_exchange_rate\n      }\n    ).otherwise(\n      l_agg_platform_video_analytics_hourly_pb_currency_member_exchange_rate\n    )\n  ).when(\n      (is_not_null(l_member_id_0)\n        .cast(BooleanType)\n        .and(\n          is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0))\n            .cast(BooleanType)\n        ))\n        .and(\n          (is_not_null(\n            lookup(\"sup_api_member_pb\", l_member_id_0)\n              .getField(\"member_currency\")\n          ).and(is_currency_2_enabled_member(l_member_id_0) === lit(1)))\n            .and(\n              string_compare(lookup(\"sup_api_member_pb\", l_member_id_0)\n                               .getField(\"member_currency\"),\n                             lit(\"USD\")\n              ) =!= lit(0)\n            )\n        ),\n      when(\n        isnull(\n          l_agg_platform_video_analytics_hourly_pb_currency_member_exchange_rate\n        ).cast(BooleanType),\n        lit(1.0)\n      ).otherwise(\n        lookup(\n          \"sup_code_fx_rate\",\n          lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"member_currency\")\n        ).getField(\"rate\")\n      )\n    )\n    .otherwise(\n      l_agg_platform_video_analytics_hourly_pb_currency_member_exchange_rate\n    )\n    .cast(DoubleType)\n  l_agg_platform_video_analytics_hourly_pb_currency_billing_exchange_rate =\n    when(\n      is_not_null(fx_rate_snapshot_id).cast(BooleanType),\n      when(\n        (is_not_null(l_member_id_0)\n          .cast(BooleanType)\n          .and(\n            is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0))\n              .cast(BooleanType)\n          ))\n          .and(\n            is_not_null(\n              lookup(\"sup_api_member_pb\", l_member_id_0)\n                .getField(\"billing_currency\")\n            ).cast(BooleanType)\n          ), {\n          l_agg_platform_video_analytics_hourly_pb_currency_billing_exchange_rate =\n            lookup(\"sup_bidder_fx_rates\",\n                   fx_rate_snapshot_id,\n                   lookup(\"sup_api_member_pb\", l_member_id_0).getField(\n                     \"billing_currency\"\n                   )\n            ).getField(\"rate\").cast(DoubleType)\n          l_agg_platform_video_analytics_hourly_pb_currency_billing_exchange_rate =\n            when(\n              isnull(\n                lookup(\"sup_bidder_fx_rates\",\n                       fx_rate_snapshot_id,\n                       lookup(\"sup_api_member_pb\", l_member_id_0).getField(\n                         \"billing_currency\"\n                       )\n                ).getField(\"rate\")\n              ).cast(BooleanType),\n              lit(1.0)\n            ).otherwise(\n                l_agg_platform_video_analytics_hourly_pb_currency_billing_exchange_rate\n              )\n              .cast(DoubleType)\n          l_agg_platform_video_analytics_hourly_pb_currency_billing_exchange_rate\n        }\n      ).otherwise(\n        l_agg_platform_video_analytics_hourly_pb_currency_billing_exchange_rate\n      )\n    ).when(\n        (is_not_null(l_member_id_0)\n          .cast(BooleanType)\n          .and(\n            is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0))\n              .cast(BooleanType)\n          ))\n          .and(\n            is_not_null(\n              lookup(\"sup_api_member_pb\", l_member_id_0)\n                .getField(\"billing_currency\")\n            ).and(\n              string_compare(lookup(\"sup_api_member_pb\", l_member_id_0)\n                               .getField(\"billing_currency\"),\n                             lit(\"USD\")\n              ) =!= lit(0)\n            )\n          ),\n        when(isnull(\n               lookup(\"sup_code_fx_rate\",\n                      lookup(\"sup_api_member_pb\", l_member_id_0)\n                        .getField(\"billing_currency\")\n               )\n             ).cast(BooleanType),\n             lit(1.0)\n        ).otherwise(\n          lookup(\"sup_code_fx_rate\",\n                 lookup(\"sup_api_member_pb\", l_member_id_0)\n                   .getField(\"billing_currency\")\n          ).getField(\"rate\")\n        )\n      )\n      .otherwise(\n        l_agg_platform_video_analytics_hourly_pb_currency_billing_exchange_rate\n      )\n      .cast(DoubleType)\n  l_agg_platform_video_analytics_hourly_pb_currency_member_currency = when(\n    is_not_null(fx_rate_snapshot_id).cast(BooleanType),\n    when(\n      (is_not_null(l_member_id_0)\n        .cast(BooleanType)\n        .and(\n          is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0))\n            .cast(BooleanType)\n        ))\n        .and(\n          is_not_null(\n            lookup(\"sup_api_member_pb\", l_member_id_0)\n              .getField(\"member_currency\")\n          ).and(is_currency_2_enabled_member(l_member_id_0) === lit(1))\n        ), {\n        l_agg_platform_video_analytics_hourly_pb_currency_member_currency =\n          lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"member_currency\")\n        l_agg_platform_video_analytics_hourly_pb_currency_member_currency =\n          when(\n            isnull(\n              lookup(\"sup_bidder_fx_rates\",\n                     fx_rate_snapshot_id,\n                     lookup(\"sup_api_member_pb\", l_member_id_0).getField(\n                       \"member_currency\"\n                     )\n              ).getField(\"rate\")\n            ).cast(BooleanType),\n            lit(\"USD\")\n          ).otherwise(\n            l_agg_platform_video_analytics_hourly_pb_currency_member_currency\n          )\n        l_agg_platform_video_analytics_hourly_pb_currency_member_currency\n      }\n    ).otherwise(\n      l_agg_platform_video_analytics_hourly_pb_currency_member_currency\n    )\n  ).when(\n      (is_not_null(l_member_id_0)\n        .cast(BooleanType)\n        .and(\n          is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0))\n            .cast(BooleanType)\n        ))\n        .and(\n          (is_not_null(\n            lookup(\"sup_api_member_pb\", l_member_id_0)\n              .getField(\"member_currency\")\n          ).and(is_currency_2_enabled_member(l_member_id_0) === lit(1)))\n            .and(\n              string_compare(lookup(\"sup_api_member_pb\", l_member_id_0)\n                               .getField(\"member_currency\"),\n                             lit(\"USD\")\n              ) =!= lit(0)\n            )\n        ),\n      when(\n        isnull(\n          l_agg_platform_video_analytics_hourly_pb_currency_member_exchange_rate\n        ).cast(BooleanType),\n        lit(\"USD\")\n      ).otherwise(\n        lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"member_currency\")\n      )\n    )\n    .otherwise(\n      l_agg_platform_video_analytics_hourly_pb_currency_member_currency\n    )\n  l_agg_platform_video_analytics_hourly_pb_currency = struct(\n    l_agg_platform_video_analytics_hourly_pb_currency_fx_rate_snapshot_id.as(\n      \"fx_rate_snapshot_id\"\n    ),\n    l_agg_platform_video_analytics_hourly_pb_currency_advertiser_currency.as(\n      \"advertiser_currency\"\n    ),\n    l_agg_platform_video_analytics_hourly_pb_currency_advertiser_exchange_rate\n      .as(\"advertiser_exchange_rate\"),\n    l_agg_platform_video_analytics_hourly_pb_currency_publisher_currency.as(\n      \"publisher_currency\"\n    ),\n    l_agg_platform_video_analytics_hourly_pb_currency_publisher_exchange_rate\n      .as(\"publisher_exchange_rate\"),\n    l_agg_platform_video_analytics_hourly_pb_currency_advertiser_default_currency\n      .as(\"advertiser_default_currency\"),\n    l_agg_platform_video_analytics_hourly_pb_currency_advertiser_default_exchange_rate\n      .as(\"advertiser_default_exchange_rate\"),\n    l_agg_platform_video_analytics_hourly_pb_currency_member_currency.as(\n      \"member_currency\"\n    ),\n    l_agg_platform_video_analytics_hourly_pb_currency_member_exchange_rate.as(\n      \"member_exchange_rate\"\n    ),\n    l_agg_platform_video_analytics_hourly_pb_currency_billing_currency.as(\n      \"billing_currency\"\n    ),\n    l_agg_platform_video_analytics_hourly_pb_currency_billing_exchange_rate.as(\n      \"billing_exchange_rate\"\n    )\n  )\n  l_agg_platform_video_analytics_hourly_pb_currency","language":"scala","description":""}