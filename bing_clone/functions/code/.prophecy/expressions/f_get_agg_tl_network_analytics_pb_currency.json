{"parameters":[{"name":"fx_rate_snapshot_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"publisher_currency","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"publisher_currency_rate","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"advertiser_currency","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"advertiser_currency_rate","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"advertiser_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"imp_type","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"buyer_member_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"seller_member_id","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"sup_bidder_advertiser_pb_lookup_2","type":"column","metadata":{"description":"","tags":[],"mappings":[]}},{"name":"sup_bidder_advertiser_pb_lookup","type":"column","metadata":{"description":"","tags":[],"mappings":[]}}],"output":{"type":"struct","fields":[{"name":"fx_rate_snapshot_id","type":"integer","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"publisher_currency","type":"string","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"publisher_exchange_rate","type":"double","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"advertiser_currency","type":"string","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"advertiser_exchange_rate","type":"double","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"advertiser_default_currency","type":"string","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"advertiser_default_exchange_rate","type":"double","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"member_currency","type":"string","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"member_exchange_rate","type":"double","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"billing_currency","type":"string","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}},{"name":"billing_exchange_rate","type":"double","nullable":true,"metadata":{"description":"","mappings":[],"tags":[]}}]},"isCustomSchemaEnabled":true,"code":"var l_member_id: org.apache.spark.sql.Column = lit(null).cast(IntegerType)\nvar l_member_id_0: org.apache.spark.sql.Column = lit(null).cast(IntegerType)\nvar l_agg_tl_network_analytics_pb_currency: org.apache.spark.sql.Column = lit(null).cast(StructType(List(StructField(\"fx_rate_snapshot_id\", IntegerType, true), StructField(\"publisher_currency\", StringType, true), StructField(\"publisher_exchange_rate\", DoubleType, true), StructField(\"advertiser_currency\", StringType, true), StructField(\"advertiser_exchange_rate\", DoubleType, true), StructField(\"advertiser_default_currency\", StringType, true), StructField(\"advertiser_default_exchange_rate\", DoubleType, true), StructField(\"member_currency\", StringType, true), StructField(\"member_exchange_rate\", DoubleType, true), StructField(\"billing_currency\", StringType, true), StructField(\"billing_exchange_rate\", DoubleType, true))))\nvar l_sup_bidder_fx_rate: org.apache.spark.sql.Column = lit(null).cast(StructType(List(StructField(\"fx_rate_snapshot_id\", IntegerType, true), StructField(\"currency_id\", IntegerType, true), StructField(\"code\", StringType, true), StructField(\"rate\", DoubleType, true), StructField(\"as_of_timestamp\", LongType, true))))\nvar l_sup_bidder_fx_rate_1: org.apache.spark.sql.Column = lit(null).cast(StructType(List(StructField(\"fx_rate_snapshot_id\", IntegerType, true), StructField(\"currency_id\", IntegerType, true), StructField(\"code\", StringType, true), StructField(\"rate\", DoubleType, true), StructField(\"as_of_timestamp\", LongType, true))))\nvar l_sup_bidder_fx_rate_3: org.apache.spark.sql.Column = lit(null).cast(StructType(List(StructField(\"fx_rate_snapshot_id\", IntegerType, true), StructField(\"currency_id\", IntegerType, true), StructField(\"code\", StringType, true), StructField(\"rate\", DoubleType, true), StructField(\"as_of_timestamp\", LongType, true))))\nvar l_sup_bidder_fx_rate_5: org.apache.spark.sql.Column = lit(null).cast(StructType(List(StructField(\"fx_rate_snapshot_id\", IntegerType, true), StructField(\"currency_id\", IntegerType, true), StructField(\"code\", StringType, true), StructField(\"rate\", DoubleType, true), StructField(\"as_of_timestamp\", LongType, true))))\nvar l_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id: org.apache.spark.sql.Column = fx_rate_snapshot_id.cast(IntegerType)\nvar l_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id_1: org.apache.spark.sql.Column = lit(null).cast(IntegerType)\nvar l_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id_3: org.apache.spark.sql.Column = lit(null).cast(IntegerType)\nvar l_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id_5: org.apache.spark.sql.Column = lit(null).cast(IntegerType)\nvar l_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id_0: org.apache.spark.sql.Column = lit(null).cast(IntegerType)\nvar l_agg_tl_network_analytics_pb_currency_publisher_currency: org.apache.spark.sql.Column = coalesce(publisher_currency, lit(\"USD\"))\nvar l_agg_tl_network_analytics_pb_currency_publisher_currency_0: org.apache.spark.sql.Column = lit(null).cast(StringType)\nvar l_agg_tl_network_analytics_pb_currency_publisher_currency_2: org.apache.spark.sql.Column = lit(null).cast(StringType)\nvar l_agg_tl_network_analytics_pb_currency_publisher_exchange_rate_2: org.apache.spark.sql.Column = lit(null).cast(DoubleType)\nvar l_agg_tl_network_analytics_pb_currency_advertiser_currency: org.apache.spark.sql.Column = coalesce(advertiser_currency, lit(\"USD\"))\nl_agg_tl_network_analytics_pb_currency_publisher_currency_0 = when(isnull(fx_rate_snapshot_id) and (isnull(publisher_currency) or isnull(publisher_currency_rate)), lit(\"USD\").cast(StringType)).otherwise(l_agg_tl_network_analytics_pb_currency_publisher_currency)\nvar l_agg_tl_network_analytics_pb_currency_advertiser_default_currency: org.apache.spark.sql.Column = lit(\"USD\")\nvar l_agg_tl_network_analytics_pb_currency_advertiser_default_currency_0: org.apache.spark.sql.Column = lit(null).cast(StringType)\nvar l_agg_tl_network_analytics_pb_currency_advertiser_default_exchange_rate: org.apache.spark.sql.Column = lit(1.0)\nvar l_agg_tl_network_analytics_pb_currency_advertiser_default_exchange_rate_0: org.apache.spark.sql.Column = lit(null).cast(DoubleType)\nvar l_agg_tl_network_analytics_pb_currency_billing_currency: org.apache.spark.sql.Column = lit(\"USD\")\nvar l_agg_tl_network_analytics_pb_currency_billing_currency_0: org.apache.spark.sql.Column = lit(null).cast(StringType)\nvar l_agg_tl_network_analytics_pb_currency_billing_exchange_rate: org.apache.spark.sql.Column = lit(1.0)\nvar l_agg_tl_network_analytics_pb_currency_billing_exchange_rate_0: org.apache.spark.sql.Column = lit(null).cast(DoubleType)\nvar l_agg_tl_network_analytics_pb_currency_member_currency: org.apache.spark.sql.Column = lit(\"USD\")\nvar l_agg_tl_network_analytics_pb_currency_member_currency_0: org.apache.spark.sql.Column = lit(null).cast(StringType)\nvar l_agg_tl_network_analytics_pb_currency_member_exchange_rate: org.apache.spark.sql.Column = lit(1.0)\nvar l_agg_tl_network_analytics_pb_currency_member_exchange_rate_0: org.apache.spark.sql.Column = lit(null).cast(DoubleType)\nl_member_id_0 = when(is_not_null(imp_type).cast(BooleanType), when(imp_type.isin(lit(9), lit(10), lit(11), lit(7), lit(5)) and is_not_null(buyer_member_id), buyer_member_id.cast(IntegerType)).when(is_not_null(seller_member_id).cast(BooleanType), seller_member_id.cast(IntegerType)).otherwise(l_member_id)).otherwise(l_member_id).cast(IntegerType)\nl_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id_1 = when(isnull(fx_rate_snapshot_id) and (string_compare(l_agg_tl_network_analytics_pb_currency_publisher_currency_0, lit(\"USD\")) =!= lit(0)), when(isnull(lookup(\"sup_code_fx_rate\", publisher_currency)).cast(BooleanType), l_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id).otherwise(lookup(\"sup_code_fx_rate\", publisher_currency).getField(\"fx_rate_snapshot_id\").cast(IntegerType))).when(isnull(fx_rate_snapshot_id) and (not(string_compare(l_agg_tl_network_analytics_pb_currency_publisher_currency_0, lit(\"USD\")) =!= lit(0))), l_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id).otherwise(l_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id_1).cast(IntegerType)\nl_agg_tl_network_analytics_pb_currency_publisher_currency_2 = when(is_not_null(fx_rate_snapshot_id).cast(BooleanType), when(string_compare(l_agg_tl_network_analytics_pb_currency_publisher_currency_0, lit(\"USD\")) =!= lit(0), when(isnull(lookup(\"sup_bidder_fx_rates\", fx_rate_snapshot_id, publisher_currency).getField(\"rate\")).cast(BooleanType), lit(\"USD\").cast(StringType)).otherwise(l_agg_tl_network_analytics_pb_currency_publisher_currency_0)).otherwise(l_agg_tl_network_analytics_pb_currency_publisher_currency_0)).when(string_compare(l_agg_tl_network_analytics_pb_currency_publisher_currency_0, lit(\"USD\")) =!= lit(0), when(isnull(lookup(\"sup_code_fx_rate\", publisher_currency)).cast(BooleanType), lit(\"USD\").cast(StringType)).otherwise(l_agg_tl_network_analytics_pb_currency_publisher_currency_0)).otherwise(l_agg_tl_network_analytics_pb_currency_publisher_currency_0)\nl_agg_tl_network_analytics_pb_currency_publisher_exchange_rate_2 = when(is_not_null(fx_rate_snapshot_id).cast(BooleanType), when(string_compare(l_agg_tl_network_analytics_pb_currency_publisher_currency_0, lit(\"USD\")) =!= lit(0), when(isnull(lookup(\"sup_bidder_fx_rates\", fx_rate_snapshot_id, publisher_currency).getField(\"rate\")).cast(BooleanType), lit(1.0).cast(DoubleType)).otherwise(lookup(\"sup_bidder_fx_rates\", fx_rate_snapshot_id, publisher_currency).getField(\"rate\").cast(DoubleType))).otherwise(lit(1.0).cast(DoubleType))).when(string_compare(l_agg_tl_network_analytics_pb_currency_publisher_currency_0, lit(\"USD\")) =!= lit(0), when(isnull(lookup(\"sup_code_fx_rate\", publisher_currency)).cast(BooleanType), lit(1.0).cast(DoubleType)).otherwise(lookup(\"sup_code_fx_rate\", publisher_currency).getField(\"rate\").cast(DoubleType))).otherwise(lit(1.0).cast(DoubleType)).cast(DoubleType)\nl_sup_bidder_fx_rate_1 = when(isnull(fx_rate_snapshot_id) and (string_compare(l_agg_tl_network_analytics_pb_currency_publisher_currency_0, lit(\"USD\")) =!= lit(0)), lookup(\"sup_code_fx_rate\", publisher_currency)).when(isnull(fx_rate_snapshot_id) and (not(string_compare(l_agg_tl_network_analytics_pb_currency_publisher_currency_0, lit(\"USD\")) =!= lit(0))), l_sup_bidder_fx_rate).otherwise(l_sup_bidder_fx_rate_1)\nl_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id_5 = when(isnull(fx_rate_snapshot_id) and is_not_null(l_member_id_0), when(is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0)).cast(BooleanType), when(is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"member_currency\")) and (string_compare(lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"member_currency\"), lit(\"USD\")) =!= lit(0)), when(isnull(l_agg_tl_network_analytics_pb_currency_member_exchange_rate).cast(BooleanType), l_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id_3).otherwise(lookup(\"sup_code_fx_rate\", lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"member_currency\")).getField(\"fx_rate_snapshot_id\").cast(IntegerType))).otherwise(l_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id_3)).otherwise(l_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id_5)).otherwise(l_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id_5).cast(IntegerType)\nl_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id_3 = when(isnull(fx_rate_snapshot_id) and is_not_null(l_member_id_0), when((is_not_null(advertiser_id).cast(BooleanType) and (is_not_null(rpad(sup_bidder_advertiser_pb_lookup.getField(\"advertiser_default_currency\"), 3, \" \")) and (string_compare(rpad(sup_bidder_advertiser_pb_lookup.getField(\"advertiser_default_currency\"), 3, \" \"), lit(\"USD\")) =!= lit(0)))) and is_not_null(lookup(\"sup_code_fx_rate\", rpad(sup_bidder_advertiser_pb_lookup.getField(\"advertiser_default_currency\"), 3, \" \"))).cast(BooleanType), lookup(\"sup_code_fx_rate\", rpad(sup_bidder_advertiser_pb_lookup.getField(\"advertiser_default_currency\"), 3, \" \")).getField(\"fx_rate_snapshot_id\").cast(IntegerType)).otherwise(l_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id_1)).otherwise(l_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id_3).cast(IntegerType)\nl_agg_tl_network_analytics_pb_currency_advertiser_default_currency_0 = when(is_not_null(fx_rate_snapshot_id).cast(BooleanType), when((is_not_null(l_member_id_0).cast(BooleanType) and is_not_null(advertiser_id).cast(BooleanType)) and (is_not_null(rpad(sup_bidder_advertiser_pb_lookup.getField(\"advertiser_default_currency\"), 3, \" \")) and (string_compare(rpad(sup_bidder_advertiser_pb_lookup.getField(\"advertiser_default_currency\"), 3, \" \"), lit(\"USD\")) =!= lit(0))), when(is_not_null(lookup(\"sup_bidder_fx_rates\", fx_rate_snapshot_id, rpad(sup_bidder_advertiser_pb_lookup.getField(\"advertiser_default_currency\"), 3, \" \")).getField(\"rate\").cast(DoubleType)).cast(BooleanType), sup_bidder_advertiser_pb_lookup.getField(\"advertiser_default_currency\").cast(StringType)).otherwise(lit(\"USD\").cast(StringType))).otherwise(l_agg_tl_network_analytics_pb_currency_advertiser_default_currency)).when((is_not_null(l_member_id_0).cast(BooleanType) and is_not_null(advertiser_id).cast(BooleanType)) and (is_not_null(rpad(sup_bidder_advertiser_pb_lookup.getField(\"advertiser_default_currency\"), 3, \" \")) and (string_compare(rpad(sup_bidder_advertiser_pb_lookup.getField(\"advertiser_default_currency\"), 3, \" \"), lit(\"USD\")) =!= lit(0))), when(is_not_null(lookup(\"sup_code_fx_rate\", rpad(sup_bidder_advertiser_pb_lookup.getField(\"advertiser_default_currency\"), 3, \" \"))).cast(BooleanType), sup_bidder_advertiser_pb_lookup.getField(\"advertiser_default_currency\").cast(StringType)).otherwise(lit(\"USD\").cast(StringType))).otherwise(l_agg_tl_network_analytics_pb_currency_advertiser_default_currency)\nl_agg_tl_network_analytics_pb_currency_advertiser_default_exchange_rate_0 = when(is_not_null(fx_rate_snapshot_id).cast(BooleanType), when((is_not_null(l_member_id_0).cast(BooleanType) and is_not_null(advertiser_id).cast(BooleanType)) and (is_not_null(rpad(sup_bidder_advertiser_pb_lookup.getField(\"advertiser_default_currency\"), 3, \" \")) and (string_compare(rpad(sup_bidder_advertiser_pb_lookup.getField(\"advertiser_default_currency\"), 3, \" \"), lit(\"USD\")) =!= lit(0))), when(is_not_null(lookup(\"sup_bidder_fx_rates\", fx_rate_snapshot_id, rpad(sup_bidder_advertiser_pb_lookup.getField(\"advertiser_default_currency\"), 3, \" \")).getField(\"rate\").cast(DoubleType)).cast(BooleanType), lookup(\"sup_bidder_fx_rates\", fx_rate_snapshot_id, rpad(sup_bidder_advertiser_pb_lookup.getField(\"advertiser_default_currency\"), 3, \" \")).getField(\"rate\").cast(DoubleType)).otherwise(lit(1.0).cast(DoubleType))).otherwise(l_agg_tl_network_analytics_pb_currency_advertiser_default_exchange_rate)).when((is_not_null(l_member_id_0).cast(BooleanType) and is_not_null(advertiser_id).cast(BooleanType)) and (is_not_null(rpad(sup_bidder_advertiser_pb_lookup.getField(\"advertiser_default_currency\"), 3, \" \")) and (string_compare(rpad(sup_bidder_advertiser_pb_lookup.getField(\"advertiser_default_currency\"), 3, \" \"), lit(\"USD\")) =!= lit(0))), when(is_not_null(lookup(\"sup_code_fx_rate\", rpad(sup_bidder_advertiser_pb_lookup.getField(\"advertiser_default_currency\"), 3, \" \"))).cast(BooleanType), lookup(\"sup_code_fx_rate\", rpad(sup_bidder_advertiser_pb_lookup.getField(\"advertiser_default_currency\"), 3, \" \")).getField(\"rate\").cast(DoubleType)).otherwise(lit(1.0).cast(DoubleType))).otherwise(l_agg_tl_network_analytics_pb_currency_advertiser_default_exchange_rate).cast(DoubleType)\nl_agg_tl_network_analytics_pb_currency_member_exchange_rate_0 = when(is_not_null(fx_rate_snapshot_id).cast(BooleanType), when((is_not_null(l_member_id_0).cast(BooleanType) and is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0)).cast(BooleanType)) and is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"member_currency\")).cast(BooleanType), when(isnull(lookup(\"sup_bidder_fx_rates\", fx_rate_snapshot_id, lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"member_currency\")).getField(\"rate\")).cast(BooleanType), lit(1.0).cast(DoubleType)).otherwise(lookup(\"sup_bidder_fx_rates\", fx_rate_snapshot_id, lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"member_currency\")).getField(\"rate\").cast(DoubleType))).otherwise(l_agg_tl_network_analytics_pb_currency_member_exchange_rate)).when((is_not_null(l_member_id_0).cast(BooleanType) and is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0)).cast(BooleanType)) and (is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"member_currency\")) and (string_compare(lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"member_currency\"), lit(\"USD\")) =!= lit(0))), when(isnull(l_agg_tl_network_analytics_pb_currency_member_exchange_rate).cast(BooleanType), lit(1.0).cast(DoubleType)).otherwise(lookup(\"sup_code_fx_rate\", lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"member_currency\")).getField(\"rate\").cast(DoubleType))).otherwise(l_agg_tl_network_analytics_pb_currency_member_exchange_rate).cast(DoubleType)\nl_agg_tl_network_analytics_pb_currency_member_currency_0 = when(is_not_null(fx_rate_snapshot_id).cast(BooleanType), when((is_not_null(l_member_id_0).cast(BooleanType) and is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0)).cast(BooleanType)) and is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"member_currency\")).cast(BooleanType), when(isnull(lookup(\"sup_bidder_fx_rates\", fx_rate_snapshot_id, lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"member_currency\")).getField(\"rate\")).cast(BooleanType), lit(\"USD\").cast(StringType)).otherwise(lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"member_currency\").cast(StringType))).otherwise(l_agg_tl_network_analytics_pb_currency_member_currency)).when((is_not_null(l_member_id_0).cast(BooleanType) and is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0)).cast(BooleanType)) and (is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"member_currency\")) and (string_compare(lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"member_currency\"), lit(\"USD\")) =!= lit(0))), when(isnull(l_agg_tl_network_analytics_pb_currency_member_exchange_rate).cast(BooleanType), lit(\"USD\").cast(StringType)).otherwise(lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"member_currency\").cast(StringType))).otherwise(l_agg_tl_network_analytics_pb_currency_member_currency)\nl_agg_tl_network_analytics_pb_currency_billing_currency_0 = when(is_not_null(fx_rate_snapshot_id).cast(BooleanType), when((is_not_null(l_member_id_0).cast(BooleanType) and is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0)).cast(BooleanType)) and is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"billing_currency\")).cast(BooleanType), when(isnull(lookup(\"sup_bidder_fx_rates\", fx_rate_snapshot_id, lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"billing_currency\")).getField(\"rate\")).cast(BooleanType), lit(\"USD\").cast(StringType)).otherwise(lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"billing_currency\").cast(StringType))).otherwise(l_agg_tl_network_analytics_pb_currency_billing_currency)).when((is_not_null(l_member_id_0).cast(BooleanType) and is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0)).cast(BooleanType)) and (is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"billing_currency\")) and (string_compare(lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"billing_currency\"), lit(\"USD\")) =!= lit(0))), when(isnull(lookup(\"sup_code_fx_rate\", lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"billing_currency\"))).cast(BooleanType), lit(\"USD\").cast(StringType)).otherwise(lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"billing_currency\").cast(StringType))).otherwise(l_agg_tl_network_analytics_pb_currency_billing_currency)\nl_agg_tl_network_analytics_pb_currency_billing_exchange_rate_0 = when(is_not_null(fx_rate_snapshot_id).cast(BooleanType), when((is_not_null(l_member_id_0).cast(BooleanType) and is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0)).cast(BooleanType)) and is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"billing_currency\")).cast(BooleanType), when(isnull(lookup(\"sup_bidder_fx_rates\", fx_rate_snapshot_id, lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"billing_currency\")).getField(\"rate\")).cast(BooleanType), lit(1.0).cast(DoubleType)).otherwise(lookup(\"sup_bidder_fx_rates\", fx_rate_snapshot_id, lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"billing_currency\")).getField(\"rate\").cast(DoubleType))).otherwise(l_agg_tl_network_analytics_pb_currency_billing_exchange_rate)).when((is_not_null(l_member_id_0).cast(BooleanType) and is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0)).cast(BooleanType)) and (is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"billing_currency\")) and (string_compare(lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"billing_currency\"), lit(\"USD\")) =!= lit(0))), when(isnull(lookup(\"sup_code_fx_rate\", lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"billing_currency\"))).cast(BooleanType), lit(1.0).cast(DoubleType)).otherwise(lookup(\"sup_code_fx_rate\", lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"billing_currency\")).getField(\"rate\").cast(DoubleType))).otherwise(l_agg_tl_network_analytics_pb_currency_billing_exchange_rate).cast(DoubleType)\nl_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id_0 = when(is_not_null(fx_rate_snapshot_id).cast(BooleanType), l_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id).when(is_not_null(l_member_id_0).cast(BooleanType), when(is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0)).cast(BooleanType), when(is_not_null(lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"billing_currency\")) and (string_compare(lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"billing_currency\"), lit(\"USD\")) =!= lit(0)), when(isnull(lookup(\"sup_code_fx_rate\", lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"billing_currency\"))).cast(BooleanType), l_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id_5).otherwise(lookup(\"sup_code_fx_rate\", lookup(\"sup_api_member_pb\", l_member_id_0).getField(\"billing_currency\")).getField(\"fx_rate_snapshot_id\").cast(IntegerType))).otherwise(l_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id_5)).otherwise(l_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id_3)).otherwise(l_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id_1).cast(IntegerType)\nvar l_agg_tl_network_analytics_pb_currency_advertiser_exchange_rate_0: org.apache.spark.sql.Column = resolve_exchange_rate(coalesce(advertiser_currency, lit(\"USD\")), fx_rate_snapshot_id, coalesce(advertiser_currency_rate, lit(1.0))).cast(DoubleType)\nl_agg_tl_network_analytics_pb_currency = struct(l_agg_tl_network_analytics_pb_currency_fx_rate_snapshot_id_0.as(\"fx_rate_snapshot_id\"),l_agg_tl_network_analytics_pb_currency_publisher_currency_2.as(\"publisher_currency\"),l_agg_tl_network_analytics_pb_currency_publisher_exchange_rate_2.as(\"publisher_exchange_rate\"),l_agg_tl_network_analytics_pb_currency_advertiser_currency.as(\"advertiser_currency\"),l_agg_tl_network_analytics_pb_currency_advertiser_exchange_rate_0.as(\"advertiser_exchange_rate\"),l_agg_tl_network_analytics_pb_currency_advertiser_default_currency_0.as(\"advertiser_default_currency\"),l_agg_tl_network_analytics_pb_currency_advertiser_default_exchange_rate_0.as(\"advertiser_default_exchange_rate\"),l_agg_tl_network_analytics_pb_currency_member_currency_0.as(\"member_currency\"),l_agg_tl_network_analytics_pb_currency_member_exchange_rate_0.as(\"member_exchange_rate\"),l_agg_tl_network_analytics_pb_currency_billing_currency_0.as(\"billing_currency\"),l_agg_tl_network_analytics_pb_currency_billing_exchange_rate_0.as(\"billing_exchange_rate\"))\nl_agg_tl_network_analytics_pb_currency","language":"scala","description":""}