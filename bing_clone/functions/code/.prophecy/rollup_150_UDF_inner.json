{"initCode":"\ndef convertToDouble(input: Any): Double = {\n    try {\n      input match {\n        case x: Boolean    ⇒ if (x) 1 else 0\n        case x: Int        ⇒ x.toDouble\n        case x: Integer    ⇒ x.toDouble\n        case x: Long       ⇒ x.toDouble\n        case x: BigDecimal ⇒ x.toDouble\n        case x: Double     ⇒ x\n        case x: Float      ⇒ x.toDouble\n        case \"null\" ⇒ Double.MinValue\n        case x: String ⇒ x.toDouble\n        case x @ _ ⇒ x.toString.toDouble\n      }\n    } catch {\n      case _: Throwable ⇒ Double.MinValue\n    }\n  }\n","code":"udf(\n    (_input: Seq[Row]) => {\n      var input = _input.toArray\n      var out = Row(\n        null,\n        null,\n        null,\n        null,\n        null,\n        null.asInstanceOf[String],\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null.asInstanceOf[String],\n        null,\n        null,\n        null.asInstanceOf[String],\n        null.asInstanceOf[String],\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null.asInstanceOf[String],\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        null,\n        Row(null, null),\n        Row(null),\n        null\n      )\n      var i = 0\n\n      while (compareTo(i, input.length) < 0) {\n        var in   = input(convertToInt(i))\n        var temp = out\n        if (i == 0)\n          temp = in\n        temp = out\n        var temp_view_result           = 0\n        var temp_viewdef_definition_id = 0\n        var temp_viewdef_view_result   = 0\n        var in_view_result             = 0\n        var in_viewdef_definition_id   = 0\n        var in_viewdef_view_result     = 0\n        var view_result                = 0\n        var viewdef_definition_id      = 0\n        var viewdef_view_result        = 0\n        temp_view_result =\n          if (temp.getAs[Integer](3) == null)\n            0\n          else\n            temp.getAs[Integer](3)\n        temp_viewdef_definition_id =\n          if (temp.getAs[Integer](6) == null)\n            0\n          else\n            temp.getAs[Integer](6)\n        temp_viewdef_view_result =\n          if (temp.getAs[Integer](7) == null)\n            0\n          else\n            temp.getAs[Integer](7)\n        in_view_result =\n          if (convertToInt(in.getAs[Integer](\"view_result\")) == null)\n            0\n          else\n            convertToInt(in.getAs[Integer](\"view_result\"))\n        in_viewdef_definition_id =\n          if (convertToInt(in.getAs[Integer](\"viewdef_definition_id\")) == null)\n            0\n          else\n            convertToInt(in.getAs[Integer](\"viewdef_definition_id\"))\n        in_viewdef_view_result =\n          if (convertToInt(in.getAs[Integer](\"viewdef_view_result\")) == null)\n            0\n          else\n            convertToInt(in.getAs[Integer](\"viewdef_view_result\"))\n        if (\n          ((temp_view_result == in_view_result) || (in_view_result == 0)) || (temp_view_result == 1)\n        )\n          view_result = temp_view_result\n        else if ((temp_view_result == 0) || (in_view_result == 1))\n          view_result = in_view_result\n        else view_result = 3\n        if (\n          compareTo(temp_viewdef_definition_id, in_viewdef_definition_id) > 0\n        ) {\n          viewdef_definition_id = temp_viewdef_definition_id\n          viewdef_view_result = temp_viewdef_view_result\n        } else if (\n          compareTo(temp_viewdef_definition_id, in_viewdef_definition_id) < 0\n        ) {\n          viewdef_definition_id = in_viewdef_definition_id\n          viewdef_view_result = in_viewdef_view_result\n        } else if (compareTo(temp_viewdef_definition_id, 0) > 0) {\n          viewdef_definition_id = temp_viewdef_definition_id\n          if (\n            ((temp_viewdef_view_result == in_viewdef_view_result) || (in_viewdef_view_result == 0)) || (temp_viewdef_view_result == 1)\n          )\n            viewdef_view_result = temp_viewdef_view_result\n          else if (\n            (temp_viewdef_view_result == 0) || (in_viewdef_view_result == 1)\n          )\n            viewdef_view_result = in_viewdef_view_result\n          else viewdef_view_result = 3\n        } else {\n          viewdef_definition_id = 0\n          viewdef_view_result = 0\n        }\n        out =\n          updateIndexInRow(out, 0, convertToLong(in.getAs[Long](\"date_time\")))\n        out = updateIndexInRow(out,\n                               1,\n                               convertToLong(in.getAs[Long](\"auction_id_64\"))\n        )\n        out =\n          updateIndexInRow(out, 2, convertToLong(in.getAs[Long](\"user_id_64\")))\n        out = updateIndexInRow(out,\n                               3,\n                               convertToInt(in.getAs[Integer](\"view_result\"))\n        )\n        out = updateIndexInRow(out, 4, convertToInt(in.getAs[Integer](\"ttl\")))\n        out = updateIndexInRow(out, 5, in.getAs[String](\"view_data\"))\n        out = updateIndexInRow(\n          out,\n          6,\n          convertToInt(in.getAs[Integer](\"viewdef_definition_id\"))\n        )\n        out = updateIndexInRow(\n          out,\n          7,\n          convertToInt(in.getAs[Integer](\"viewdef_view_result\"))\n        )\n        out = updateIndexInRow(\n          out,\n          8,\n          convertToInt(in.getAs[Integer](\"view_not_measurable_type\"))\n        )\n        out = updateIndexInRow(\n          out,\n          9,\n          convertToInt(in.getAs[Integer](\"view_not_visible_type\"))\n        )\n        out =\n          updateIndexInRow(out,\n                           10,\n                           convertToInt(in.getAs[Integer](\"view_frame_type\"))\n          )\n        out = updateIndexInRow(\n          out,\n          11,\n          convertToInt(in.getAs[Integer](\"view_script_version\"))\n        )\n        out = updateIndexInRow(out, 12, in.getAs[String](\"view_tag_version\"))\n        out =\n          updateIndexInRow(out,\n                           13,\n                           convertToInt(in.getAs[Integer](\"view_screen_width\"))\n          )\n        out =\n          updateIndexInRow(out,\n                           14,\n                           convertToInt(in.getAs[Integer](\"view_screen_height\"))\n          )\n        out = updateIndexInRow(out, 15, in.getAs[String](\"view_js_browser\"))\n        out = updateIndexInRow(out, 16, in.getAs[String](\"view_js_platform\"))\n        out =\n          updateIndexInRow(out,\n                           17,\n                           convertToInt(in.getAs[Integer](\"view_banner_left\"))\n          )\n        out =\n          updateIndexInRow(out,\n                           18,\n                           convertToInt(in.getAs[Integer](\"view_banner_top\"))\n          )\n        out =\n          updateIndexInRow(out,\n                           19,\n                           convertToInt(in.getAs[Integer](\"view_banner_width\"))\n          )\n        out =\n          updateIndexInRow(out,\n                           20,\n                           convertToInt(in.getAs[Integer](\"view_banner_height\"))\n          )\n        out =\n          updateIndexInRow(out,     21, in.getAs[Double](\"view_tracking_duration\"))\n        out = updateIndexInRow(out, 22, in.getAs[Double](\"view_page_duration\"))\n        out = updateIndexInRow(out, 23, in.getAs[Double](\"view_usage_duration\"))\n        out = updateIndexInRow(out, 24, in.getAs[Double](\"view_surface\"))\n        out = updateIndexInRow(out, 25, in.getAs[String](\"view_js_message\"))\n        out =\n          updateIndexInRow(out,\n                           26,\n                           convertToInt(in.getAs[Integer](\"view_player_width\"))\n          )\n        out =\n          updateIndexInRow(out,\n                           27,\n                           convertToInt(in.getAs[Integer](\"view_player_height\"))\n          )\n        out = updateIndexInRow(out, 28, in.getAs[Double](\"view_iab_duration\"))\n        out = updateIndexInRow(\n          out,\n          29,\n          convertToInt(in.getAs[Integer](\"view_iab_inview_count\"))\n        )\n        out =\n          updateIndexInRow(out, 30, in.getAs[Double](\"view_duration_gt_0pct\"))\n        out =\n          updateIndexInRow(out, 31, in.getAs[Double](\"view_duration_gt_25pct\"))\n        out =\n          updateIndexInRow(out, 32, in.getAs[Double](\"view_duration_gt_50pct\"))\n        out =\n          updateIndexInRow(out, 33, in.getAs[Double](\"view_duration_gt_75pct\"))\n        out =\n          updateIndexInRow(out, 34, in.getAs[Double](\"view_duration_eq_100pct\"))\n        out =\n          updateIndexInRow(out,\n                           35,\n                           convertToLong(in.getAs[Long](\"auction_timestamp\"))\n          )\n        out = updateIndexInRow(\n          out,\n          36,\n          convertToInt(in.getAs[Integer](\"view_has_banner_left\"))\n        )\n        out = updateIndexInRow(\n          out,\n          37,\n          convertToInt(in.getAs[Integer](\"view_has_banner_top\"))\n        )\n        out = updateIndexInRow(\n          out,\n          38,\n          convertToInt(in.getAs[Integer](\"view_mouse_position_final_x\"))\n        )\n        out = updateIndexInRow(\n          out,\n          39,\n          convertToInt(in.getAs[Integer](\"view_mouse_position_final_y\"))\n        )\n        out = updateIndexInRow(\n          out,\n          40,\n          convertToInt(in.getAs[Integer](\"view_has_mouse_position_final\"))\n        )\n        out = updateIndexInRow(\n          out,\n          41,\n          convertToInt(in.getAs[Integer](\"view_mouse_position_initial_x\"))\n        )\n        out = updateIndexInRow(\n          out,\n          42,\n          convertToInt(in.getAs[Integer](\"view_mouse_position_initial_y\"))\n        )\n        out = updateIndexInRow(\n          out,\n          43,\n          convertToInt(in.getAs[Integer](\"view_has_mouse_position_initial\"))\n        )\n        out = updateIndexInRow(\n          out,\n          44,\n          convertToInt(in.getAs[Integer](\"view_mouse_position_page_x\"))\n        )\n        out = updateIndexInRow(\n          out,\n          45,\n          convertToInt(in.getAs[Integer](\"view_mouse_position_page_y\"))\n        )\n        out = updateIndexInRow(\n          out,\n          46,\n          convertToInt(in.getAs[Integer](\"view_has_mouse_position_page\"))\n        )\n        out = updateIndexInRow(\n          out,\n          47,\n          convertToInt(in.getAs[Integer](\"view_mouse_position_timeout_x\"))\n        )\n        out = updateIndexInRow(\n          out,\n          48,\n          convertToInt(in.getAs[Integer](\"view_mouse_position_timeout_y\"))\n        )\n        out = updateIndexInRow(\n          out,\n          49,\n          convertToInt(in.getAs[Integer](\"view_has_mouse_position_timeout\"))\n        )\n        out = updateIndexInRow(out,\n                               50,\n                               convertToLong(in.getAs[Long](\"view_session_id\"))\n        )\n        out = updateIndexInRow(out, 51, in.getAs[Row](\"view_video\"))\n        out = updateIndexInRow(out, 52, in.getAs[Row](\"anonymized_user_info\"))\n        out = updateIndexInRow(out, 53, in.getAs[Boolean](\"is_deferred\"))\n        i = i + convertToInt(1)\n      }\n\n      out\n    },\n    StructType(\n      List(\n        StructField(\"date_time\",                       LongType,    false),\n        StructField(\"auction_id_64\",                   LongType,    false),\n        StructField(\"user_id_64\",                      LongType,    false),\n        StructField(\"view_result\",                     IntegerType, false),\n        StructField(\"ttl\",                             IntegerType, false),\n        StructField(\"view_data\",                       StringType,  false),\n        StructField(\"viewdef_definition_id\",           IntegerType, false),\n        StructField(\"viewdef_view_result\",             IntegerType, false),\n        StructField(\"view_not_measurable_type\",        IntegerType, false),\n        StructField(\"view_not_visible_type\",           IntegerType, false),\n        StructField(\"view_frame_type\",                 IntegerType, false),\n        StructField(\"view_script_version\",             IntegerType, false),\n        StructField(\"view_tag_version\",                StringType,  false),\n        StructField(\"view_screen_width\",               IntegerType, false),\n        StructField(\"view_screen_height\",              IntegerType, false),\n        StructField(\"view_js_browser\",                 StringType,  false),\n        StructField(\"view_js_platform\",                StringType,  false),\n        StructField(\"view_banner_left\",                IntegerType, false),\n        StructField(\"view_banner_top\",                 IntegerType, false),\n        StructField(\"view_banner_width\",               IntegerType, false),\n        StructField(\"view_banner_height\",              IntegerType, false),\n        StructField(\"view_tracking_duration\",          DoubleType,  false),\n        StructField(\"view_page_duration\",              DoubleType,  false),\n        StructField(\"view_usage_duration\",             DoubleType,  false),\n        StructField(\"view_surface\",                    DoubleType,  false),\n        StructField(\"view_js_message\",                 StringType,  false),\n        StructField(\"view_player_width\",               IntegerType, false),\n        StructField(\"view_player_height\",              IntegerType, false),\n        StructField(\"view_iab_duration\",               DoubleType,  false),\n        StructField(\"view_iab_inview_count\",           IntegerType, false),\n        StructField(\"view_duration_gt_0pct\",           DoubleType,  false),\n        StructField(\"view_duration_gt_25pct\",          DoubleType,  false),\n        StructField(\"view_duration_gt_50pct\",          DoubleType,  false),\n        StructField(\"view_duration_gt_75pct\",          DoubleType,  false),\n        StructField(\"view_duration_eq_100pct\",         DoubleType,  false),\n        StructField(\"auction_timestamp\",               LongType,    false),\n        StructField(\"view_has_banner_left\",            IntegerType, false),\n        StructField(\"view_has_banner_top\",             IntegerType, false),\n        StructField(\"view_mouse_position_final_x\",     IntegerType, false),\n        StructField(\"view_mouse_position_final_y\",     IntegerType, false),\n        StructField(\"view_has_mouse_position_final\",   IntegerType, false),\n        StructField(\"view_mouse_position_initial_x\",   IntegerType, false),\n        StructField(\"view_mouse_position_initial_y\",   IntegerType, false),\n        StructField(\"view_has_mouse_position_initial\", IntegerType, false),\n        StructField(\"view_mouse_position_page_x\",      IntegerType, false),\n        StructField(\"view_mouse_position_page_y\",      IntegerType, false),\n        StructField(\"view_has_mouse_position_page\",    IntegerType, false),\n        StructField(\"view_mouse_position_timeout_x\",   IntegerType, false),\n        StructField(\"view_mouse_position_timeout_y\",   IntegerType, false),\n        StructField(\"view_has_mouse_position_timeout\", IntegerType, false),\n        StructField(\"view_session_id\",                 LongType,    false),\n        StructField(\n          \"view_video\",\n          StructType(\n            List(\n              StructField(\"view_audio_duration_eq_100pct\", DoubleType, false),\n              StructField(\"view_creative_duration\",        DoubleType, false)\n            )\n          ),\n          false\n        ),\n        StructField(\"anonymized_user_info\",\n                    StructType(\n                      List(\n                        StructField(\"user_id\", BinaryType, false)\n                      )\n                    ),\n                    false\n        ),\n        StructField(\"is_deferred\", BooleanType, false)\n      )\n    )\n  )"}