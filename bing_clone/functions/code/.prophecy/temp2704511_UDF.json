{"initCode":"","code":"udf(\n    (\n      _in_pricing_terms: Seq[Row],\n      _l_pricing_terms:  Seq[Row],\n      _i:                Integer,\n      _magnitude:        Double\n    ) => {\n      var l_pricing_terms  = _l_pricing_terms.toArray\n      var i                = _i\n      var in_pricing_terms = _in_pricing_terms.toArray\n      var magnitude        = _magnitude\n\n      while (compareTo(i, l_pricing_terms.length) < 0) {\n        if (!_isnull(in_pricing_terms(convertToInt(i)).getAs[Double](\"amount\")))\n          l_pricing_terms(i) = Row(\n            l_pricing_terms(convertToInt(i)).getAs[Integer](\"term_id\"),\n            l_pricing_terms(convertToInt(i))\n              .getAs[Double](\"amount\") / magnitude,\n            l_pricing_terms(convertToInt(i)).getAs[Double](\"rate\"),\n            l_pricing_terms(convertToInt(i)).getAs[Boolean](\"is_deduction\"),\n            l_pricing_terms(convertToInt(i))\n              .getAs[Boolean](\"is_media_cost_dependent\"),\n            l_pricing_terms(convertToInt(i)).getAs[Integer](\"data_member_id\")\n          )\n        i = i + convertToInt(1)\n      }\n\n      Row(\n        l_pricing_terms.map { x =>\n          if (!_isnull(x))\n            Row(convertToInt(x.getAs[Integer](0)),\n                x.getAs[Double](1),\n                x.getAs[Double](2),\n                x.getAs[Boolean](3),\n                x.getAs[Boolean](4),\n                convertToInt(x.getAs[Integer](5))\n            )\n          else\n            null\n        }.toArray,\n        convertToInt(i)\n      )\n    },\n    StructType(\n      List(\n        StructField(\n          \"l_pricing_terms\",\n          ArrayType(\n            StructType(\n              List(\n                StructField(\"term_id\",                 IntegerType, true),\n                StructField(\"amount\",                  DoubleType,  true),\n                StructField(\"rate\",                    DoubleType,  true),\n                StructField(\"is_deduction\",            BooleanType, true),\n                StructField(\"is_media_cost_dependent\", BooleanType, true),\n                StructField(\"data_member_id\",          IntegerType, true)\n              )\n            )\n          ),\n          false\n        ),\n        StructField(\"i\", IntegerType, false)\n      )\n    )\n  )"}